[
    {
        "user": "U9JHLMZB4",
        "type": "message",
        "ts": "1647085089.954669",
        "client_msg_id": "2ec79803-5489-4018-a9c4-d0b11c47f920",
        "text": "You could build something into your strategy to output the P&amp;L of each market as the backtesting closes it, possibly by adding something into the strategy's process_closed_market() method. But I wouldn't recommend it.\n\nBetter would be to understand that if you're going to be doing this seriously, you'll be doing a lot of backtesting, and sitting watching the results in real-time is going to get old really quick. So rather than solving this problem, maybe have a think about how you could use the backtesting run time more productively.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g951ddcb43e7",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/3951ddcb43e788a387d6daf330dad5ca.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0018-72.png",
            "first_name": "",
            "real_name": "Peter Coles",
            "display_name": "Peter",
            "team": "T4G9NBD2M",
            "name": "peter",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1647032643.268099",
        "parent_user_id": "U0266A8579B",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "8wF",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "You could build something into your strategy to output the P&L of each market as the backtesting closes it, possibly by adding something into the strategy's process_closed_market() method. But I wouldn't recommend it.\n\nBetter would be to understand that if you're going to be doing this seriously, you'll be doing a lot of backtesting, and sitting watching the results in real-time is going to get old really quick. So rather than solving this problem, maybe have a think about how you could use the backtesting run time more productively."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U0266A8579B",
        "type": "message",
        "ts": "1647085745.283049",
        "client_msg_id": "66096dd0-0c3f-490e-92d2-1dea1f954d2c",
        "text": "No, I am not watching this real-time. I am running the script overnight and I want to be able to come to back to it in the morning and decide whether I want to continue running or just abort if I find it halfway that it is not a strategy I want to pursue.  I am also running a lot of other stuff\/simulations on my machine and there is always a chance something goes wrong and it doesn't finish.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "9716da07d96d",
            "image_72": "https:\/\/avatars.slack-edge.com\/2021-06-25\/2219629138132_9716da07d96d5116cddf_72.png",
            "first_name": "Laybot",
            "real_name": "Laybot McBackbot",
            "display_name": "Laybot McBackbot",
            "team": "T4G9NBD2M",
            "name": "zarulshahrin",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1647032643.268099",
        "parent_user_id": "U0266A8579B",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "G1xr",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "No, I am not watching this real-time. I am running the script overnight and I want to be able to come to back to it in the morning and decide whether I want to continue running or just abort if I find it halfway that it is not a strategy I want to pursue.  I am also running a lot of other stuff\/simulations on my machine and there is always a chance something goes wrong and it doesn't finish."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1647086254.513369",
        "client_msg_id": "df72ea50-f31a-45da-8a2c-e64d06b3b8f6",
        "text": "I split the markets into chunks and run the backtest onto one chunk after another. After each chunk i update the current results.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1647032643.268099",
        "parent_user_id": "U0266A8579B",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "7RsB0",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I split the markets into chunks and run the backtest onto one chunk after another. After each chunk i update the current results."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U9JHLMZB4",
        "type": "message",
        "ts": "1647098733.977469",
        "edited": {
            "user": "U9JHLMZB4",
            "ts": "1647098793.000000"
        },
        "client_msg_id": "c76099cd-7925-40b9-8455-dd20594499df",
        "text": "I do similar but in parallel. I chunk the markets by day and then use multithreading to run each day in a separate thread. Each day's results are persisted to a csv file and it's then trivial to load all available days into Pandas and summarise the results. It's also easy to spot any days that fail and either restart from there or just hit any holes.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g951ddcb43e7",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/3951ddcb43e788a387d6daf330dad5ca.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0018-72.png",
            "first_name": "",
            "real_name": "Peter Coles",
            "display_name": "Peter",
            "team": "T4G9NBD2M",
            "name": "peter",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1647032643.268099",
        "parent_user_id": "U0266A8579B",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "qSKH",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I do similar but in parallel. I chunk the markets by day and then use multithreading to run each day in a separate thread. Each day's results are persisted to a csv file and it's then trivial to load all available days into Pandas and summarise the results. It's also easy to spot any days that fail and either restart from there or just hit any holes."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "channel_join",
        "user": "U037GSR110Q",
        "text": "<@U037GSR110Q> has joined the channel",
        "type": "message",
        "ts": "1647101961.227559"
    },
    {
        "user": "UFTBRB3F1",
        "type": "message",
        "ts": "1647108216.029809",
        "client_msg_id": "8a20e468-4f2e-4815-8621-819972d4ab8e",
        "text": "<https:\/\/github.com\/liampauling\/flumine\/blob\/master\/examples\/backtest.py>",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g771e110be94",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/a771e110be945b86bede9d5c1bb551e3.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Newbie99",
            "display_name": "",
            "team": "T4G9NBD2M",
            "name": "vjmehra",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1647032643.268099",
        "parent_user_id": "U0266A8579B",
        "attachments": [
            {
                "id": 1,
                "footer_icon": "https:\/\/slack.github.com\/static\/img\/favicon-neutral.png",
                "color": "24292f",
                "bot_id": "B021ZJYSBMW",
                "app_unfurl_url": "https:\/\/github.com\/liampauling\/flumine\/blob\/master\/examples\/backtest.py",
                "is_app_unfurl": true,
                "app_id": "A01BP7R4KNY",
                "fallback": "<https:\/\/github.com\/liampauling\/flumine\/blob\/master\/examples\/backtest.py | backtest.py>",
                "text": "```\nimport time\nimport logging\nfrom pythonjsonlogger import jsonlogger\n\nfrom flumine import FlumineBacktest, clients\nfrom strategies.lowestlayer import LowestLayer\n\nlogger = logging.getLogger()\n\ncustom_format = \"%(asctime) %(levelname) %(message)\"\nlog_handler = logging.StreamHandler()\nformatter = jsonlogger.JsonFormatter(custom_format)\nformatter.converter = time.gmtime\nlog_handler.setFormatter(formatter)\nlogger.addHandler(log_handler)\nlogger.setLevel(<http:\/\/logging.INFO|logging.INFO>)  # Set to logging.CRITICAL to speed up backtest\n\nclient = clients.BacktestClient()\n\nframework = FlumineBacktest(client=client)\n\nmarkets = [\"tests\/resources\/PRO-1.170258213\"]\n\nstrategy = LowestLayer(\n    market_filter={\"markets\": markets},\n    max_order_exposure=1000,\n    max_selection_exposure=105,\n    context={\"stake\": 2},\n)\nframework.add_strategy(strategy)\n\nframework.run()\n\nfor market in framework.markets:\n    print(\"Profit: {0:.2f}\".format(sum([o.simulated.profit for o in market.blotter])))\n    for order in market.blotter:\n        print(\n            order.selection_id,\n            order.responses.date_time_placed,\n            order.status,\n            order.order_type.price,\n            order.average_price_matched,\n            order.size_matched,\n            order.simulated.profit,\n        )\n\n```",
                "title": "<https:\/\/github.com\/liampauling\/flumine\/blob\/master\/examples\/backtest.py | backtest.py>",
                "footer": "<https:\/\/github.com\/liampauling\/flumine|liampauling\/flumine>",
                "mrkdwn_in": [
                    "text"
                ]
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "yW29i",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/liampauling\/flumine\/blob\/master\/examples\/backtest.py"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UFTBRB3F1",
        "type": "message",
        "ts": "1647108224.286509",
        "client_msg_id": "52ef6d8f-b2a9-47bd-8d60-f88ed497cf21",
        "text": "I think that is what you are after?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g771e110be94",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/a771e110be945b86bede9d5c1bb551e3.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Newbie99",
            "display_name": "",
            "team": "T4G9NBD2M",
            "name": "vjmehra",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1647032643.268099",
        "parent_user_id": "U0266A8579B",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "O4Av\/",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I think that is what you are after?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U033HM6Q8BU",
        "type": "message",
        "ts": "1647136692.226979",
        "client_msg_id": "38c9eb26-c4fd-4a69-8453-1ec70d4f220c",
        "text": "When backtesting in flumine does the market.blotter.simulated.profit take into account market base rate fees (I'm assuming no)?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "5852523ef409",
            "image_72": "https:\/\/avatars.slack-edge.com\/2022-02-17\/3122043950356_5852523ef409c4ffc813_72.png",
            "first_name": "LM",
            "real_name": "LM",
            "display_name": "LM",
            "team": "T4G9NBD2M",
            "name": "yeetljuicer",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1647136692.226979",
        "reply_count": 2,
        "reply_users_count": 2,
        "latest_reply": "1647215321.822569",
        "reply_users": [
            "U4H19D1D2",
            "U033HM6Q8BU"
        ],
        "replies": [
            {
                "user": "U4H19D1D2",
                "ts": "1647169943.467209"
            },
            {
                "user": "U033HM6Q8BU",
                "ts": "1647215321.822569"
            }
        ],
        "is_locked": false,
        "subscribed": true,
        "last_read": "1647215321.822569",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "RpV",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "When backtesting in flumine does the market.blotter.simulated.profit take into account market base rate fees (I'm assuming no)?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U0322P0CK0E",
        "type": "message",
        "ts": "1647149024.894919",
        "edited": {
            "user": "U0322P0CK0E",
            "ts": "1647149071.000000"
        },
        "client_msg_id": "5da1870d-3a02-40b6-8e7c-7ec24fc6b73f",
        "text": "What is the best way to calculate the volume weighted average price of all the matched bets including other peoples for a selection using flumine?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "ab1918814707",
            "image_72": "https:\/\/avatars.slack-edge.com\/2022-07-31\/3867647231206_ab191881470773932048_72.jpg",
            "first_name": "Vincent",
            "real_name": "Vincent Lim",
            "display_name": "Guy Incognito",
            "team": "T4G9NBD2M",
            "name": "nelsonmathsspecialist",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1647149024.894919",
        "reply_count": 1,
        "reply_users_count": 1,
        "latest_reply": "1647156197.508969",
        "reply_users": [
            "U010GM77S4W"
        ],
        "replies": [
            {
                "user": "U010GM77S4W",
                "ts": "1647156197.508969"
            }
        ],
        "is_locked": false,
        "subscribed": false,
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "VqM",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "What is the best way to calculate the volume weighted average price of all the matched bets including other peoples for a selection using flumine?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U010GM77S4W",
        "type": "message",
        "ts": "1647156197.508969",
        "client_msg_id": "e3f2701e-cc61-4aec-a48b-0fc98e15fe24",
        "text": "I use the following function that someone kindly shared here:\n\n```\ndef runner_vwap(runner: RunnerBook) -&gt; Optional[float]:\n    \"\"\"returns runner vwap calculated from EX_TRADED\"\"\"\n    try:\n        tt = 0.0\n        tw = 0.0\n        for pd in runner.ex.traded_volume:\n            tt += pd['size']\n            tw += pd['size'] * pd['price']\n        return tw \/ tt\n    except:\n        return```",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "66cae8f5399c",
            "image_72": "https:\/\/avatars.slack-edge.com\/2020-03-20\/1004508356769_66cae8f5399cf91a07ae_72.jpg",
            "first_name": "",
            "real_name": "mandelbot",
            "display_name": "mandelbot",
            "team": "T4G9NBD2M",
            "name": "demhadbale",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1647149024.894919",
        "parent_user_id": "U0322P0CK0E",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Ddo",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I use the following function that someone kindly shared here:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\ndef runner_vwap(runner: RunnerBook) -> Optional[float]:\n    \"\"\"returns runner vwap calculated from EX_TRADED\"\"\"\n    try:\n        tt = 0.0\n        tw = 0.0\n        for pd in runner.ex.traded_volume:\n            tt += pd['size']\n            tw += pd['size'] * pd['price']\n        return tw \/ tt\n    except:\n        return"
                            }
                        ],
                        "border": 0
                    }
                ]
            }
        ]
    }
]