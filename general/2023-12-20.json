[
    {
        "user": "U03QLPZQBLM",
        "type": "message",
        "ts": "1703060924.772389",
        "client_msg_id": "6e3fd841-5f16-4b5c-bcf9-2cc3072227bf",
        "text": "in the orders I get back from *`_process_cleared_orders_meta` the `bet_id` column is not unique*",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gee4caf4e81f",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/ee4caf4e81ff96058a7d4a3efdf1a260.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "Johnny",
            "real_name": "Johnny Boston",
            "display_name": "",
            "team": "T4G9NBD2M",
            "name": "mike.breen.bbb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1702545412.369359",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "y+wuO",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "in the orders I get back from "
                            },
                            {
                                "type": "text",
                                "text": "_process_cleared_orders_meta",
                                "style": {
                                    "bold": true,
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " the ",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "bet_id",
                                "style": {
                                    "bold": true,
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " column is not unique",
                                "style": {
                                    "bold": true
                                }
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1703062175.047299",
        "client_msg_id": "315532CD-1121-4292-84A6-6A44818D20F8",
        "text": "Do you mean you get duplicates, which is expected as you will get updates from betfair after a market closes which causes this to be called again ",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1702545412.369359",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "AqnU7",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Do you mean you get duplicates, which is expected as you will get updates from betfair after a market closes which causes this to be called again "
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1703062185.696729",
        "client_msg_id": "BE7AA806-C3B0-4FCE-8107-5673DDE89E60",
        "text": "Resettlement for example ",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1702545412.369359",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "d\/SzI",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Resettlement for example "
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U03QLPZQBLM",
        "type": "message",
        "ts": "1703062370.050309",
        "client_msg_id": "70b0ad1c-8588-45b8-a0a8-198d05f602c6",
        "text": "no, I mean I get the same bet_id but it is in a different  market",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gee4caf4e81f",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/ee4caf4e81ff96058a7d4a3efdf1a260.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "Johnny",
            "real_name": "Johnny Boston",
            "display_name": "",
            "team": "T4G9NBD2M",
            "name": "mike.breen.bbb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1702545412.369359",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "GRRXw",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "no, I mean I get the same bet_id but it is in a different  market"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1703062384.499419",
        "client_msg_id": "194BF96B-9AFC-4BEC-A3A2-5123CC053B03",
        "text": "User error ",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1702545412.369359",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "3rra1",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "User error "
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U03QLPZQBLM",
        "type": "message",
        "ts": "1703062403.229759",
        "client_msg_id": "51381d4c-e6e8-477e-aa19-284fa513b42e",
        "text": "I am literally writing out the raw stuff",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gee4caf4e81f",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/ee4caf4e81ff96058a7d4a3efdf1a260.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "Johnny",
            "real_name": "Johnny Boston",
            "display_name": "",
            "team": "T4G9NBD2M",
            "name": "mike.breen.bbb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1702545412.369359",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Q\/26e",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I am literally writing out the raw stuff"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U03QLPZQBLM",
        "type": "message",
        "ts": "1703062426.104549",
        "client_msg_id": "36a5fe05-57f1-4c80-aa75-615bbc534630",
        "text": "```\n    def _process_cleared_orders_meta(self, event):\n        orders = event.event\n        updated_orders = []\n        for order in orders:\n            if order.order_type.ORDER_TYPE == OrderTypes.LIMIT:\n                size = order.order_type.size\n            else:\n                size = order.order_type.liability\n\n            if order.order_type.ORDER_TYPE == OrderTypes.MARKET_ON_CLOSE:\n                price = None\n            else:\n                price = order.order_type.price\n\n            order_data = {\n                \"bet_id\": order.bet_id,\n                \"market_id\": order.market_id,\n                \"selection_id\": order.selection_id,\n                \"trade_id\": order.trade.id,\n                \"date_time_placed\": order.responses.date_time_placed,\n                \"price\": price,\n                \"price_matched\": order.average_price_matched,\n                \"size\": size,\n                \"size_matched\": float(order.size_matched),\n                \"side\": order.side,\n                \"market_type\": order.market_type,\n                \"elapsed_seconds_executable\": order.elapsed_seconds_executable,\n                \"customer_strategy_ref\": order.trade.strategy.name,\n                \"order_status\": order.status.value,\n                \"market_note\": order.trade.market_notes,\n                \"trade_notes\": order.trade.notes_str,\n                \"order_notes\": order.notes_str,\n                \"is_cleared_order\": True\n                if order.cleared_order\n                else False,  # it is either None or True, so need to coerce\n                **order.context,\n            }\n            updated_orders.append(order_data)\n\n        if updated_orders:\n            cleared_orders = [o for o in updated_orders if o[\"is_cleared_order\"]]\n            <http:\/\/logger.info|logger.info>(f\"Writing {len(cleared_orders)} cleared orders meta to S3\")\n            self.write_logs(data=updated_orders, write_table=\"cleared_orders_meta\")```",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gee4caf4e81f",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/ee4caf4e81ff96058a7d4a3efdf1a260.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "Johnny",
            "real_name": "Johnny Boston",
            "display_name": "",
            "team": "T4G9NBD2M",
            "name": "mike.breen.bbb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1702545412.369359",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "xh8S9",
                "elements": [
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n    def _process_cleared_orders_meta(self, event):\n        orders = event.event\n        updated_orders = []\n        for order in orders:\n            if order.order_type.ORDER_TYPE == OrderTypes.LIMIT:\n                size = order.order_type.size\n            else:\n                size = order.order_type.liability\n\n            if order.order_type.ORDER_TYPE == OrderTypes.MARKET_ON_CLOSE:\n                price = None\n            else:\n                price = order.order_type.price\n\n            order_data = {\n                \"bet_id\": order.bet_id,\n                \"market_id\": order.market_id,\n                \"selection_id\": order.selection_id,\n                \"trade_id\": order.trade.id,\n                \"date_time_placed\": order.responses.date_time_placed,\n                \"price\": price,\n                \"price_matched\": order.average_price_matched,\n                \"size\": size,\n                \"size_matched\": float(order.size_matched),\n                \"side\": order.side,\n                \"market_type\": order.market_type,\n                \"elapsed_seconds_executable\": order.elapsed_seconds_executable,\n                \"customer_strategy_ref\": order.trade.strategy.name,\n                \"order_status\": order.status.value,\n                \"market_note\": order.trade.market_notes,\n                \"trade_notes\": order.trade.notes_str,\n                \"order_notes\": order.notes_str,\n                \"is_cleared_order\": True\n                if order.cleared_order\n                else False,  # it is either None or True, so need to coerce\n                **order.context,\n            }\n            updated_orders.append(order_data)\n\n        if updated_orders:\n            cleared_orders = [o for o in updated_orders if o[\"is_cleared_order\"]]\n            logger.info(f\"Writing {len(cleared_orders)} cleared orders meta to S3\")\n            self.write_logs(data=updated_orders, write_table=\"cleared_orders_meta\")"
                            }
                        ],
                        "border": 0
                    }
                ]
            }
        ]
    },
    {
        "user": "U03QLPZQBLM",
        "type": "message",
        "ts": "1703062432.939609",
        "client_msg_id": "80c29117-b6a7-4c98-8928-8d7dcc6d62e4",
        "text": "pretty much your example to a T",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gee4caf4e81f",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/ee4caf4e81ff96058a7d4a3efdf1a260.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "Johnny",
            "real_name": "Johnny Boston",
            "display_name": "",
            "team": "T4G9NBD2M",
            "name": "mike.breen.bbb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1702545412.369359",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "8nyjH",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "pretty much your example to a T"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1703066105.392419",
        "client_msg_id": "481eed00-35f7-4223-b636-c19e532b81b8",
        "text": ":man-shrugging: works for me so will be something you aren't sharing, need some code that replicates it",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1702545412.369359",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "p1CNj",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "emoji",
                                "name": "man-shrugging",
                                "unicode": "1f937-200d-2642-fe0f"
                            },
                            {
                                "type": "text",
                                "text": " works for me so will be something you aren't sharing, need some code that replicates it"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U06A28BFYF4",
        "type": "message",
        "ts": "1703108215.515269",
        "client_msg_id": "31877189-20e6-47b1-a007-7b440a14694d",
        "text": "For soccer i can recommend this one: <https:\/\/rapidapi.com\/arbitrage-bettors1-arbitrage-bettors-default\/api\/odds-api1\/>",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "ff5cb17698be",
            "image_72": "https:\/\/avatars.slack-edge.com\/2023-12-13\/6354914748049_ff5cb17698be71ba30e4_72.png",
            "first_name": "Philipp",
            "real_name": "Philipp Schenk",
            "display_name": "Philipp Schenk",
            "team": "T4G9NBD2M",
            "name": "brv.vierer",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1702900488.236699",
        "parent_user_id": "U0659NXHTSR",
        "attachments": [
            {
                "from_url": "https:\/\/rapidapi.com\/arbitrage-bettors1-arbitrage-bettors-default\/api\/odds-api1\/",
                "thumb_url": "https:\/\/rapidapi.com\/static-assets\/default\/favicon-8e7d522e-653f-4edd-ac27-3f6ed950e45d.png",
                "thumb_width": 512,
                "thumb_height": 512,
                "service_icon": "https:\/\/rapidapi.com\/static-assets\/default\/favicon-8e7d522e-653f-4edd-ac27-3f6ed950e45d.png",
                "id": 1,
                "original_url": "https:\/\/rapidapi.com\/arbitrage-bettors1-arbitrage-bettors-default\/api\/odds-api1\/",
                "fallback": "RapidAPI: ODDS-API API Documentation (arbitrage-bettors1-arbitrage-bettors-default) | RapidAPI",
                "text": "REALTIME \/ ON-DEMAND! #1 Most Hated API by Bookmakers: Competitions, Matches, Odds &amp; Arbitrage Bets for 150+ bookies.",
                "title": "ODDS-API API Documentation (arbitrage-bettors1-arbitrage-bettors-default) | RapidAPI",
                "title_link": "https:\/\/rapidapi.com\/arbitrage-bettors1-arbitrage-bettors-default\/api\/odds-api1\/",
                "service_name": "RapidAPI"
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "wHGTG",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "For soccer i can recommend this one: "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/rapidapi.com\/arbitrage-bettors1-arbitrage-bettors-default\/api\/odds-api1\/"
                            }
                        ]
                    }
                ]
            }
        ],
        "reactions": [
            {
                "name": "pray",
                "users": [
                    "U0659NXHTSR"
                ],
                "count": 1
            },
            {
                "name": "raised_hands",
                "users": [
                    "U06A28BFYF4"
                ],
                "count": 1
            }
        ]
    }
]