[
    {
        "user": "U01DCR5PXDY",
        "type": "message",
        "ts": "1697971644.255359",
        "edited": {
            "user": "U01DCR5PXDY",
            "ts": "1697971833.000000"
        },
        "client_msg_id": "89cc4756-0aa2-4879-9430-4a36ba476fbc",
        "text": "Anyone aware of any published algorithm\/code for finding the exposure  in a given market (i.e. the amount that Betfair will subtract from your available to bet balance) given matched and unmatched orders?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "903bc20cd9db",
            "image_72": "https:\/\/avatars.slack-edge.com\/2020-10-26\/1448127317798_903bc20cd9dba9a758e0_72.png",
            "first_name": "thambie1",
            "real_name": "thambie1",
            "display_name": "thambie1",
            "team": "T4G9NBD2M",
            "name": "thambie1",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1697971644.255359",
        "reply_count": 3,
        "reply_users_count": 3,
        "latest_reply": "1698064475.492369",
        "reply_users": [
            "U05C31YKZ1C",
            "UPMUFSGCR",
            "U01DCR5PXDY"
        ],
        "replies": [
            {
                "user": "U05C31YKZ1C",
                "ts": "1697973791.625729"
            },
            {
                "user": "UPMUFSGCR",
                "ts": "1698015761.001279"
            },
            {
                "user": "U01DCR5PXDY",
                "ts": "1698064475.492369"
            }
        ],
        "is_locked": false,
        "subscribed": false,
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "syf1z",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Anyone aware of any published algorithm\/code for finding the exposure  in a given market (i.e. the amount that Betfair will subtract from your available to bet balance) given matched and unmatched orders?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U05C31YKZ1C",
        "type": "message",
        "ts": "1697973791.625729",
        "edited": {
            "user": "U05C31YKZ1C",
            "ts": "1697973857.000000"
        },
        "client_msg_id": "eb5a9c63-f039-4c94-89a3-2f3dc7dd4fc8",
        "text": "This is how  exposure is calculated in flumine.\n\n<https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/markets\/blotter.py#L185>",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g8823a6686ca",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/8823a6686ca88a27d29ac5c4a2518126.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "James",
            "real_name": "James",
            "display_name": "James",
            "team": "T4G9NBD2M",
            "name": "slack1995",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1697971644.255359",
        "parent_user_id": "U01DCR5PXDY",
        "attachments": [
            {
                "id": 1,
                "footer_icon": "https:\/\/slack.github.com\/static\/img\/favicon-neutral.png",
                "color": "24292f",
                "bot_id": "B021ZJYSBMW",
                "app_unfurl_url": "https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/markets\/blotter.py#L185",
                "is_app_unfurl": true,
                "app_id": "A01BP7R4KNY",
                "fallback": "<https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/markets\/blotter.py | blotter.py>",
                "text": "```\n    def get_exposures(self, strategy, lookup: tuple, exclusion=None) -> dict:\n```",
                "title": "<https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/markets\/blotter.py | blotter.py>",
                "footer": "<https:\/\/github.com\/betcode-org\/flumine|betcode-org\/flumine>",
                "mrkdwn_in": [
                    "text"
                ]
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Gqsb7",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "This is how  exposure is calculated in flumine.\n\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/markets\/blotter.py#L185"
                            }
                        ]
                    }
                ]
            }
        ],
        "reactions": [
            {
                "name": "+1",
                "users": [
                    "U01DCR5PXDY"
                ],
                "count": 1
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1697978507.470849",
        "client_msg_id": "28431e68-a8db-4022-a6d0-ab6a85bba2c7",
        "text": "are canceled orders still in the market_blotter? if so, whats their OrderStatus?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1697978507.470849",
        "reply_count": 2,
        "reply_users_count": 2,
        "latest_reply": "1698054056.759249",
        "reply_users": [
            "U05C31YKZ1C",
            "U01DVUAE2G1"
        ],
        "replies": [
            {
                "user": "U05C31YKZ1C",
                "ts": "1698006469.321859"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1698054056.759249"
            }
        ],
        "is_locked": false,
        "subscribed": false,
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "4yWZK",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "are canceled orders still in the market_blotter? if so, whats their OrderStatus?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U03N4QBJ0TV",
        "type": "message",
        "ts": "1697997715.769539",
        "edited": {
            "user": "U03N4QBJ0TV",
            "ts": "1697997870.000000"
        },
        "client_msg_id": "f8ff4ca1-7f2f-4b4d-a7ff-edf981fad352",
        "text": "Hey Guys. So the TLDR is the fix worked. Thanks very much.\n\nA few more details. I set up another instance and ran the patch on that one. I ran the same strategies at the same stakes on the patched instance as the for the unpatched instance. I couldn't get the install to work using the CLI even though everything seemed to download\/install ok so I manually overwrote the workers file using the updated workers file Lee created. It might not have worked via the CLI because I am inexperienced using GitHub so did something wrong.\n\nAll the printed results in the the patched instance had the 'profit' column in the csv filled in correctly. The unpatched instance displayed the same error as before with zeros in sometimes present in the profit column.\n\n• I have noticed that sometimes the same line or set of lines will be written twice. This occurs on both instances but not necessarily for the same results on each instance. My guess is its a different bug to the one that has just been fixed. It doesn't bother me as I only upload each unique bet id once to my results database. See below for an example from the patched instance. The same strategy executes on two markets but the results from the first market print again after the second.\n`325529200273,strat_x,1.219940406,6846739,e75cea8e-7019-11ee-b135-17589b09afd9,2023-10-21 13:58:25.603658,3.65,3.7,1,1,-1.0,BACK,0.034584,Execution complete,\"3.65,3.7,3.7\",,\"{'runner_id': 6846739}\"`\n\n`325538377913,strat_x,1.219940554,15914199,ca20765c-701e-11ee-b135-17589b09afd9,2023-10-21 14:33:24.004443,3.4,3.4,1,1,-1.0,BACK,0.021638,Execution complete,\"3.4,3.45,3.45\",,\"{'runner_id': 15914199}\"`\n\n`325529200273,strat_x,1.219940406,6846739,e75cea8e-7019-11ee-b135-17589b09afd9,2023-10-21 13:58:25.603658,3.65,3.7,1,1,-1.0,BACK,0.034584,Execution complete,\"3.65,3.7,3.7\",,\"{'runner_id': 6846739}\"`\n\n\n• A strategy that was active on both instances and fired on both instances over the two day test period fired on one extra market on the patched instance than on the un patched instance. Uncertain why this happened, possible could be strategy related so will need to look into the code to see. \nI will leave the two instances running the next few days to see what is generated. The unpatches instance is one I use at low stakes for my test strategies. I will be upgrading my main instance to the new patch of the back of these results.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g2c8538b47ad",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/2c8538b47ad4bed6facbb148134bb486.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0020-72.png",
            "first_name": "Trex44",
            "real_name": "Trex44",
            "display_name": "Trex44",
            "team": "T4G9NBD2M",
            "name": "c.s.mpharm",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1695833301.467429",
        "parent_user_id": "U03N4QBJ0TV",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "NkTJl",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Hey Guys. So the TLDR is the fix worked. Thanks very much.\n\nA few more details. I set up another instance and ran the patch on that one. I ran the same strategies at the same stakes on the patched instance as the for the unpatched instance. I couldn't get the install to work using the CLI even though everything seemed to download\/install ok so I manually overwrote the workers file using the updated workers file Lee created. It might not have worked via the CLI because I am inexperienced using GitHub so did something wrong.\n\nAll the printed results in the the patched instance had the 'profit' column in the csv filled in correctly. The unpatched instance displayed the same error as before with zeros in sometimes present in the profit column.\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_list",
                        "elements": [
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "I have noticed that sometimes the same line or set of lines will be written twice. This occurs on both instances but not necessarily for the same results on each instance. My guess is its a different bug to the one that has just been fixed. It doesn't bother me as I only upload each unique bet id once to my results database. See below for an example from the patched instance. The same strategy executes on two markets but the results from the first market print again after the second."
                                    }
                                ]
                            }
                        ],
                        "style": "bullet",
                        "indent": 0,
                        "border": 0
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "325529200273,strat_x,1.219940406,6846739,e75cea8e-7019-11ee-b135-17589b09afd9,2023-10-21 13:58:25.603658,3.65,3.7,1,1,-1.0,BACK,0.034584,Execution complete,\"3.65,3.7,3.7\",,\"{'runner_id': 6846739}\"",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n\n"
                            },
                            {
                                "type": "text",
                                "text": "325538377913,strat_x,1.219940554,15914199,ca20765c-701e-11ee-b135-17589b09afd9,2023-10-21 14:33:24.004443,3.4,3.4,1,1,-1.0,BACK,0.021638,Execution complete,\"3.4,3.45,3.45\",,\"{'runner_id': 15914199}\"",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n\n"
                            },
                            {
                                "type": "text",
                                "text": "325529200273,strat_x,1.219940406,6846739,e75cea8e-7019-11ee-b135-17589b09afd9,2023-10-21 13:58:25.603658,3.65,3.7,1,1,-1.0,BACK,0.034584,Execution complete,\"3.65,3.7,3.7\",,\"{'runner_id': 6846739}\"",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_list",
                        "elements": [
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "A strategy that was active on both instances and fired on both instances over the two day test period fired on one extra market on the patched instance than on the un patched instance. Uncertain why this happened, possible could be strategy related so will need to look into the code to see. "
                                    }
                                ]
                            }
                        ],
                        "style": "bullet",
                        "indent": 0,
                        "border": 0
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\nI will leave the two instances running the next few days to see what is generated. The unpatches instance is one I use at low stakes for my test strategies. I will be upgrading my main instance to the new patch of the back of these results."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U05C31YKZ1C",
        "type": "message",
        "ts": "1698006469.321859",
        "client_msg_id": "1f2a2525-1c9e-41d9-8bd7-3d0386c9dbf2",
        "text": "<https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/order\/order.py#L28>\n\nHere is the OrderStatus definition.\nNote that there are live and complete statuses.\n\nAn order is execution_complete when there is nothing left to be matched. That could be because it has all been matched, or some combination of matched, lapsed, cancelled and voided.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g8823a6686ca",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/8823a6686ca88a27d29ac5c4a2518126.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "James",
            "real_name": "James",
            "display_name": "James",
            "team": "T4G9NBD2M",
            "name": "slack1995",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1697978507.470849",
        "parent_user_id": "U01DVUAE2G1",
        "attachments": [
            {
                "id": 1,
                "footer_icon": "https:\/\/slack.github.com\/static\/img\/favicon-neutral.png",
                "color": "24292f",
                "bot_id": "B021ZJYSBMW",
                "app_unfurl_url": "https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/order\/order.py#L28",
                "is_app_unfurl": true,
                "app_id": "A01BP7R4KNY",
                "fallback": "<https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/order\/order.py | order.py>",
                "text": "```\nclass OrderStatus(Enum):\n```",
                "title": "<https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/order\/order.py | order.py>",
                "footer": "<https:\/\/github.com\/betcode-org\/flumine|betcode-org\/flumine>",
                "mrkdwn_in": [
                    "text"
                ]
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "tXYu0",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/order\/order.py#L28"
                            },
                            {
                                "type": "text",
                                "text": "\n\nHere is the OrderStatus definition.\nNote that there are live and complete statuses.\n\nAn order is execution_complete when there is nothing left to be matched. That could be because it has all been matched, or some combination of matched, lapsed, cancelled and voided."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UPMUFSGCR",
        "type": "message",
        "ts": "1698015761.001279",
        "client_msg_id": "951d5c81-74d2-4a18-8dd2-f365a818692b",
        "text": "Will you need to consider the `market_exposure` method from that module?\n\n<https:\/\/github.com\/betcode-org\/flumine\/pull\/517>",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "31c0bb5a442c",
            "image_72": "https:\/\/avatars.slack-edge.com\/2019-10-28\/812386967189_31c0bb5a442c5b8d2c61_72.png",
            "first_name": "Jon",
            "real_name": "Jon Jon Jon Jon Jon Jon Jon Jon",
            "display_name": "Jonjonjon",
            "team": "T4G9NBD2M",
            "name": "fcmisc",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1697971644.255359",
        "parent_user_id": "U01DCR5PXDY",
        "attachments": [
            {
                "id": 1,
                "footer_icon": "https:\/\/slack.github.com\/static\/img\/favicon-neutral.png",
                "ts": 1635233006,
                "color": "6f42c1",
                "bot_id": "B021ZJYSBMW",
                "app_unfurl_url": "https:\/\/github.com\/betcode-org\/flumine\/pull\/517",
                "is_app_unfurl": true,
                "app_id": "A01BP7R4KNY",
                "fallback": "#517 Extend selection exposures to whole market",
                "text": "Builds on the existing selection exposure calculations (which does the heavy lifting) to derive the worst case outcome (exposure) for the whole market.\n\nThe underlying approach is to sum all potential losses and then adjust to reflect the worst case for the given number of winners in the market.\n\nLimitations: this will not work for multi-line markets (e,g, each way, or most asian handicaps) or markets with a variable number of winners such as correct score for which Betfair treats each line as a separate market.",
                "title": "#517 Extend selection exposures to whole market",
                "title_link": "https:\/\/github.com\/betcode-org\/flumine\/pull\/517",
                "footer": "<https:\/\/github.com\/betcode-org\/flumine|betcode-org\/flumine>",
                "fields": [
                    {
                        "value": "1",
                        "title": "Comments",
                        "short": true
                    }
                ],
                "mrkdwn_in": [
                    "text"
                ]
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "xBGbA",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Will you need to consider the "
                            },
                            {
                                "type": "text",
                                "text": "market_exposure",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " method from that module?\n\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/betcode-org\/flumine\/pull\/517"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]