[
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1685518315.972639",
        "client_msg_id": "aba5566a-c6ce-40c0-9603-f5b46d7abd86",
        "text": "So on the initial image you get the streaming definition, so you could do something like this:\n\n```    def process_raw_data(self, clk: str, publish_time: int, data: dict):\n        market_id = data.get(self.MARKET_ID_LOOKUP)\n\n        if \"marketDefinition\" in data:\n            if data[\"marketDefinition\"][\"venue\"] == \"Ripon\":\n                if market_id not in self.markets_i_want_to_process:\n                    self.markets_i_want_to_process.append(market_id)\n\n        if market_id not in self.markets_i_want_to_process:\n            return\n\n        file_directory = os.path.join(self.local_dir, self.recorder_id, market_id)\n        with open(file_directory, \"a\") as f:\n            f.write(\n                json.dumps(\n                    {\"op\": \"mcm\", \"clk\": clk, \"pt\": publish_time, \"mc\": [data]},\n                    separators=(\",\", \":\"),\n                )\n                + \"\\n\"\n            )```\n",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685450049.669179",
        "parent_user_id": "U0155J92A7Q",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "VSsg3",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "So on the initial image you get the streaming definition, so you could do something like this:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "    def process_raw_data(self, clk: str, publish_time: int, data: dict):\n        market_id = data.get(self.MARKET_ID_LOOKUP)\n\n        if \"marketDefinition\" in data:\n            if data[\"marketDefinition\"][\"venue\"] == \"Ripon\":\n                if market_id not in self.markets_i_want_to_process:\n                    self.markets_i_want_to_process.append(market_id)\n\n        if market_id not in self.markets_i_want_to_process:\n            return\n\n        file_directory = os.path.join(self.local_dir, self.recorder_id, market_id)\n        with open(file_directory, \"a\") as f:\n            f.write(\n                json.dumps(\n                    {\"op\": \"mcm\", \"clk\": clk, \"pt\": publish_time, \"mc\": [data]},\n                    separators=(\",\", \":\"),\n                )\n                + \"\\n\"\n            )"
                            }
                        ],
                        "border": 0
                    },
                    {
                        "type": "rich_text_section",
                        "elements": []
                    }
                ]
            }
        ],
        "reactions": [
            {
                "name": "raised_hands",
                "users": [
                    "U0155J92A7Q"
                ],
                "count": 1
            }
        ]
    },
    {
        "user": "U0155J92A7Q",
        "type": "message",
        "ts": "1685522816.790639",
        "client_msg_id": "9e7c4c63-c5ee-4369-bb1b-0e86d6b7a929",
        "text": "Awesome, thanks liam!",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gde8c5d51af5",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/de8c5d51af54a5ac7b501f416ddb262c.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "",
            "real_name": "Jorge",
            "display_name": "Jorge",
            "team": "T4G9NBD2M",
            "name": "jgarciam95",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685450049.669179",
        "parent_user_id": "U0155J92A7Q",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "EX6",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Awesome, thanks liam!"
                            }
                        ]
                    }
                ]
            }
        ],
        "reactions": [
            {
                "name": "+1",
                "users": [
                    "U4H19D1D2"
                ],
                "count": 1
            }
        ]
    },
    {
        "user": "U0155J92A7Q",
        "type": "message",
        "ts": "1685523248.813299",
        "client_msg_id": "d4104752-49c6-40a8-895f-da22db410dff",
        "text": "But in the marketDefinition I don't have the market.event_name",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gde8c5d51af5",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/de8c5d51af54a5ac7b501f416ddb262c.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "",
            "real_name": "Jorge",
            "display_name": "Jorge",
            "team": "T4G9NBD2M",
            "name": "jgarciam95",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685450049.669179",
        "parent_user_id": "U0155J92A7Q",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "RSn9b",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "But in the marketDefinition I don't have the market.event_name"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U0155J92A7Q",
        "type": "message",
        "ts": "1685523302.592359",
        "client_msg_id": "6c9e5156-1144-4b18-b585-7d67bda2487f",
        "text": "Does the marketrecorder run _poll_market_catalogue?_",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gde8c5d51af5",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/de8c5d51af54a5ac7b501f416ddb262c.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "",
            "real_name": "Jorge",
            "display_name": "Jorge",
            "team": "T4G9NBD2M",
            "name": "jgarciam95",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685450049.669179",
        "parent_user_id": "U0155J92A7Q",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "8dpLp",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Does the marketrecorder run "
                            },
                            {
                                "type": "text",
                                "text": "poll_market_catalogue?",
                                "style": {
                                    "italic": true
                                }
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1685523372.210139",
        "client_msg_id": "c7d7f29a-e20f-4aa0-bc61-e4057f09f92e",
        "text": "yeah",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685450049.669179",
        "parent_user_id": "U0155J92A7Q",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "3yE",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "yeah"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U0155J92A7Q",
        "type": "message",
        "ts": "1685523518.189169",
        "edited": {
            "user": "U0155J92A7Q",
            "ts": "1685523553.000000"
        },
        "client_msg_id": "45ae0dba-88e8-48f9-a238-bfae8db252e2",
        "text": "I see it is running it. But does the market_catalogue come ever to process_raw_data?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gde8c5d51af5",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/de8c5d51af54a5ac7b501f416ddb262c.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "",
            "real_name": "Jorge",
            "display_name": "Jorge",
            "team": "T4G9NBD2M",
            "name": "jgarciam95",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685450049.669179",
        "parent_user_id": "U0155J92A7Q",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "75900",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I see it is running it. But does the market_catalogue come ever to process_raw_data?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "text": "No but you could modify it like this so you get the `Market` object (`call_process_raw_data` needs to be changed as well)",
        "files": [
            {
                "id": "F05A1TZ2WA2",
                "mode": "hidden_by_limit"
            }
        ],
        "upload": false,
        "user": "U4H19D1D2",
        "display_as_bot": false,
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "RRhF",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "No but you could modify it like this so you get the "
                            },
                            {
                                "type": "text",
                                "text": "Market",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " object ("
                            },
                            {
                                "type": "text",
                                "text": "call_process_raw_data",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " needs to be changed as well)"
                            }
                        ]
                    }
                ]
            }
        ],
        "type": "message",
        "ts": "1685523677.875669",
        "client_msg_id": "7fb916ca-6d38-4327-8652-8e514bb99ee3",
        "thread_ts": "1685450049.669179",
        "parent_user_id": "U0155J92A7Q"
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1685523728.877789",
        "client_msg_id": "cc8cbfe0-6694-4d30-9b40-15729ed52757",
        "text": "But this opens up a few issues as the catalogue worker takes a few seconds to start whereas the recorder starts straight away",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685450049.669179",
        "parent_user_id": "U0155J92A7Q",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "kVR=N",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "But this opens up a few issues as the catalogue worker takes a few seconds to start whereas the recorder starts straight away"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U0155J92A7Q",
        "type": "message",
        "ts": "1685524792.497429",
        "client_msg_id": "27661595-92cd-4b23-a2a8-ca954f8fbe8c",
        "text": "Great, thanks, I will try this out!",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gde8c5d51af5",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/de8c5d51af54a5ac7b501f416ddb262c.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "",
            "real_name": "Jorge",
            "display_name": "Jorge",
            "team": "T4G9NBD2M",
            "name": "jgarciam95",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685450049.669179",
        "parent_user_id": "U0155J92A7Q",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "cwYx",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Great, thanks, I will try this out!"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U0322P0CK0E",
        "type": "message",
        "ts": "1685589974.382599",
        "client_msg_id": "607519a5-52b9-4927-ae21-718cee49b001",
        "text": "If a market is very active it's possible multiple trades happen between each time process_market_book is called. I am currently looking at runner.ex.traded_volume, what is the best way to find the all the price points and associated traded volumes between each time process market book is called?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "ab1918814707",
            "image_72": "https:\/\/avatars.slack-edge.com\/2022-07-31\/3867647231206_ab191881470773932048_72.jpg",
            "first_name": "Vincent",
            "real_name": "Vincent Lim",
            "display_name": "Guy Incognito",
            "team": "T4G9NBD2M",
            "name": "nelsonmathsspecialist",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685589974.382599",
        "reply_count": 1,
        "reply_users_count": 1,
        "latest_reply": "1685595143.702509",
        "reply_users": [
            "UBS7QANF3"
        ],
        "replies": [
            {
                "user": "UBS7QANF3",
                "ts": "1685595143.702509"
            }
        ],
        "is_locked": false,
        "subscribed": false,
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "DFz",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "If a market is very active it's possible multiple trades happen between each time process_market_book is called. I am currently looking at runner.ex.traded_volume, what is the best way to find the all the price points and associated traded volumes between each time process market book is called?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UBS7QANF3",
        "type": "message",
        "ts": "1685595143.702509",
        "client_msg_id": "89b5f4cf-c5e0-493c-ad42-7d79c4e04728",
        "text": "Take a look at the calculate_market_book_diff function in betfairutil and associated MarketBookDiff object: <https:\/\/github.com\/mberk\/betfairutil\/blob\/5c9d9823ab8241c678916c13107aedba58cfe88f\/betfairutil\/__init__.py#L1600-L1650>",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gaaf844a4a90",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/eaaf844a4a905431d83430e563b077aa.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0011-72.png",
            "first_name": "",
            "real_name": "Maurice Berk",
            "display_name": "Mo",
            "team": "T4G9NBD2M",
            "name": "maurice",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685589974.382599",
        "parent_user_id": "U0322P0CK0E",
        "attachments": [
            {
                "id": 1,
                "footer_icon": "https:\/\/slack.github.com\/static\/img\/favicon-neutral.png",
                "color": "24292f",
                "bot_id": "B021ZJYSBMW",
                "app_unfurl_url": "https:\/\/github.com\/mberk\/betfairutil\/blob\/5c9d9823ab8241c678916c13107aedba58cfe88f\/betfairutil\/__init__.py#L1600-L1650",
                "is_app_unfurl": true,
                "app_id": "A01BP7R4KNY",
                "fallback": "<https:\/\/github.com\/mberk\/betfairutil\/blob\/5c9d9823ab8241c678916c13107aedba58cfe88f\/betfairutil\/__init__.py | __init__.py>",
                "text": "```\ndef calculate_market_book_diff(\n    current_market_book: Union[Dict[str, Any], MarketBook],\n    previous_market_book: Union[Dict[str, Any], MarketBook],\n) -> MarketBookDiff:\n    \"\"\"\n    Calculate the size differences between amounts available to back, available to lay, and traded between two market books\n\n    :param current_market_book: The current market book to use in the comparison\n    :param previous_market_book: The previous market book to use in the comparison\n    :return: The complete set of size differences stored in a MarketBookDiff\n    \"\"\"\n    if isinstance(current_market_book, MarketBook):\n        current_market_book = current_market_book._data\n    if isinstance(previous_market_book, MarketBook):\n        previous_market_book = previous_market_book._data\n\n    diff = {\n        (runner[\"selectionId\"], runner[\"handicap\"]): {ex_key: {} for ex_key in EX_KEYS}\n        for runner in current_market_book[\"runners\"]\n    }\n\n    for current_runner in current_market_book[\"runners\"]:\n        previous_runner = get_runner_book_from_market_book(\n            previous_market_book,\n            current_runner[\"selectionId\"],\n            handicap=current_runner[\"handicap\"],\n        )\n        if current_runner == previous_runner:\n            continue\n\n        for ex_key in EX_KEYS:\n            previous_prices = {\n                price_size[\"price\"]: price_size[\"size\"]\n                for price_size in previous_runner.get(\"ex\", {}).get(ex_key, [])\n            }\n            current_prices = {\n                price_size[\"price\"]: price_size[\"size\"]\n                for price_size in current_runner.get(\"ex\", {}).get(ex_key, [])\n            }\n            all_prices = set(itertools.chain(previous_prices, current_prices))\n\n            for price in all_prices:\n                previous_size = previous_prices.get(price, 0)\n                current_size = current_prices.get(price, 0)\n                delta = round(current_size - previous_size, 2)\n\n                diff[(current_runner[\"selectionId\"], current_runner[\"handicap\"])][\n                    ex_key\n                ][price] = delta\n\n    return MarketBookDiff(diff)\n```",
                "title": "<https:\/\/github.com\/mberk\/betfairutil\/blob\/5c9d9823ab8241c678916c13107aedba58cfe88f\/betfairutil\/__init__.py | __init__.py>",
                "footer": "<https:\/\/github.com\/mberk\/betfairutil|mberk\/betfairutil>",
                "mrkdwn_in": [
                    "text"
                ]
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "\/uG",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Take a look at the calculate_market_book_diff function in betfairutil and associated MarketBookDiff object: "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/mberk\/betfairutil\/blob\/5c9d9823ab8241c678916c13107aedba58cfe88f\/betfairutil\/__init__.py#L1600-L1650"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]