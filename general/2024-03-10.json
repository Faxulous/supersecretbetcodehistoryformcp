[
    {
        "text": "Is there a way to run a simulation of, say, 5 strategies on the same list of markets? In a way that a market gets processed once while all 5 strategies get applied.\n\nLooking at Github example, it makes me think that perhaps each strategy has an independent list of markets, so they would get looped through 5 times, once per strategy.",
        "files": [
            {
                "id": "F06NL0GPEK0",
                "mode": "hidden_by_limit"
            }
        ],
        "upload": false,
        "user": "USWDY5P7G",
        "display_as_bot": false,
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "5LJOG",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Is there a way to run a simulation of, say, 5 strategies on the same list of markets? In a way that a market gets processed once while all 5 strategies get applied.\n\nLooking at Github example, it makes me think that perhaps each strategy has an independent list of markets, so they would get looped through 5 times, once per strategy."
                            }
                        ]
                    }
                ]
            }
        ],
        "type": "message",
        "ts": "1710062512.316679",
        "client_msg_id": "C159C73C-92DB-4F2B-924F-24AF86898166",
        "thread_ts": "1710062512.316679",
        "reply_count": 3,
        "reply_users_count": 3,
        "latest_reply": "1710069899.529679",
        "reply_users": [
            "U4H19D1D2",
            "U02RN7YDRQ9",
            "USWDY5P7G"
        ],
        "replies": [
            {
                "user": "U4H19D1D2",
                "ts": "1710067590.292309"
            },
            {
                "user": "U02RN7YDRQ9",
                "ts": "1710067858.510429"
            },
            {
                "user": "USWDY5P7G",
                "ts": "1710069899.529679"
            }
        ],
        "is_locked": false,
        "subscribed": true,
        "last_read": "1710069899.529679"
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1710067590.292309",
        "client_msg_id": "D8BA8527-3651-4E5F-A0D7-4A5B5FD4BFE9",
        "text": "It will do what you want by default, if the market filter matches on each strategy they will ‘share’ the updates ",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1710062512.316679",
        "parent_user_id": "USWDY5P7G",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "uH7HO",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "It will do what you want by default, if the market filter matches on each strategy they will ‘share’ the updates "
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U02RN7YDRQ9",
        "type": "message",
        "ts": "1710067858.510429",
        "client_msg_id": "4f7ce4b4-3628-43d7-bd04-ef1e22799f26",
        "text": "Just construct and add all strategies to the framework before calling `framework.run()`\nAll bets on the market regardless of strategy end up in `market.blotter`",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "ge46f1f8b708",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/e46f1f8b708a630e3191de7b2c42b1d1.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "edblock",
            "real_name": "edblock",
            "display_name": "foxwood",
            "team": "T4G9NBD2M",
            "name": "eanb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1710062512.316679",
        "parent_user_id": "USWDY5P7G",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "P2pcM",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Just construct and add all strategies to the framework before calling "
                            },
                            {
                                "type": "text",
                                "text": "framework.run()",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\nAll bets on the market regardless of strategy end up in "
                            },
                            {
                                "type": "text",
                                "text": "market.blotter",
                                "style": {
                                    "code": true
                                }
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "USWDY5P7G",
        "type": "message",
        "ts": "1710069899.529679",
        "client_msg_id": "335892D7-2733-43E5-BE0F-E9EEEB01ABAB",
        "text": "Nice one, thanks guys",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "693b14d0cc42",
            "image_72": "https:\/\/avatars.slack-edge.com\/2021-08-29\/2425858826214_693b14d0cc42bdbfb86a_72.jpg",
            "first_name": "Fab",
            "real_name": "Fab",
            "display_name": "Fab",
            "team": "T4G9NBD2M",
            "name": "me1",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1710062512.316679",
        "parent_user_id": "USWDY5P7G",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Vp0KM",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "N"
                            },
                            {
                                "type": "text",
                                "text": "ice one, thanks guys"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U0476CG183A",
        "type": "message",
        "ts": "1710135374.098109",
        "client_msg_id": "bb58eeb5-8f49-420e-a20f-a2187f1d4d7e",
        "text": "Hi,\nI'm using the example code here: <https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/examples\/middleware\/orders.py>\nI'm getting the below error:\n\n```betfairlightweight.exceptions.APIError: SportsAPING\/v1.0\/listCurrentOrders\nParams: {'orderProjection': 'EXECUTION_COMPLETE', 'customerStrategyRefs': ['MELWKS-4535'], 'dateRange': {'from': None, 'to': None}}\nException: None\nError: {'code': -32099, 'message': 'ANGX-0005', 'data': {'APINGException': {'requestUUID': 'ie2-ang14b-prd-01291035-005af2205e', 'errorCode': 'NO_SESSION', 'errorDetails': ''}, 'exceptionname': 'APINGException'}}\nFull Response: {'jsonrpc': '2.0', 'error': {'code': -32099, 'message': 'ANGX-0005', 'data': {'APINGException': {'requestUUID': 'ie2-ang14b-prd-01291035-005af2205e', 'errorCode': 'NO_SESSION', 'errorDetails': ''}, 'exceptionname': 'APINGException'}}, 'id': 1}```\nI'm able to use Flumine without the middleware and am only getting the error when calling listCurrentOrders",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g9cca9b61659",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/9cca9b616592f1b8e24755f8591d2049.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0019-72.png",
            "first_name": "GrimReaper",
            "real_name": "GrimReaper",
            "display_name": "Herugrim",
            "team": "T4G9NBD2M",
            "name": "mitchell.motyka",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1710135374.098109",
        "reply_count": 3,
        "reply_users_count": 2,
        "latest_reply": "1710227462.834909",
        "reply_users": [
            "U4H19D1D2",
            "U0476CG183A"
        ],
        "replies": [
            {
                "user": "U4H19D1D2",
                "ts": "1710146789.885569"
            },
            {
                "user": "U0476CG183A",
                "ts": "1710203945.192899"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1710227462.834909"
            }
        ],
        "is_locked": false,
        "subscribed": true,
        "last_read": "1710227462.834909",
        "attachments": [
            {
                "id": 1,
                "footer_icon": "https:\/\/slack.github.com\/static\/img\/favicon-neutral.png",
                "color": "24292f",
                "bot_id": "B021ZJYSBMW",
                "app_unfurl_url": "https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/examples\/middleware\/orders.py",
                "is_app_unfurl": true,
                "app_id": "A01BP7R4KNY",
                "fallback": "<https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/examples\/middleware\/orders.py | orders.py>",
                "text": "```\nimport logging\nfrom flumine import config\nfrom flumine.utils import STRATEGY_NAME_HASH_LENGTH\nfrom flumine.markets.middleware import Middleware\nfrom flumine.order.trade import Trade\n\nlogger = logging.getLogger(__name__)\n\n\nclass OrdersMiddleware(Middleware):\n    \"\"\"\n    Middleware to add execution complete orders\n    to the blotter. This is required on a restart\n    as the order stream does not include\n    EXECUTION_COMPLETE orders\n    \"\"\"\n\n    def __init__(self, flumine):\n        self.flumine = flumine\n\n    def add_market(self, market) -> None:\n        for client in self.flumine.clients:\n            resp = client.betting_client.betting.list_current_orders(\n                customer_strategy_refs=[config.customer_strategy_ref],\n                order_projection=\"EXECUTION_COMPLETE\",\n            )\n            for current_order in resp.orders:\n                <http:\/\/logger.info|logger.info>(\n                    \"OrdersMiddleware: Processing order %s\",\n                    current_order.bet_id,\n                    extra={\n                        \"bet_id\": current_order.bet_id,\n                        \"market_id\": current_order.market_id,\n                        \"customer_strategy_ref\": current_order.customer_strategy_ref,\n                        \"customer_order_ref\": current_order.customer_order_ref,\n                        \"client_username\": client.username,\n                    },\n                )\n                order = self._create_order_from_current(client, current_order, market)\n                if order:\n                    order.update_current_order(current_order)\n                    order.execution_complete()\n\n    def _create_order_from_current(self, client, current_order, market):\n        strategy_name_hash = current_order.customer_order_ref[\n            :STRATEGY_NAME_HASH_LENGTH\n        ]\n        order_id = current_order.customer_order_ref[STRATEGY_NAME_HASH_LENGTH + 1 :]\n        # get strategy\n        strategy = self.flumine.strategies.hashes.get(strategy_name_hash)\n        if strategy is None:\n            logger.warning(\n                \"OrdersMiddleware: Strategy not available to create order %s\",\n                order_id,\n                extra={\n                    \"bet_id\": current_order.bet_id,\n                    \"market_id\": current_order.market_id,\n                    \"customer_strategy_ref\": current_order.customer_strategy_ref,\n                    \"customer_order_ref\": current_order.customer_order_ref,\n                    \"strategy_name\": str(strategy),\n                    \"client_username\": client.username,\n                },\n            )\n            return\n        # add trade\/order\n        trade = Trade(\n            market.market_id,\n            current_order.selection_id,\n            current_order.handicap,\n            strategy,\n        )\n        order = trade.create_order_from_current(client, current_order, order_id)\n        market.blotter[order.id] = order\n        runner_context = strategy.get_runner_context(*order.lookup)\n        runner_context.place(trade.id)\n        <http:\/\/logger.info|logger.info>(\n            \"OrdersMiddleware: New order trade created\",\n            extra={\n                \"bet_id\": current_order.bet_id,\n                \"market_id\": current_order.market_id,\n                \"customer_strategy_ref\": current_order.customer_strategy_ref,\n                \"customer_order_ref\": current_order.customer_order_ref,\n                \"strategy_name\": str(strategy),\n                \"client_username\": client.username,\n            },\n        )\n        return order\n\n```",
                "title": "<https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/examples\/middleware\/orders.py | orders.py>",
                "footer": "<https:\/\/github.com\/betcode-org\/flumine|betcode-org\/flumine>",
                "mrkdwn_in": [
                    "text"
                ]
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "3+r1G",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Hi,\nI'm using the example code here: "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/examples\/middleware\/orders.py"
                            },
                            {
                                "type": "text",
                                "text": "\nI'm getting the below error:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "betfairlightweight.exceptions.APIError: SportsAPING\/v1.0\/listCurrentOrders\nParams: {'orderProjection': 'EXECUTION_COMPLETE', 'customerStrategyRefs': ['MELWKS-4535'], 'dateRange': {'from': None, 'to': None}}\nException: None\nError: {'code': -32099, 'message': 'ANGX-0005', 'data': {'APINGException': {'requestUUID': 'ie2-ang14b-prd-01291035-005af2205e', 'errorCode': 'NO_SESSION', 'errorDetails': ''}, 'exceptionname': 'APINGException'}}\nFull Response: {'jsonrpc': '2.0', 'error': {'code': -32099, 'message': 'ANGX-0005', 'data': {'APINGException': {'requestUUID': 'ie2-ang14b-prd-01291035-005af2205e', 'errorCode': 'NO_SESSION', 'errorDetails': ''}, 'exceptionname': 'APINGException'}}, 'id': 1}"
                            }
                        ],
                        "border": 0
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I'm able to use Flumine without the middleware and am only getting the error when calling listCurrentOrders"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]