[
    {
        "user": "U03QLPZQBLM",
        "type": "message",
        "ts": "1660277299.898799",
        "client_msg_id": "739cdc2f-de66-4afe-a5d0-35cb7e83da7e",
        "text": "Hey - I am trying to record the `last price traded` for a runner before the market goes in play.\n\nThe way I am doing this is by recording all the Market iterations to a csv and then when *`process_closed_market`* is called in my recording strategy, I find the last publish time from the csv. Problem is this is showing some very strange figures, with `last price traded` wildly different to `bsp`  so I am definitely doing something wrong.\n\nIs there an easier way to do this after a market has closed? to find the `last_traded_price` before market goes in play? or do I just need to find a better solution to my problem ?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gee4caf4e81f",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/ee4caf4e81ff96058a7d4a3efdf1a260.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "Johnny",
            "real_name": "Johnny Boston",
            "display_name": "",
            "team": "T4G9NBD2M",
            "name": "mike.breen.bbb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1660277299.898799",
        "reply_count": 11,
        "reply_users_count": 3,
        "latest_reply": "1660294728.413369",
        "reply_users": [
            "U016TGY3676",
            "U03QLPZQBLM",
            "U9JHLMZB4"
        ],
        "replies": [
            {
                "user": "U016TGY3676",
                "ts": "1660285857.026419"
            },
            {
                "user": "U03QLPZQBLM",
                "ts": "1660286146.006489"
            },
            {
                "user": "U03QLPZQBLM",
                "ts": "1660286217.095989"
            },
            {
                "user": "U03QLPZQBLM",
                "ts": "1660286440.784599"
            },
            {
                "user": "U016TGY3676",
                "ts": "1660286725.360959"
            },
            {
                "user": "U03QLPZQBLM",
                "ts": "1660287072.491129"
            },
            {
                "user": "U016TGY3676",
                "ts": "1660287586.221049"
            },
            {
                "user": "U03QLPZQBLM",
                "ts": "1660287627.374749"
            },
            {
                "user": "U016TGY3676",
                "ts": "1660287717.385819"
            },
            {
                "user": "U03QLPZQBLM",
                "ts": "1660288080.792189"
            },
            {
                "user": "U9JHLMZB4",
                "ts": "1660294728.413369"
            }
        ],
        "is_locked": false,
        "subscribed": false,
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "\/Iuks",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Hey - I am trying to record the "
                            },
                            {
                                "type": "text",
                                "text": "last price traded",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " for a runner before the market goes in play.\n\nThe way I am doing this is by recording all the Market iterations to a csv and then when "
                            },
                            {
                                "type": "text",
                                "text": "process_closed_market",
                                "style": {
                                    "bold": true,
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " ",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "is called in my recording strategy, I find the last publish time from the csv. Problem is this is showing some very strange figures, with "
                            },
                            {
                                "type": "text",
                                "text": "last price traded",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " wildly different to "
                            },
                            {
                                "type": "text",
                                "text": "bsp",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "  so I am definitely doing something wrong.\n\nIs there an easier way to do this after a market has closed? to find the "
                            },
                            {
                                "type": "text",
                                "text": "last_traded_price",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " before market goes in play? or do I just need to find a better solution to my problem ?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U016TGY3676",
        "type": "message",
        "ts": "1660285857.026419",
        "client_msg_id": "084ff634-ea44-42e7-af33-5bb88be164bf",
        "text": "`if not market_book.inplay:\n    for r in market_book.runners:`\n        `market.context['ltps'][r.selection_id] = r.last_price_traded`\n\nYou can then pick it up on closure.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g6a681220e11",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/6a681220e11c1a2ed3685375d658dadb.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0001-72.png",
            "first_name": "",
            "real_name": "birchy",
            "display_name": "birchy",
            "team": "T4G9NBD2M",
            "name": "birchy",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1660277299.898799",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "e0c",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "if not market_book.inplay:\n",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "    for r in market_book.runners:",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "text",
                                "text": "        market.context['ltps'][r.selection_id] = r.last_price_traded\n",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\nYou can then pick it up on closure."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U03QLPZQBLM",
        "type": "message",
        "ts": "1660286146.006489",
        "edited": {
            "user": "U03QLPZQBLM",
            "ts": "1660286151.000000"
        },
        "client_msg_id": "a849e257-0b90-4af2-9d74-66a1b45ccbf0",
        "text": "you are manually saving it to context?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gee4caf4e81f",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/ee4caf4e81ff96058a7d4a3efdf1a260.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "Johnny",
            "real_name": "Johnny Boston",
            "display_name": "",
            "team": "T4G9NBD2M",
            "name": "mike.breen.bbb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1660277299.898799",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Hu3",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "you are manually saving it to context?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U03QLPZQBLM",
        "type": "message",
        "ts": "1660286217.095989",
        "client_msg_id": "97682f5e-ce7d-430d-8c1d-db43426a040f",
        "text": "that `r.last_price_traded` you are referencing would be the last traded price `in_play` not `pre_play`  like I am after...",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gee4caf4e81f",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/ee4caf4e81ff96058a7d4a3efdf1a260.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "Johnny",
            "real_name": "Johnny Boston",
            "display_name": "",
            "team": "T4G9NBD2M",
            "name": "mike.breen.bbb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1660277299.898799",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "vta7G",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "that "
                            },
                            {
                                "type": "text",
                                "text": "r.last_price_traded",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " you are referencing would be the last traded price "
                            },
                            {
                                "type": "text",
                                "text": "in_play",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " not "
                            },
                            {
                                "type": "text",
                                "text": "pre_play",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "  like I am after..."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U03QLPZQBLM",
        "type": "message",
        "ts": "1660286440.784599",
        "client_msg_id": "a9ef0994-1f4f-44fd-b365-b28b8d48cc5a",
        "text": "oh I missed the check for in play.\n\nThis is essentially what I am doing",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gee4caf4e81f",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/ee4caf4e81ff96058a7d4a3efdf1a260.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "Johnny",
            "real_name": "Johnny Boston",
            "display_name": "",
            "team": "T4G9NBD2M",
            "name": "mike.breen.bbb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1660277299.898799",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "9enIR",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "oh I missed the check for in play.\n\nThis is essentially what I am doing"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U016TGY3676",
        "type": "message",
        "ts": "1660286725.360959",
        "edited": {
            "user": "U016TGY3676",
            "ts": "1660286918.000000"
        },
        "client_msg_id": "a5dba71c-38ac-418f-aa9b-d83cbf95b133",
        "text": "It says `not` inplay. I presume you are using Flumine? That example is over simplified but in essence, you have to save it preplay because it doesn't exist after.\nAlternatively, if you're saving the updates to your CSV, the LTP you want is the last one _before_ inplay==True.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g6a681220e11",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/6a681220e11c1a2ed3685375d658dadb.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0001-72.png",
            "first_name": "",
            "real_name": "birchy",
            "display_name": "birchy",
            "team": "T4G9NBD2M",
            "name": "birchy",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1660277299.898799",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "qT\/x",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "It says "
                            },
                            {
                                "type": "text",
                                "text": "not",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " inplay. I presume you are using Flumine? That example is over simplified but in essence, you have to save it preplay because it doesn't exist after.\nAlternatively, if you're saving the updates to your CSV, the LTP you want is the last one "
                            },
                            {
                                "type": "text",
                                "text": "before ",
                                "style": {
                                    "italic": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "inplay==True."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U03QLPZQBLM",
        "type": "message",
        "ts": "1660287072.491129",
        "client_msg_id": "26c9deca-2a87-4652-8ca7-f6d3adf357c8",
        "text": "Yes, I'm using flumine and this is what I'm doing. Still getting strange figures",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gee4caf4e81f",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/ee4caf4e81ff96058a7d4a3efdf1a260.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0016-72.png",
            "first_name": "Johnny",
            "real_name": "Johnny Boston",
            "display_name": "",
            "team": "T4G9NBD2M",
            "name": "mike.breen.bbb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1660277299.898799",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "xYiO",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Yes, I'm using flumine and this is what I'm doing. Still getting strange figures"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U016TGY3676",
        "type": "message",
        "ts": "1660287586.221049",
        "client_msg_id": "8b2558ee-7231-4835-9d99-60f25c0113cd",
        "text": "It's not unusual to have wildly different LTP\/BSP, particularly in low liquidity markets. Might be worth comparing LTP with `near_price` as a sanity check?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g6a681220e11",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/6a681220e11c1a2ed3685375d658dadb.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0001-72.png",
            "first_name": "",
            "real_name": "birchy",
            "display_name": "birchy",
            "team": "T4G9NBD2M",
            "name": "birchy",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1660277299.898799",
        "parent_user_id": "U03QLPZQBLM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "czmU",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "It's not unusual to have wildly different LTP\/BSP, particularly in low liquidity markets. Might be worth comparing LTP with "
                            },
                            {
                                "type": "text",
                                "text": "near_price",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " as a sanity check?"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]