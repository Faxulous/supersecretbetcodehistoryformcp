[
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1686894127.094519",
        "edited": {
            "user": "U01DVUAE2G1",
            "ts": "1686894216.000000"
        },
        "client_msg_id": "82cc2799-7708-423f-bac4-c332c610a35e",
        "text": "hey guys! Yesterday i had my first bot going rogue. Looking at my terribly lazy workflow and messy code at times, its actually a miracle that this has been the first time in all these years. I know very well how to prevent this in the future, as i know what caused it (lazy workflow a la \"why paper trade - cool kids go live\" :smile: ). Knowing myself however, i could still be dumb enough to let it happen again, even after this incident.\nAnyways, as i watched my rogue bot throw out 100% of my bankroll in a fraction of a second, i was wondering: how to best deal with this? I didnt want to just kill it, as then i d be left with thousands of bets (idk how many it was, it hit transaction limit, so whatever that limit is) all over betfair that are completely unattended and i d have to manually cancel them all via the betfair_webUI. As it was supposed to only be a test run, i had it set to only run for 1 hour, so i decided to just let it do its thing, as this way, while it may have broken any exposure limits imaginable, it still babysat my bets in a somewhat \"smart\" way.\n\nHowever, after 1 hour, the bot did in fact stop, but not as gracefully as hoped. It just left all the bets up so i still had to manually go through the markets and cancel them.\n\nThis leaves me with 2 questions:\n1. Is there a way to gracefully kill a rogue bot?\n2. What went wrong when my bot was supposed to cancel all bets before stopping as planned?\nregarding 2, here is the relevant code that terminated the bot and was supposed to cancel all bets left:\n```def terminate(context: dict, framework) -&gt; None:\n    for market in framework.markets:\n        for order in market.blotter:\n            if order.status == OrderStatus.EXECUTABLE:\n                market.cancel_order(order)\n    framework.handler_queue.put(TerminationEvent)\n\n\nterminator = flumine.worker.BackgroundWorker(flumine=framework, function=helpers.terminate, interval=100, start_delay=60 * self.run_time_in_mins)  # termiante after run_time_in_mins\n\nframework.add_worker(terminator)```\n\nAlso, i know you guys would ve loved for me to throw some cash at you, but luckily i didnt get punished as i should ve been. The bot actually made 10 pounds (minus what the other bots could ve made in that hour maybe, if they had any bankroll left to play with), enough to get me a well deserved pint after a productive day at \"work\".  But no worries, i m sure i ll unleash one of these bad boys again some time.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "reply_count": 27,
        "reply_users_count": 3,
        "latest_reply": "1686967771.202609",
        "reply_users": [
            "UBS7QANF3",
            "U4H19D1D2",
            "U01DVUAE2G1"
        ],
        "replies": [
            {
                "user": "UBS7QANF3",
                "ts": "1686897269.649019"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1686898232.739929"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1686903436.497219"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1686903645.660479"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1686903693.083179"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1686903888.512709"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1686903952.039019"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1686904017.883589"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1686904083.477169"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1686904162.355119"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1686904260.641959"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1686904291.992969"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1686904424.718849"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1686904545.779629"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1686904611.626489"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1686905888.969299"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1686909170.553829"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1686911044.558229"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1686914004.618589"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1686914063.270869"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1686921606.273239"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1686929277.841219"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1686932331.697259"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1686933438.932899"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1686933448.278689"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1686967202.785739"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1686967771.202609"
            }
        ],
        "is_locked": false,
        "subscribed": true,
        "last_read": "1686967771.202609",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "yNuRQ",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "hey guys! Yesterday i had my first bot going rogue. Looking at my terribly lazy workflow and messy code at times, its actually a miracle that this has been the first time in all these years. I know very well how to prevent this in the future, as i know what caused it (lazy workflow a la \"why paper trade - cool kids go live\" "
                            },
                            {
                                "type": "emoji",
                                "name": "smile",
                                "unicode": "1f604"
                            },
                            {
                                "type": "text",
                                "text": " ). Knowing myself however, i could still be dumb enough to let it happen again, even after this incident.\nAnyways, as i watched my rogue bot throw out 100% of my bankroll in a fraction of a second, i was wondering: how to best deal with this? I didnt want to just kill it, as then i d be left with thousands of bets (idk how many it was, it hit transaction limit, so whatever that limit is) all over betfair that are completely unattended and i d have to manually cancel them all via the betfair_webUI. As it was supposed to only be a test run, i had it set to only run for 1 hour, so i decided to just let it do its thing, as this way, while it may have broken any exposure limits imaginable, it still babysat my bets in a somewhat \"smart\" way.\n\nHowever, after 1 hour, the bot did in fact stop, but not as gracefully as hoped. It just left all the bets up so i still had to manually go through the markets and cancel them.\n\nThis leaves me with 2 questions:\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_list",
                        "elements": [
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "Is there a way to gracefully kill a rogue bot?"
                                    }
                                ]
                            },
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "What went wrong when my bot was supposed to cancel all bets before stopping as planned?"
                                    }
                                ]
                            }
                        ],
                        "style": "ordered",
                        "indent": 0,
                        "border": 0
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\nregarding 2, here is the relevant code that terminated the bot and was supposed to cancel all bets left:\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "def terminate(context: dict, framework) -> None:\n    for market in framework.markets:\n        for order in market.blotter:\n            if order.status == OrderStatus.EXECUTABLE:\n                market.cancel_order(order)\n    framework.handler_queue.put(TerminationEvent)\n\n\nterminator = flumine.worker.BackgroundWorker(flumine=framework, function=helpers.terminate, interval=100, start_delay=60 * self.run_time_in_mins)  # termiante after run_time_in_mins\n\nframework.add_worker(terminator)"
                            }
                        ],
                        "border": 0
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nAlso, i know you guys would ve loved for me to throw some cash at you, but luckily i didnt get punished as i should ve been. The bot actually made 10 pounds (minus what the other bots could ve made in that hour maybe, if they had any bankroll left to play with), enough to get me a well deserved pint after a productive day at \"work\".  But no worries, i m sure i ll unleash one of these bad boys again some time."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UBS7QANF3",
        "type": "message",
        "ts": "1686897269.649019",
        "client_msg_id": "d4d30ee2-5f83-4341-8b5d-31a8531226eb",
        "text": "<https:\/\/docs.developer.betfair.com\/display\/1smk3cen4v3lu3yomq5qye0ni\/cancelOrders>\n\n&gt; If marketId *and* betId aren't supplied *all bets* are cancelled.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gaaf844a4a90",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/eaaf844a4a905431d83430e563b077aa.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0011-72.png",
            "first_name": "",
            "real_name": "Maurice Berk",
            "display_name": "Mo",
            "team": "T4G9NBD2M",
            "name": "maurice",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "qq4",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "link",
                                "url": "https:\/\/docs.developer.betfair.com\/display\/1smk3cen4v3lu3yomq5qye0ni\/cancelOrders"
                            },
                            {
                                "type": "text",
                                "text": "\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_quote",
                        "elements": [
                            {
                                "type": "text",
                                "text": "If marketId "
                            },
                            {
                                "type": "text",
                                "text": "and",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " betId aren't supplied "
                            },
                            {
                                "type": "text",
                                "text": "all bets",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " are cancelled."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686898232.739929",
        "edited": {
            "user": "U4H19D1D2",
            "ts": "1686900382.000000"
        },
        "client_msg_id": "16215419-68e2-4524-8489-8106a73c9c94",
        "text": "Did you remove all the controls that flumine has in place to stop this?\n\nAnd to answer point 2 I imagine the program exited due to memory leak \/ CPU so the termination function could never run.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "yA+uY",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Did you remove all the controls that flumine has in place to stop this?\n\nAnd to answer point 2 I imagine the program exited due to memory leak \/ CPU so the termination function could never run."
                            }
                        ]
                    }
                ]
            }
        ]
    }
]