[
    {
        "user": "U04J6LUGCFM",
        "type": "message",
        "ts": "1685695181.765759",
        "client_msg_id": "7a04cf9e-22e6-4ead-b71f-85a74dd6209f",
        "text": "Get this annoying error anytime I start my stream. It doesn't seem to cause any issues but just want to get to the bottom of it. All error handling attempts have failed",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "89086bbff64a",
            "image_72": "https:\/\/avatars.slack-edge.com\/2023-01-10\/4604281940487_89086bbff64aee88bfe0_72.png",
            "first_name": "Andy",
            "real_name": "Andy",
            "display_name": "Andy",
            "team": "T4G9NBD2M",
            "name": "andreworourke84",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685695181.765759",
        "reply_count": 6,
        "reply_users_count": 3,
        "latest_reply": "1685696636.079059",
        "reply_users": [
            "U04J6LUGCFM",
            "U4H19D1D2",
            "UBS7QANF3"
        ],
        "replies": [
            {
                "user": "U04J6LUGCFM",
                "ts": "1685695186.513899"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1685695211.511909"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1685695220.675489"
            },
            {
                "user": "U04J6LUGCFM",
                "ts": "1685695238.786449"
            },
            {
                "user": "U04J6LUGCFM",
                "ts": "1685695269.608259"
            },
            {
                "user": "UBS7QANF3",
                "ts": "1685696636.079059"
            }
        ],
        "is_locked": false,
        "subscribed": true,
        "last_read": "1685696636.079059",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "qGh",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Get this annoying error anytime I start my stream. It doesn't seem to cause any issues but just want to get to the bottom of it. All error handling attempts have failed"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U04J6LUGCFM",
        "type": "message",
        "ts": "1685695186.513899",
        "client_msg_id": "acb646cf-a9dd-4178-baba-35ff2662253c",
        "text": "Mainloop Timer 3: 2023-06-02T08:29:03.045302\nException in thread Thread-1 (start):\nTraceback (most recent call last):\n  File \"C:\\Users\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\threading.py\", line 1038, in _bootstrap_inner\n    self.run()\n  File \"C:\\Users\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\threading.py\", line 975, in run\n    self._target(*self._args, **self._kwargs)\n  File \"C:\\Users\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\betfairlightweight\\streaming\\betfairstream.py\", line 67, in start\n    self._read_loop()\n  File \"C:\\Users\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\betfairlightweight\\streaming\\betfairstream.py\", line 233, in _read_loop\n    self._data(received_data)\n  File \"C:\\Users\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\betfairlightweight\\streaming\\betfairstream.py\", line 274, in _data\n    raise ListenerError(self.listener.connection_id, received_data)\nbetfairlightweight.exceptions.ListenerError: connection_id: 105-020623082852-707950, data: {\"op\":\"status\",\"statusCode\":\"FAILURE\",\"errorCode\":\"TIMEOUT\",\"errorMessage\":\"Connection is not subscribed and is idle: 15000 ms\",\"connectionClosed\":true,\"connectionId\":\"103-020623082851-731897\"}",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "89086bbff64a",
            "image_72": "https:\/\/avatars.slack-edge.com\/2023-01-10\/4604281940487_89086bbff64aee88bfe0_72.png",
            "first_name": "Andy",
            "real_name": "Andy",
            "display_name": "Andy",
            "team": "T4G9NBD2M",
            "name": "andreworourke84",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685695181.765759",
        "parent_user_id": "U04J6LUGCFM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "tAHS5",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Mainloop Timer 3: 2023-06-02T08:29:03.045302\nException in thread Thread-1 (start):\nTraceback (most recent call last):\n  File \"C:\\Users\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\threading.py\", line 1038, in _bootstrap_inner\n    self.run()\n  File \"C:\\Users\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\threading.py\", line 975, in run\n    self._target(*self._args, **self._kwargs)\n  File \"C:\\Users\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\betfairlightweight\\streaming\\betfairstream.py\", line 67, in start\n    self._read_loop()\n  File \"C:\\Users\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\betfairlightweight\\streaming\\betfairstream.py\", line 233, in _read_loop\n    self._data(received_data)\n  File \"C:\\Users\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\betfairlightweight\\streaming\\betfairstream.py\", line 274, in _data\n    raise ListenerError(self.listener.connection_id, received_data)\nbetfairlightweight.exceptions.ListenerError: connection_id: 105-020623082852-707950, data: {\"op\":\"status\",\"statusCode\":\"FAILURE\",\"errorCode\":\"TIMEOUT\",\"errorMessage\":\"Connection is not subscribed and is idle: 15000 ms\",\"connectionClosed\":true,\"connectionId\":\"103-020623082851-731897\"}"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1685695211.511909",
        "client_msg_id": "a65a3837-db84-4cb4-a0f4-05fa7055ffc0",
        "text": "Yeah I get that now and again",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685695181.765759",
        "parent_user_id": "U04J6LUGCFM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "+uti\/",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Yeah I get that now and again"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1685695220.675489",
        "client_msg_id": "3bb8f3ae-08fe-45c7-b488-b692a8c5a8c3",
        "text": "bflw is too quick",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685695181.765759",
        "parent_user_id": "U04J6LUGCFM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "THRdn",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "bflw is too quick"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U04J6LUGCFM",
        "type": "message",
        "ts": "1685695238.786449",
        "client_msg_id": "65fcc1df-5f41-4e18-8f35-c138e506a14d",
        "text": "def start_stream(bfl_trading, bfl_client, event_types=[\"horse\", \"greyhound\"]):\n    \"\"\"Retrieves a json dictionary with the stream data from the specified event types.\"\"\"\n    for event in event_types:\n        event_types[event_types.index(event)] = EVENT_TYPE_IDS[event]\n\n    # create queue\n    output_queue = queue.Queue()\n\n    # create stream listener\n    listener = betfairlightweight.StreamListener(output_queue=output_queue)\n\n    # create stream\n    streamH = bfl_trading.streaming.create_stream(listener=listener)\n    streamG = bfl_trading.streaming.create_stream(listener=listener)\n\n    # Create filters to get the events\n    horse_market_filter=betfairlightweight.filters.streaming_market_filter(\n        event_type_ids=[\"7\"],\n        country_codes=[\"AU\"],\n        market_types=[\"WIN\"]\n    )\n    greyhound_market_filter=betfairlightweight.filters.streaming_market_filter(\n        event_type_ids=[\"4339\"],\n        country_codes=[\"AU\"],\n        market_types=[\"WIN\"]\n    )\n\n    market_data_filter = filters.streaming_market_data_filter(\n        fields=[\"EX_BEST_OFFERS\", \"EX_MARKET_DEF\"], ladder_levels=3\n    )\n\n\n    # subscribe\n    horse_streaming_unique_id = streamH.subscribe_to_markets(\n        market_filter=horse_market_filter,\n        market_data_filter=market_data_filter,\n        conflate_ms=5000,  # send update every 1000ms\n    )\n\n    greyhound_streaming_unique_id = streamG.subscribe_to_markets(\n        market_filter=greyhound_market_filter,\n        market_data_filter=market_data_filter,\n        conflate_ms=5000,  # send update every 1000ms\n    )\n\n    # start stream in a new thread (in production would need err handling)\n    tH = threading.Thread(target=streamH.start, daemon=True)\n    tH.start()\n    tG = threading.Thread(target=streamG.start, daemon=True)\n    tG.start()\n\n    return streamH, output_queue",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "89086bbff64a",
            "image_72": "https:\/\/avatars.slack-edge.com\/2023-01-10\/4604281940487_89086bbff64aee88bfe0_72.png",
            "first_name": "Andy",
            "real_name": "Andy",
            "display_name": "Andy",
            "team": "T4G9NBD2M",
            "name": "andreworourke84",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685695181.765759",
        "parent_user_id": "U04J6LUGCFM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "dvB5l",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "def start_stream(bfl_trading, bfl_client, event_types=[\"horse\", \"greyhound\"]):\n    \"\"\"Retrieves a json dictionary with the stream data from the specified event types.\"\"\"\n    for event in event_types:\n        event_types[event_types.index(event)] = EVENT_TYPE_IDS[event]\n\n    # create queue\n    output_queue = queue.Queue()\n\n    # create stream listener\n    listener = betfairlightweight.StreamListener(output_queue=output_queue)\n\n    # create stream\n    streamH = bfl_trading.streaming.create_stream(listener=listener)\n    streamG = bfl_trading.streaming.create_stream(listener=listener)\n\n    # Create filters to get the events\n    horse_market_filter=betfairlightweight.filters.streaming_market_filter(\n        event_type_ids=[\"7\"],\n        country_codes=[\"AU\"],\n        market_types=[\"WIN\"]\n    )\n    greyhound_market_filter=betfairlightweight.filters.streaming_market_filter(\n        event_type_ids=[\"4339\"],\n        country_codes=[\"AU\"],\n        market_types=[\"WIN\"]\n    )\n\n    market_data_filter = filters.streaming_market_data_filter(\n        fields=[\"EX_BEST_OFFERS\", \"EX_MARKET_DEF\"], ladder_levels=3\n    )\n\n\n    # subscribe\n    horse_streaming_unique_id = streamH.subscribe_to_markets(\n        market_filter=horse_market_filter,\n        market_data_filter=market_data_filter,\n        conflate_ms=5000,  # send update every 1000ms\n    )\n\n    greyhound_streaming_unique_id = streamG.subscribe_to_markets(\n        market_filter=greyhound_market_filter,\n        market_data_filter=market_data_filter,\n        conflate_ms=5000,  # send update every 1000ms\n    )\n\n    # start stream in a new thread (in production would need err handling)\n    tH = threading.Thread(target=streamH.start, daemon=True)\n    tH.start()\n    tG = threading.Thread(target=streamG.start, daemon=True)\n    tG.start()\n\n    return streamH, output_queue"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U04J6LUGCFM",
        "type": "message",
        "ts": "1685695269.608259",
        "client_msg_id": "411012ec-18b8-4530-a46b-063a39573b82",
        "text": "<@U4H19D1D2> all good then thank you",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "89086bbff64a",
            "image_72": "https:\/\/avatars.slack-edge.com\/2023-01-10\/4604281940487_89086bbff64aee88bfe0_72.png",
            "first_name": "Andy",
            "real_name": "Andy",
            "display_name": "Andy",
            "team": "T4G9NBD2M",
            "name": "andreworourke84",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685695181.765759",
        "parent_user_id": "U04J6LUGCFM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "YEf",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "user",
                                "user_id": "U4H19D1D2"
                            },
                            {
                                "type": "text",
                                "text": " all good then thank you"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UBS7QANF3",
        "type": "message",
        "ts": "1685696636.079059",
        "edited": {
            "user": "UBS7QANF3",
            "ts": "1685696648.000000"
        },
        "client_msg_id": "07465180-fd9c-4d1f-b715-79dd1f6f6c14",
        "text": "We do this:\n\n```betfair_stream._connect()\ntime.sleep(3)\nbetfair_stream.authenticate()\nbetfair_stream.subscribe_to_markets(...)```",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gaaf844a4a90",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/eaaf844a4a905431d83430e563b077aa.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0011-72.png",
            "first_name": "",
            "real_name": "Maurice Berk",
            "display_name": "Mo",
            "team": "T4G9NBD2M",
            "name": "maurice",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685695181.765759",
        "parent_user_id": "U04J6LUGCFM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "QGC",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "We do this:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "betfair_stream._connect()\ntime.sleep(3)\nbetfair_stream.authenticate()\nbetfair_stream.subscribe_to_markets(...)"
                            }
                        ],
                        "border": 0
                    }
                ]
            }
        ],
        "reactions": [
            {
                "name": "white_check_mark",
                "users": [
                    "U04J6LUGCFM"
                ],
                "count": 1
            }
        ]
    },
    {
        "user": "U04980ZT6UX",
        "type": "message",
        "ts": "1685742542.376139",
        "client_msg_id": "d08b268f-becb-437b-8ee9-07e2c1327fd9",
        "text": "Python. No, there is a single client for all threads (shared)",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gb1b2f82a1a4",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/b1b2f82a1a49a547cbc7487b48805187.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0017-72.png",
            "first_name": "AI",
            "real_name": "AI Trader",
            "display_name": "AI Trader",
            "team": "T4G9NBD2M",
            "name": "menocineto",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685561051.026119",
        "parent_user_id": "U05AR7HNHUZ",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "VJAh",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Python. No, there is a single client for all threads (shared)"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U04980ZT6UX",
        "type": "message",
        "ts": "1685742566.496159",
        "client_msg_id": "cfa04e19-612f-4a50-93ce-aa2d83a8f326",
        "text": "I have managed to fix the issue with a simple hack (adding verify = False to every single request to betfair, which is not a good solution as defeats the purpose)",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gb1b2f82a1a4",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/b1b2f82a1a49a547cbc7487b48805187.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0017-72.png",
            "first_name": "AI",
            "real_name": "AI Trader",
            "display_name": "AI Trader",
            "team": "T4G9NBD2M",
            "name": "menocineto",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1685561051.026119",
        "parent_user_id": "U05AR7HNHUZ",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "5jHQ",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I have managed to fix the issue with a simple hack (adding verify = False to every single request to betfair, which is not a good solution as defeats the purpose)"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]