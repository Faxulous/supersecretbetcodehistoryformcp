[
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1686903436.497219",
        "client_msg_id": "e20e0901-0e45-482e-9c6c-9097ec800bea",
        "text": "<@UBS7QANF3> thanks for the pointer, so i guess i could use this to shorten the terminate function? How would i call this in flumine?\nAlso, while this may be a better way to canceling all orders, can you see a reason why my original function fails to do its job?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "NWd0",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "user",
                                "user_id": "UBS7QANF3"
                            },
                            {
                                "type": "text",
                                "text": " thanks for the pointer, so i guess i could use this to shorten the terminate function? How would i call this in flumine?\nAlso, while this may be a better way to canceling all orders, can you see a reason why my original function fails to do its job?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1686903645.660479",
        "client_msg_id": "e8b3c903-f020-4595-aa8c-a3b4cdf31d36",
        "text": "<@U4H19D1D2> i can be rather careless, but thats also why i would never remove any controls :smile: But i think there is only so much flumine can do in this case. Its not like any individual order broke the order exposure, but i didnt set any strategy exposure or a maximum amount of bets it could place, so flumine has no reason to assume i didnt want to put my whole bank roll out in one go there.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "9Ap9n",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "user",
                                "user_id": "U4H19D1D2"
                            },
                            {
                                "type": "text",
                                "text": " i can be rather careless, but thats also why i would never remove any controls "
                            },
                            {
                                "type": "emoji",
                                "name": "smile",
                                "unicode": "1f604"
                            },
                            {
                                "type": "text",
                                "text": " But i think there is only so much flumine can do in this case. Its not like any individual order broke the order exposure, but i didnt set any strategy exposure or a maximum amount of bets it could place, so flumine has no reason to assume i didnt want to put my whole bank roll out in one go there."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686903693.083179",
        "client_msg_id": "e9deb2d9-3e72-4574-a52a-0f3f5c16b7b5",
        "text": "I think its best to solve the problem first, why no use of the strategy exposure \/ bets?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "DNBW",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I think its best to solve the problem first, why no use of the strategy exposure \/ bets?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1686903888.512709",
        "client_msg_id": "ad9c621a-8eb1-4318-a971-4a3320db0f84",
        "text": "<@U4H19D1D2> i totally agree and besides that, there were plenty of more occasions where the rational mind should kick in make sure things dont go wild when hitting that live button, i m totally aware of those solutions. However i m still curious about why my terminate function didnt do its job properly and how to act in case i send another one of these boys out there, even if its due to my own stupidity :smile:",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "LYN",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "user",
                                "user_id": "U4H19D1D2"
                            },
                            {
                                "type": "text",
                                "text": " i totally agree and besides that, there were plenty of more occasions where the rational mind should kick in make sure things dont go wild when hitting that live button, i m totally aware of those solutions. However i m still curious about why my terminate function didnt do its job properly and how to act in case i send another one of these boys out there, even if its due to my own stupidity "
                            },
                            {
                                "type": "emoji",
                                "name": "smile",
                                "unicode": "1f604"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686903952.039019",
        "client_msg_id": "d8931a30-65ef-493a-9a8c-7d1cde37a1e3",
        "text": "What does stop mean in this case? You stopped? It stopped? CPU usage at the time?\n\n```However, after 1 hour, the bot did in fact stop, but not as gracefully as hoped. It just left all the bets up so i still had to manually go through the markets and cancel them.```",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "0Ky",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "What does stop mean in this case? You stopped? It stopped? CPU usage at the time?\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "However, after 1 hour, the bot did in fact stop, but not as gracefully as hoped. It just left all the bets up so i still had to manually go through the markets and cancel them."
                            }
                        ],
                        "border": 0
                    }
                ]
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1686904017.883589",
        "client_msg_id": "d6378322-6824-45c4-aaf0-42c399cf5188",
        "text": "the terminate function was triggered and ran\n```framework.handler_queue.put(TerminationEvent)```\nhowever, it seemingly ignored the snippet right above that",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "H0uw",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "the terminate function was triggered and ran\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "framework.handler_queue.put(TerminationEvent)"
                            }
                        ],
                        "border": 0
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "however, it seemingly ignored the snippet right above that"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686904083.477169",
        "client_msg_id": "d5968591-f6ce-4c2b-8f0e-2f307fd9dcf9",
        "text": "I don't see any logic waiting for the cancel requests to complete?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "ZgH",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I don't see any logic waiting for the cancel requests to complete?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1686904162.355119",
        "client_msg_id": "c7d15862-96cd-4ef8-b192-edc3b704d3d2",
        "text": "that will be the reason then. I thought once sent out, it will just complete even if i dont wait for the confirmation. Thank you, i ll check how to fix that",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "aJaqg",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "that will be the reason then. I thought once sent out, it will just complete even if i dont wait for the confirmation. Thank you, i ll check how to fix that"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686904260.641959",
        "client_msg_id": "187399db-3f93-4adb-91a6-7163e36e2bb2",
        "text": "At the end of the day its executing code in order, nothing complicated but the execution thread needs time to send the requests, in your example the functions get called but have no time to actually execute before the flumine main process completes",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "T9IJE",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "At the end of the day its executing code in order, nothing complicated but the execution thread needs time to send the requests, in your example the functions get called but have no time to actually execute before the flumine main process completes"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686904291.992969",
        "client_msg_id": "52c3ef40-e0ff-45d9-9034-b67b70b5a9b5",
        "text": "Make sure you test it though as there could be something else going on",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "2AQ8o",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Make sure you test it though as there could be something else going on"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1686904424.718849",
        "client_msg_id": "7d57eea8-4e20-4801-91d0-40c6d4548f2d",
        "text": "is there the possibility of me sending the cancel request for all orders and while waiting for its completion, my strategy placing new bets that then will still be left out there? So basically i d have to:\n1. stop framework from placing any new orders\n2. send cancel request for all orders\n3. wait for confirmation\n4. put terminationEvent\n?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "GaWLy",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "is there the possibility of me sending the cancel request for all orders and while waiting for its completion, my strategy placing new bets that then will still be left out there? So basically i d have to:\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_list",
                        "elements": [
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "stop framework from placing any new orders"
                                    }
                                ]
                            },
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "send cancel request for all orders"
                                    }
                                ]
                            },
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "wait for confirmation"
                                    }
                                ]
                            },
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "put terminationEvent"
                                    }
                                ]
                            }
                        ],
                        "style": "ordered",
                        "indent": 0,
                        "border": 0
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686904545.779629",
        "client_msg_id": "bbc0f99d-dfa7-4930-ba8c-126a25725772",
        "text": "Good point, that is possible, <https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/baseflumine.py#L429|this> is the exit code, easy fix is to stop the streams first and then call the workers",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "attachments": [
            {
                "id": 1,
                "footer_icon": "https:\/\/slack.github.com\/static\/img\/favicon-neutral.png",
                "color": "24292f",
                "bot_id": "B021ZJYSBMW",
                "app_unfurl_url": "https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/baseflumine.py#L429",
                "is_app_unfurl": true,
                "app_id": "A01BP7R4KNY",
                "fallback": "<https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/baseflumine.py | baseflumine.py>",
                "text": "```\n    def __exit__(self, *args):\n```",
                "title": "<https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/baseflumine.py | baseflumine.py>",
                "footer": "<https:\/\/github.com\/betcode-org\/flumine|betcode-org\/flumine>",
                "mrkdwn_in": [
                    "text"
                ]
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "0EB",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Good point, that is possible, "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/baseflumine.py#L429",
                                "text": "this"
                            },
                            {
                                "type": "text",
                                "text": " is the exit code, easy fix is to stop the streams first and then call the workers"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686904611.626489",
        "client_msg_id": "632d96ef-d3ce-4aa4-b1e8-31b3ef7775ce",
        "text": "You start playing with fire though as the likely cause of an issue might result in cancel requests failing and you get stuck in a loop, we also only want to stop market streams and keep order stream open",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "VLds",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "You start playing with fire though as the likely cause of an issue might result in cancel requests failing and you get stuck in a loop, we also only want to stop market streams and keep order stream open"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1686905888.969299",
        "client_msg_id": "55859715-c55f-4ed1-a76a-f0d39341140a",
        "text": "well, playing with fire certainly wasnt the goal, rather the opposite :smile:  So currently you guys also have no way of stopping flumine without leaving some trailing bets behind?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "EmTxV",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "well, playing with fire certainly wasnt the goal, rather the opposite "
                            },
                            {
                                "type": "emoji",
                                "name": "smile",
                                "unicode": "1f604"
                            },
                            {
                                "type": "text",
                                "text": "  So currently you guys also have no way of stopping flumine without leaving some trailing bets behind?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686909170.553829",
        "client_msg_id": "7fe78b4c-8839-4ff7-80ca-6d158bba92bb",
        "text": "Test it, I am just saying that if something breaks on betfairs end all bets are off",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "GcF",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Test it, I am just saying that if something breaks on betfairs end all bets are off"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686911044.558229",
        "client_msg_id": "bc49b0ba-fd19-456d-a36d-99f4bca9a97a",
        "text": "<https:\/\/github.com\/betcode-org\/flumine\/issues\/665>",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "attachments": [
            {
                "id": 1,
                "footer_icon": "https:\/\/slack.github.com\/static\/img\/favicon-neutral.png",
                "ts": 1686911032,
                "color": "36a64f",
                "bot_id": "B021ZJYSBMW",
                "app_unfurl_url": "https:\/\/github.com\/betcode-org\/flumine\/issues\/665",
                "is_app_unfurl": true,
                "app_id": "A01BP7R4KNY",
                "fallback": "#665 Improve flumine exit procedure",
                "text": "Improve graceful exiting so positions can be adjusted cancelled.\n\n☐ Prevent strategy processing\n☐ Stop market\/custom streams\n☐ Call strategy.finish\n☐ Call workers.shutdown\n☐ Stop order streams\n\n..as per\n\nThe above allows users to cancel any executable orders but prevent strategies receiving any new data",
                "title": "#665 Improve flumine exit procedure",
                "title_link": "https:\/\/github.com\/betcode-org\/flumine\/issues\/665",
                "footer": "<https:\/\/github.com\/betcode-org\/flumine|betcode-org\/flumine>",
                "mrkdwn_in": [
                    "text"
                ]
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "LNR",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/betcode-org\/flumine\/issues\/665"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1686914004.618589",
        "client_msg_id": "0ba6718a-5fff-4918-8390-cb2364eabf08",
        "text": "test it, as in modify the `__exit__`  method? I d rather not, i m already more than capable of unleashing chaos without tinkering with the underlying frameworks :smile: I guess i could chunk together some hacky code that stops my strategies from placing orders without touching flumine, but i dont think thats the way to go. I d much rather if we had a generally accepted way to gracefully stop new bets, cancel all executable ones and terminate flumine. I dont mind writing some code and making a pull req myself, but i feel like i m the wrong guy for this particular job.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Dld",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "test it, as in modify the "
                            },
                            {
                                "type": "text",
                                "text": "__exit__",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "  method? I d rather not, i m already more than capable of unleashing chaos without tinkering with the underlying frameworks "
                            },
                            {
                                "type": "emoji",
                                "name": "smile",
                                "unicode": "1f604"
                            },
                            {
                                "type": "text",
                                "text": " I guess i could chunk together some hacky code that stops my strategies from placing orders without touching flumine, but i dont think thats the way to go. I d much rather if we had a generally accepted way to gracefully stop new bets, cancel all executable ones and terminate flumine. I dont mind writing some code and making a pull req myself, but i feel like i m the wrong guy for this particular job."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686914063.270869",
        "client_msg_id": "40316e17-3b6c-4843-b12a-18160f034a10",
        "text": "I mean fix your worker and test it, 2 second test will tell you if things are working, dw about the exit change, I can improve that",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "y2ubz",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I mean fix your worker and test it, 2 second test will tell you if things are working, dw about the exit change, I can improve that"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1686921606.273239",
        "client_msg_id": "1a1044a5-cfff-4ba6-87c5-939819a23ba0",
        "text": "2 seconds for you maybe :smile:\nso you want me to write the terminate function like this?:\n```\ndef terminate(context: dict, framework: Flumine) -&gt; None:\n# stop market streams\nfor market in framework.markets:\n    for order in market.blotter:\n        if order.status == OrderStatus.EXECUTABLE:\n            market.cancel_order(order)\n# wait for confirmation\n    framework.handler_queue.put(TerminationEvent)```\nif so, regarding \"stop market streams\", i cant see a clean way of doing this. Flumine seems to have one attribute \"streams\" which includes all streams. I could iterate over, check if isinstance(stream, FlumineMarketStream) and stop those, i guess.\n\nRegarding \"wait for confirmation\" my lack of experience with threading may be the problem. I guess i d need to collect all bet_id's of the orders i just canceled, then open a listener_thread where i check for coming updates and wait until all bets that i have canceled have been confirmed to be cancelled? + some error handling when a bet failed to cancel.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "x9U",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "2 seconds for you maybe "
                            },
                            {
                                "type": "emoji",
                                "name": "smile",
                                "unicode": "1f604"
                            },
                            {
                                "type": "text",
                                "text": "\nso you want me to write the terminate function like this?:\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\ndef terminate(context: dict, framework: Flumine) -> None:\n# stop market streams\nfor market in framework.markets:\n    for order in market.blotter:\n        if order.status == OrderStatus.EXECUTABLE:\n            market.cancel_order(order)\n# wait for confirmation\n    framework.handler_queue.put(TerminationEvent)"
                            }
                        ],
                        "border": 0
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "if so, regarding \"stop market streams\", i cant see a clean way of doing this. Flumine seems to have one attribute \"streams\" which includes all streams. I could iterate over, check if isinstance(stream, FlumineMarketStream) and stop those, i guess.\n\nRegarding \"wait for confirmation\" my lack of experience with threading may be the problem. I guess i d need to collect all bet_id's of the orders i just canceled, then open a listener_thread where i check for coming updates and wait until all bets that i have canceled have been confirmed to be cancelled? + some error handling when a bet failed to cancel."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686929277.841219",
        "edited": {
            "user": "U4H19D1D2",
            "ts": "1686929319.000000"
        },
        "client_msg_id": "a574ddcd-5b2d-44f9-a650-684fed081706",
        "text": "So I need to make changes to stop the streams correctly but I think you are better to place this code in the strategy itself, for example your worker:\n\n```def terminate(context: dict, framework: Flumine) -&gt; None:\n    # ... logic to terminate\n    framework.handler_queue.put(TerminationEvent)```\nThis will trigger `BaseStrategy.finish` to be called which would contain\n\n```    def finish(self, flumine) -&gt; None:\n        # called before flumine ends\n        for market in flumine.markets:\n            for order in market.blotter.strategy_orders(self, order_status=[OrderStatus.EXECUTABLE]):\n                market.cancel_order(order)\n\n        while True:\n            e_orders = []\n            for market in flumine.markets:\n                orders = market.blotter.strategy_orders(self, order_status=[OrderStatus.EXECUTABLE])\n                e_orders += orders\n                <http:\/\/logger.info|logger.info>(f\"{len(orders)} orders executable in market {market.market_id}\")\n            if e_orders:\n                <http:\/\/logger.info|logger.info>(\"Sleeping for 3s\")\n                time.sleep(3)\n            else:\n                break```\nI just tested this and it works really well",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "AnRO\/",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "So I need to make changes to stop the streams correctly but I think you are better to place this code in the strategy itself, for example your worker:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "def terminate(context: dict, framework: Flumine) -> None:\n    # ... logic to terminate\n    framework.handler_queue.put(TerminationEvent)"
                            }
                        ],
                        "border": 0
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\nThis will trigger "
                            },
                            {
                                "type": "text",
                                "text": "BaseStrategy.finish",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " to be called which would contain\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "    def finish(self, flumine) -> None:\n        # called before flumine ends\n        for market in flumine.markets:\n            for order in market.blotter.strategy_orders(self, order_status=[OrderStatus.EXECUTABLE]):\n                market.cancel_order(order)\n\n        while True:\n            e_orders = []\n            for market in flumine.markets:\n                orders = market.blotter.strategy_orders(self, order_status=[OrderStatus.EXECUTABLE])\n                e_orders += orders\n                logger.info(f\"{len(orders)} orders executable in market {market.market_id}\")\n            if e_orders:\n                logger.info(\"Sleeping for 3s\")\n                time.sleep(3)\n            else:\n                break"
                            }
                        ],
                        "border": 0
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\nI just tested this and it works really well"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U027P3N2WMQ",
        "type": "message",
        "ts": "1686930812.610239",
        "client_msg_id": "85a48e9e-f9cc-49d4-baad-8f988bc50269",
        "text": "I keep getting _getclearedmarket error in Market recorder because of read time outs. Is Flumine handling these or is this an error on my part somewhere?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gc41721181dc",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/c41721181dc4833c08c32f14cddc81b6.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0026-72.png",
            "first_name": "Michael",
            "real_name": "Michael Leary",
            "display_name": "Michael",
            "team": "T4G9NBD2M",
            "name": "michaelleary15",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686930812.610239",
        "reply_count": 2,
        "reply_users_count": 2,
        "latest_reply": "1686935806.994559",
        "reply_users": [
            "U4H19D1D2",
            "U027P3N2WMQ"
        ],
        "replies": [
            {
                "user": "U4H19D1D2",
                "ts": "1686931535.349849"
            },
            {
                "user": "U027P3N2WMQ",
                "ts": "1686935806.994559"
            }
        ],
        "is_locked": false,
        "subscribed": true,
        "last_read": "1686935806.994559",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Vru",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I keep getting _getclearedmarket error in Market recorder because of read time outs. Is Flumine handling these or is this an error on my part somewhere?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686931535.349849",
        "client_msg_id": "783375fa-12a5-4586-9dbd-cfbfb0ec0f47",
        "text": "its handled",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686930812.610239",
        "parent_user_id": "U027P3N2WMQ",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Jegl",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "its handled"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1686932331.697259",
        "client_msg_id": "d91b17b4-613f-47dd-bceb-4b6730b74e32",
        "text": "i was thinking of using the finish method, seemingly thats a good idea then :wink: This looks like it should do the job, but it looks risky to me. If a single order slips through the cancel loop (maybe it failed to cancel, maybe at the time of the for-loop it wasnt executable, maybe it wasnt placed by then and didnt show up yet), we are stuck in an infinite while loop and never try to cancel the order again. Maybe i m just too paranoid and there are solid reasons why none of this can happen?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "nqf",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "i was thinking of using the finish method, seemingly thats a good idea then "
                            },
                            {
                                "type": "emoji",
                                "name": "wink",
                                "unicode": "1f609"
                            },
                            {
                                "type": "text",
                                "text": " This looks like it should do the job, but it looks risky to me. If a single order slips through the cancel loop (maybe it failed to cancel, maybe at the time of the for-loop it wasnt executable, maybe it wasnt placed by then and didnt show up yet), we are stuck in an infinite while loop and never try to cancel the order again. Maybe i m just too paranoid and there are solid reasons why none of this can happen?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686933438.932899",
        "client_msg_id": "6C49D616-A048-4F37-9A5D-3A565E762890",
        "text": "Yeah but you can add logic to handle that in the while, this is just a basic example ",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "3Gjs",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Yeah but you can add logic to handle that in the while, this is just a basic example "
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1686933448.278689",
        "client_msg_id": "F07F77DD-599F-43F4-BA76-1366BE0F52A9",
        "text": "This isn’t a simple problem ",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Ttid",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "This "
                            },
                            {
                                "type": "text",
                                "text": "isn’t"
                            },
                            {
                                "type": "text",
                                "text": " a simple problem "
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U027P3N2WMQ",
        "type": "message",
        "ts": "1686935806.994559",
        "client_msg_id": "eb00202e-61e1-49da-b941-6517d933e2cf",
        "text": "Thanks!",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gc41721181dc",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/c41721181dc4833c08c32f14cddc81b6.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0026-72.png",
            "first_name": "Michael",
            "real_name": "Michael Leary",
            "display_name": "Michael",
            "team": "T4G9NBD2M",
            "name": "michaelleary15",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686930812.610239",
        "parent_user_id": "U027P3N2WMQ",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "uIAK",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Thanks!"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1686967202.785739",
        "client_msg_id": "9ca550ec-2cf6-4206-8093-ad466130d97e",
        "text": "I see. How about:\n```def cancel_all(strat: BaseStrategy, framework: Flumine) -&gt; None:\n    \"\"\"cancels all executable orders of strat and waits for confirmation\"\"\"\n    num_cancel_attempts = 5\n    for _ in range(num_cancel_attempts):\n        for market in framework.markets:\n            orders = market.blotter.strategy_orders(strategy=strat, order_status=[OrderStatus.EXECUTABLE])\n            cancel_orders(market=market, orders=orders)\n        <http:\/\/logging.info|logging.info>('Sleeping for 3s')\n        time.sleep(3)  # waiting for orders to be cancelled in another thread\n\n        e_orders = []\n        for market in framework.markets:\n            orders = market.blotter.strategy_orders(strategy=strat, order_status=[OrderStatus.EXECUTABLE])\n            e_orders += orders\n            <http:\/\/logger.info|logger.info>(f\"{len(orders)} orders executable in market {market.market_id}\")\n        if not e_orders:\n            break\n    else:\n        logger.warning(f\"failed to cancel {len(e_orders)} orders\")```\nthis function would be called in BaseStrategy.finish()\ndownsides:\n• If order takes longer than 3s to cancel, we d send out multiple cancelations for the same order (but maximum 5 and with 3s delay between attempts, so i guess that should be fine?)\nupsides:\n• if an order slips through, we try to cancel again\n• giving up instead of infinte while loop (maybe not perfect either, but the lesser evil?)",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "FG3",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I see. How about:\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "def cancel_all(strat: BaseStrategy, framework: Flumine) -> None:\n    \"\"\"cancels all executable orders of strat and waits for confirmation\"\"\"\n    num_cancel_attempts = 5\n    for _ in range(num_cancel_attempts):\n        for market in framework.markets:\n            orders = market.blotter.strategy_orders(strategy=strat, order_status=[OrderStatus.EXECUTABLE])\n            cancel_orders(market=market, orders=orders)\n        logging.info('Sleeping for 3s')\n        time.sleep(3)  # waiting for orders to be cancelled in another thread\n\n        e_orders = []\n        for market in framework.markets:\n            orders = market.blotter.strategy_orders(strategy=strat, order_status=[OrderStatus.EXECUTABLE])\n            e_orders += orders\n            logger.info(f\"{len(orders)} orders executable in market {market.market_id}\")\n        if not e_orders:\n            break\n    else:\n        logger.warning(f\"failed to cancel {len(e_orders)} orders\")"
                            }
                        ],
                        "border": 0
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "this function would be called in BaseStrategy.finish()\ndownsides:\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_list",
                        "elements": [
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "If order takes longer than 3s to cancel, we d send out multiple cancelations for the same order (but maximum 5 and with 3s delay between attempts, so i guess that should be fine?)"
                                    }
                                ]
                            }
                        ],
                        "style": "bullet",
                        "indent": 0,
                        "border": 0
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "upsides:\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_list",
                        "elements": [
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "if an order slips through, we try to cancel again"
                                    }
                                ]
                            },
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "giving up instead of infinte while loop (maybe not perfect either, but the lesser evil?)"
                                    }
                                ]
                            }
                        ],
                        "style": "bullet",
                        "indent": 0,
                        "border": 0
                    }
                ]
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1686967771.202609",
        "client_msg_id": "67774086-d430-4b28-8cb6-0a9186316672",
        "text": "also, once the finish method is called, is it guaranteed the process_market_book wont be called after anymore?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1686894127.094519",
        "parent_user_id": "U01DVUAE2G1",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "I948m",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "also, once the finish method is called, is it guaranteed the process_market_book wont be called after anymore?"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]