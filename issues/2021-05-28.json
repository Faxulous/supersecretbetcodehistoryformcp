[
    {
        "user": "U01U34X8LHE",
        "type": "message",
        "ts": "1622214959.082000",
        "client_msg_id": "3479db6d-afd7-4c8d-a605-d8762b7a2c12",
        "text": "Hi. Can anyone help me with the MARKET_ON_CLOSE function? I did post before but never got a reply.\nI have code set up to place bets, but if I switch persistence type from LAPSE or PERSIST to MARKET_ON_CLOSE, I get FAILURE. I thought it could be because i was using delayed key, but am using live key now and still same.\n\nCode below:\n\n```limit_order = filters.limit_order(\n    price=12.5, size=2, persistence_type=\"MARKET_ON_CLOSE\"\n)\ninstruction = filters.place_instruction(\n    order_type=\"LIMIT\",\n    selection_id=runner.selection_id,\n    side=\"BACK\",\n    limit_order=limit_order,\n)\nplace_orders = trading.betting.place_orders(\n    market_id=j.market_id, instructions=[instruction], # list\n)```\n",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g88e8f037b7e",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/88e8f037b7e8faa85fa06e9df9004d94.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0020-72.png",
            "first_name": "",
            "real_name": "Phil Anderson",
            "display_name": "Phil Anderson",
            "team": "T4G9NBD2M",
            "name": "p.anderson81",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1622214959.082000",
        "reply_count": 6,
        "reply_users_count": 3,
        "latest_reply": "1622279297.083300",
        "reply_users": [
            "U4H19D1D2",
            "U01U34X8LHE",
            "U01DVUAE2G1"
        ],
        "replies": [
            {
                "user": "U4H19D1D2",
                "ts": "1622225462.082300"
            },
            {
                "user": "U01U34X8LHE",
                "ts": "1622236588.082500"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1622236966.082700"
            },
            {
                "user": "U01U34X8LHE",
                "ts": "1622241422.082900"
            },
            {
                "user": "U01DVUAE2G1",
                "ts": "1622269199.083100"
            },
            {
                "user": "U01U34X8LHE",
                "ts": "1622279297.083300"
            }
        ],
        "is_locked": false,
        "subscribed": true,
        "last_read": "1622279297.083300",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "xqci",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Hi. Can anyone help me with the MARKET_ON_CLOSE function? I did post before but never got a reply.\nI have code set up to place bets, but if I switch persistence type from LAPSE or PERSIST to MARKET_ON_CLOSE, I get FAILURE. I thought it could be because i was using delayed key, but am using live key now and still same.\n\nCode below:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "limit_order = filters.limit_order(\n    price=12.5, size=2, persistence_type=\"MARKET_ON_CLOSE\"\n)\ninstruction = filters.place_instruction(\n    order_type=\"LIMIT\",\n    selection_id=runner.selection_id,\n    side=\"BACK\",\n    limit_order=limit_order,\n)\nplace_orders = trading.betting.place_orders(\n    market_id=j.market_id, instructions=[instruction], # list\n)"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": []
                    }
                ]
            }
        ]
    },
    {
        "subtype": "channel_join",
        "user": "U023E5DLBUK",
        "text": "<@U023E5DLBUK> has joined the channel",
        "type": "message",
        "ts": "1622222155.082200"
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1622225462.082300",
        "client_msg_id": "5008993D-CE34-451D-B483-5BDD83B0546F",
        "text": "Just a failure? Any more info? Does the market have SP available?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1622214959.082000",
        "parent_user_id": "U01U34X8LHE",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "cLuBH",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Just a failure? Any more info? Does the market have SP available?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U01U34X8LHE",
        "type": "message",
        "ts": "1622236588.082500",
        "client_msg_id": "632e9b31-13fa-42e7-bdda-8228ed1718da",
        "text": "FAILURE\nStatus: FAILURE, BetId: None, Average Price Matched: None\n\nThis is all I get.\n\nMaybe I've misunderstood the concept. I'm betting on various pre-match football markets, and so maybe there isnt the SP option. I thought it would either match before KO or match at best price when market went inplay. I dont want the bet to cancel in case a bet on the other side has been matched.\n\nIs there a way to do this? Or even better would be if I could set a specific time before KO to match at best price",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g88e8f037b7e",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/88e8f037b7e8faa85fa06e9df9004d94.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0020-72.png",
            "first_name": "",
            "real_name": "Phil Anderson",
            "display_name": "Phil Anderson",
            "team": "T4G9NBD2M",
            "name": "p.anderson81",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1622214959.082000",
        "parent_user_id": "U01U34X8LHE",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "h1K+D",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "FAILURE\nStatus: FAILURE, BetId: None, Average Price Matched: None\n\nThis is all I get.\n\nMaybe I've misunderstood the concept. I'm betting on various pre-match football markets, and so maybe there isnt the SP option. I thought it would either match before KO or match at best price when market went inplay. I dont want the bet to cancel in case a bet on the other side has been matched.\n\nIs there a way to do this? Or even better would be if I could set a specific time before KO to match at best price"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1622236966.082700",
        "client_msg_id": "c8f67336-40de-4b1f-b642-dbd8e9f7c7b1",
        "text": "i m not into football, but i think there is no SP on those markets. You can check the market_book (or even just the website) if SP is available on the market you are trying to bet on",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1622214959.082000",
        "parent_user_id": "U01U34X8LHE",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Y806K",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "i m not into football, but i think there is no SP on those markets. You can check the market_book (or even just the website) if SP is available on the market you are trying to bet on"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U01U34X8LHE",
        "type": "message",
        "ts": "1622241422.082900",
        "client_msg_id": "29e82f3e-6c2e-47da-9f07-7b411726026d",
        "text": "Hmm yeah I see now. Any idea if I have any other options? So i'm not leaving myself exposed when the market goes in-play? Ideally it would be something like cashout an hour before KO",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g88e8f037b7e",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/88e8f037b7e8faa85fa06e9df9004d94.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0020-72.png",
            "first_name": "",
            "real_name": "Phil Anderson",
            "display_name": "Phil Anderson",
            "team": "T4G9NBD2M",
            "name": "p.anderson81",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1622214959.082000",
        "parent_user_id": "U01U34X8LHE",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Q9a65",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Hmm yeah I see now. Any idea if I have any other options? So i'm not leaving myself exposed when the market goes in-play? Ideally it would be something like cashout an hour before KO"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U01DVUAE2G1",
        "type": "message",
        "ts": "1622269199.083100",
        "client_msg_id": "fdd4ba49-a791-4857-9ad8-080d165bce0f",
        "text": "instead of SP you could use the market price to cash out. This will reduce your EV though and could even turn a +EV into -EV, so you should check beforehand if you d still have an edge left and if you really want to do that only for some safety.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gd87aca58eae",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/d87aca58eaeabd0a953b4bc4204bbbaf.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png",
            "first_name": "",
            "real_name": "Aaron Smith",
            "display_name": "Aaron Smith",
            "team": "T4G9NBD2M",
            "name": "smiffyaaron",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1622214959.082000",
        "parent_user_id": "U01U34X8LHE",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "fHSj",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "instead of SP you could use the market price to cash out. This will reduce your EV though and could even turn a +EV into -EV, so you should check beforehand if you d still have an edge left and if you really want to do that only for some safety."
                            }
                        ]
                    }
                ]
            }
        ]
    }
]