[
    {
        "user": "UG03WDCHH",
        "type": "message",
        "ts": "1652590117.998899",
        "client_msg_id": "828980a4-da77-43ff-ab0a-a6d5c6c5a254",
        "text": "Hey I am getting several *`INVALID_SESSION_INFORMATION` Errors from the `list_cleared_orders` call in Flumine details in* :thread: ",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g03ce37265ba",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/803ce37265ba7d4f1be4d779100eaa60.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "Rudeger",
            "real_name": "Rudeger Jamison",
            "display_name": "Rudeger Jamison",
            "team": "T4G9NBD2M",
            "name": "ben.k.muller",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "reply_count": 48,
        "reply_users_count": 3,
        "latest_reply": "1652871158.425249",
        "reply_users": [
            "UG03WDCHH",
            "U4H19D1D2",
            "UNW8Q88EL"
        ],
        "replies": [
            {
                "user": "UG03WDCHH",
                "ts": "1652590128.250069"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652590155.492059"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652590272.205659"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652590648.678209"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652591460.127449"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652591600.127809"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652591651.151499"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652591667.416879"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652591835.247969"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652591836.684259"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652591868.265109"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652592809.875869"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652592880.972679"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652592923.481209"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652593038.861909"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652593271.639639"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652593292.211969"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652653824.747219"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652653832.079469"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652662431.017579"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652681080.440299"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652681092.188889"
            },
            {
                "user": "UNW8Q88EL",
                "ts": "1652690329.431559"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652690398.317829"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652690487.198959"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652690597.263769"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652690635.293299"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652691512.257699"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652691639.056009"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652691690.393309"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652691789.376509"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652691821.763339"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652692173.015629"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652692192.221609"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652692427.231459"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652813121.911109"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652815494.455869"
            },
            {
                "user": "UNW8Q88EL",
                "ts": "1652865349.671259"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652865425.956379"
            },
            {
                "user": "UNW8Q88EL",
                "ts": "1652865632.592369"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652867336.116339"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652867389.120119"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652867432.598409"
            },
            {
                "user": "UG03WDCHH",
                "ts": "1652867432.931639"
            },
            {
                "user": "UNW8Q88EL",
                "ts": "1652868514.852069"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1652868702.078449"
            },
            {
                "user": "UNW8Q88EL",
                "ts": "1652869374.481509"
            },
            {
                "user": "UNW8Q88EL",
                "ts": "1652871158.425249"
            }
        ],
        "is_locked": false,
        "subscribed": true,
        "last_read": "1652871158.425249",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "aUK",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Hey I am getting several "
                            },
                            {
                                "type": "text",
                                "text": "INVALID_SESSION_INFORMATION",
                                "style": {
                                    "bold": true,
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " Errors from the ",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "list_cleared_orders",
                                "style": {
                                    "bold": true,
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " call in Flumine details in ",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "emoji",
                                "name": "thread",
                                "unicode": "1f9f5",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " ",
                                "style": {
                                    "bold": true
                                }
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UG03WDCHH",
        "type": "message",
        "ts": "1652590128.250069",
        "client_msg_id": "0873cf4f-9b61-46fb-802a-13b0bca1fd18",
        "text": "```Traceback (most recent call last):\\n File \\\"\/usr\/local\/lib\/python3.9\/site-packages\/flumine\/worker.py\\\", line 229, in _get_cleared_market\\n cleared_markets = betting_client.betting.list_cleared_orders(\\n File \\\"\/usr\/local\/lib\/python3.9\/site-packages\/betfairlightweight\/endpoints\/betting.py\\\", line 434, in list_cleared_orders\\n (response, response_json, elapsed_time) = self.request(method, params, session)\\n File \\\"\/usr\/local\/lib\/python3.9\/site-packages\/betfairlightweight\/endpoints\/baseendpoint.py\\\", line 55, in request\\n self._error_handler(response_json, method, params)\\n File \\\"\/usr\/local\/lib\/python3.9\/site-packages\/betfairlightweight\/endpoints\/baseendpoint.py\\\", line 81, in _error_handler\\n raise self._error(response, method, params)\\nbetfairlightweight.exceptions.APIError: SportsAPING\/v1.0\/listClearedOrders \\nParams: {'betStatus': 'SETTLED', 'marketIds': ['1.199151822'], 'customerStrategyRefs': ['ip-10-2-10-44.e'], 'settledDateRange': {'from': None, 'to': None}, 'groupBy': 'MARKET'} \\nException: None \\nError: {'code': -32099, 'message': 'ANGX-0003', 'data': {'APINGException': {'requestUUID': 'ie1-ang03b-prd-04211134-00307ff265', 'errorCode': 'INVALID_SESSION_INFORMATION', 'errorDetails': ''}, 'exceptionname': 'APINGException'}} \\nFull Response: {'jsonrpc': '2.0', 'error': {'code': -32099, 'message': 'ANGX-0003', 'data': {'APINGException': {'requestUUID': 'ie1-ang03b-prd-04211134-00307ff265', 'errorCode': 'INVALID_SESSION_INFORMATION', 'errorDetails': ''}, 'exceptionname': 'APINGException'}}, 'id': 1}\",```",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g03ce37265ba",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/803ce37265ba7d4f1be4d779100eaa60.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "Rudeger",
            "real_name": "Rudeger Jamison",
            "display_name": "Rudeger Jamison",
            "team": "T4G9NBD2M",
            "name": "ben.k.muller",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "UGgW",
                "elements": [
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Traceback (most recent call last):\\n File \\\"\/usr\/local\/lib\/python3.9\/site-packages\/flumine\/worker.py\\\", line 229, in _get_cleared_market\\n cleared_markets = betting_client.betting.list_cleared_orders(\\n File \\\"\/usr\/local\/lib\/python3.9\/site-packages\/betfairlightweight\/endpoints\/betting.py\\\", line 434, in list_cleared_orders\\n (response, response_json, elapsed_time) = self.request(method, params, session)\\n File \\\"\/usr\/local\/lib\/python3.9\/site-packages\/betfairlightweight\/endpoints\/baseendpoint.py\\\", line 55, in request\\n self._error_handler(response_json, method, params)\\n File \\\"\/usr\/local\/lib\/python3.9\/site-packages\/betfairlightweight\/endpoints\/baseendpoint.py\\\", line 81, in _error_handler\\n raise self._error(response, method, params)\\nbetfairlightweight.exceptions.APIError: SportsAPING\/v1.0\/listClearedOrders \\nParams: {'betStatus': 'SETTLED', 'marketIds': ['1.199151822'], 'customerStrategyRefs': ['ip-10-2-10-44.e'], 'settledDateRange': {'from': None, 'to': None}, 'groupBy': 'MARKET'} \\nException: None \\nError: {'code': -32099, 'message': 'ANGX-0003', 'data': {'APINGException': {'requestUUID': 'ie1-ang03b-prd-04211134-00307ff265', 'errorCode': 'INVALID_SESSION_INFORMATION', 'errorDetails': ''}, 'exceptionname': 'APINGException'}} \\nFull Response: {'jsonrpc': '2.0', 'error': {'code': -32099, 'message': 'ANGX-0003', 'data': {'APINGException': {'requestUUID': 'ie1-ang03b-prd-04211134-00307ff265', 'errorCode': 'INVALID_SESSION_INFORMATION', 'errorDetails': ''}, 'exceptionname': 'APINGException'}}, 'id': 1}\","
                            }
                        ],
                        "border": 0
                    }
                ]
            }
        ]
    },
    {
        "user": "UG03WDCHH",
        "type": "message",
        "ts": "1652590155.492059",
        "client_msg_id": "38d7de7b-5557-47fb-9d59-23831f295d35",
        "text": "any ideas on how to debug this?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g03ce37265ba",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/803ce37265ba7d4f1be4d779100eaa60.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "Rudeger",
            "real_name": "Rudeger Jamison",
            "display_name": "Rudeger Jamison",
            "team": "T4G9NBD2M",
            "name": "ben.k.muller",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "gv0I",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "any ideas on how to debug this?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UG03WDCHH",
        "type": "message",
        "ts": "1652590272.205659",
        "client_msg_id": "14063e7c-76de-4557-9d4b-a7a023f7329b",
        "text": "It appears as though the session has lapsed and Flumine hasnt renewed it, when I run another local instance of Flumine the error does not occur and the bot starts betting again.\n\nIs there a parameter to provide to make sure Flumine handles my session for me?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g03ce37265ba",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/803ce37265ba7d4f1be4d779100eaa60.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "Rudeger",
            "real_name": "Rudeger Jamison",
            "display_name": "Rudeger Jamison",
            "team": "T4G9NBD2M",
            "name": "ben.k.muller",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "9x2",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "It appears as though the session has lapsed and Flumine hasnt renewed it, when I run another local instance of Flumine the error does not occur and the bot starts betting again.\n\nIs there a parameter to provide to make sure Flumine handles my session for me?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1652590648.678209",
        "client_msg_id": "87B3D27D-893C-408C-9846-F00902F48FAF",
        "text": "There is a worker for it, can you see any logs?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Z2N",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "There is a worker for it, can you see any logs?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UG03WDCHH",
        "type": "message",
        "ts": "1652591460.127449",
        "client_msg_id": "94862dbe-a880-4c7a-bd4f-86cbd74b58f7",
        "text": "there are a lot of logs, do you happen to know the message I can filter on",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g03ce37265ba",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/803ce37265ba7d4f1be4d779100eaa60.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "Rudeger",
            "real_name": "Rudeger Jamison",
            "display_name": "Rudeger Jamison",
            "team": "T4G9NBD2M",
            "name": "ben.k.muller",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "IdX\/m",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "there are a lot of logs, do you happen to know the message I can filter on"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1652591600.127809",
        "client_msg_id": "E1421502-746F-406D-87BE-6B8C141BAFB0",
        "text": "It’s the keep_alive worker <https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/worker.py|https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/worker.py>",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "attachments": [
            {
                "id": 1,
                "footer_icon": "https:\/\/slack.github.com\/static\/img\/favicon-neutral.png",
                "color": "24292f",
                "bot_id": "B021ZJYSBMW",
                "app_unfurl_url": "https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/worker.py",
                "is_app_unfurl": true,
                "app_id": "A01BP7R4KNY",
                "fallback": "<https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/worker.py | worker.py>",
                "text": "```\nimport time\nimport threading\nimport logging\nfrom typing import Callable, Optional\nfrom betfairlightweight import BetfairError, filters, exceptions\n\nfrom . import config\nfrom .events import events\nfrom .utils import chunks\nfrom .clients import ExchangeType\n\nlogger = logging.getLogger(__name__)\n\n\nclass BackgroundWorker(threading.Thread):\n    def __init__(\n        self,\n        flumine,\n        function: Callable,\n        interval: Optional[int],\n        func_args: tuple = None,\n        func_kwargs: dict = None,\n        start_delay: int = 0,\n        context: dict = None,\n        name: str = None,\n        **kwargs\n    ):\n        name = name or function.__name__\n        threading.Thread.__init__(self, daemon=True, name=name, **kwargs)\n        self.flumine = flumine\n        self.function = function\n        self.interval = interval\n        self.func_args = func_args if func_args is not None else []\n        self.func_kwargs = func_kwargs if func_kwargs is not None else {}\n        self.start_delay = start_delay\n        self.context = context or {}\n        self._running = False\n\n    def run(self) -&gt; None:\n        <http:\/\/logger.info|logger.info>(\n            \"BackgroundWorker {0} starting\".format(self.name),\n            extra={\n                \"worker_name\": self.name,\n                \"function\": self.function,\n                \"context\": self.context,\n                \"start_delay\": self.start_delay,\n                \"interval\": self.interval,\n                \"func_args\": self.func_args,\n                \"func_kwargs\": self.func_kwargs,\n            },\n        )\n        time.sleep(self.start_delay)\n        self._running = True\n        while self._running:\n            logger.debug(\n                \"BackgroundWorker {0} executing\".format(self.name),\n                extra={\n                    \"worker_name\": self.name,\n                    \"function\": self.function,\n                    \"context\": self.context,\n                },\n            )\n            try:\n                self.function(\n                    self.context, self.flumine, *self.func_args, **self.func_kwargs\n                )\n            except Exception as e:\n                logger.error(\n                    \"Error in BackgroundWorker {0}: {1}\".format(self.name, e),\n                    extra={\n                        \"worker_name\": self.name,\n                        \"function\": self.function,\n                        \"context\": self.context,\n                    },\n                    exc_info=True,\n                )\n            if self.interval is None:\n                break\n            time.sleep(self.interval)\n\n    def shutdown(self, timeout: int = 4) -&gt; None:\n        <http:\/\/logger.info|logger.info>(\n            \"BackgroundWorker {0} shutting down\".format(self.name),\n            extra={\n                \"worker_name\": self.name,\n                \"function\": self.function,\n            },\n        )\n        self._running = False\n        self.join(timeout)\n\n\ndef keep_alive(context: dict, flumine) -&gt; None:\n    \"\"\"Attempt keep alive if required or\n    login if keep alive failed\n    \"\"\"\n    for client in flumine.clients:\n        if client.EXCHANGE == ExchangeType.BETFAIR:\n            if client.betting_client.session_token:\n                resp = client.keep_alive()\n                if resp is None or resp.status == \"SUCCESS\":\n                    continue\n        elif client.EXCHANGE == ExchangeType.BETCONNECT:\n            resp = client.keep_alive()\n            if resp:\n                continue\n        # keep-alive failed lets try a login\n        client.login()\n\n\ndef poll_market_catalogue(context: dict, flumine) -&gt; None:\n    # get betfair client\n    client = flumine.clients.get_betfair_default()\n    markets = [\n        m.market_id\n        for m in list(flumine.markets.markets.values())\n        if m.update_market_catalogue and not m.closed\n    ]\n    for market_ids in chunks(markets, 25):\n        try:\n            market_catalogues = client.betting_client.betting.list_market_catalogue(\n                filter=filters.market_filter(market_ids=market_ids),\n                max_results=25,\n                market_projection=[\n                    \"COMPETITION\",\n                    \"EVENT\",\n                    \"EVENT_TYPE\",\n                    \"RUNNER_DESCRIPTION\",\n                    \"RUNNER_METADATA\",\n                    \"MARKET_START_TIME\",\n                    \"MARKET_DESCRIPTION\",\n                ],\n            )\n        except exceptions.StatusCodeError as e:\n            # log as warning to prevent duplicate logs on betfair meltdown\n            logger.warning(\n                \"poll_market_catalogue StatusCodeError\",\n                extra={\"trading_function\": \"list_market_catalogue\", \"response\": e},\n                exc_info=True,\n            )\n            continue\n        except BetfairError as e:\n            logger.error(\n                \"poll_market_catalogue error\",\n                exc_info=True,\n                extra={\"trading_function\": \"list_market_catalogue\", \"response\": e},\n            )\n            continue\n\n        if market_catalogues:\n            flumine.handler_queue.put(events.MarketCatalogueEvent(market_catalogues))\n\n\ndef poll_account_balance(context: dict, flumine) -&gt; None:\n    for client in flumine.clients:\n        client.update_account_details()\n        <http:\/\/logger.info|logger.info>(\"Client update account details\", extra=<http:\/\/client.info|client.info>)\n        if client.account_funds:\n            flumine.log_control(events.BalanceEvent(client))\n\n\ndef poll_market_closure(context: dict, flumine) -&gt; None:\n    markets = [\n        market for market in list(flumine.markets.markets.values()) if market.closed\n    ]\n    for client in flumine.clients:\n        if (\n            client.EXCHANGE != ExchangeType.BETFAIR\n            or client.paper_trade\n            or client.market_recording_mode\n        ):\n            continue\n        for market in markets:\n            if client.username not in market.orders_cleared:\n                if _get_cleared_orders(\n                    flumine, client.betting_client, market.market_id\n                ):\n                    market.orders_cleared.append(client.username)\n            if client.username not in market.market_cleared:\n                if _get_cleared_market(\n                    flumine, client.betting_client, market.market_id\n                ):\n                    market.market_cleared.append(client.username)\n\n\ndef _get_cleared_orders(flumine, betting_client, market_id: str) -&gt; bool:\n    from_record = 0\n    while True:\n        try:\n            cleared_orders = betting_client.betting.list_cleared_orders(\n                bet_status=\"SETTLED\",\n                from_record=from_record,\n                market_ids=[market_id],\n                customer_strategy_refs=[config.customer_strategy_ref],\n            )\n        except exceptions.StatusCodeError as e:\n            # log as warning to prevent duplicate logs on betfair meltdown\n            logger.warning(\n                \"_get_cleared_orders StatusCodeError\",\n                extra={\"trading_function\": \"list_cleared_orders\", \"response\": e},\n                exc_info=True,\n            )\n            return False\n        except BetfairError as e:\n            logger.error(\n                \"_get_cleared_orders error\",\n                extra={\"trading_function\": \"list_cleared_orders\", \"response\": e},\n                exc_info=True,\n            )\n            return False\n\n        <http:\/\/logger.info|logger.info>(\n            \"{0}: {1} cleared orders found, more available: {2}\".format(\n                market_id, len(cleared_orders.orders), cleared_orders.more_available\n            )\n        )\n        cleared_orders.market_id = market_id\n        flumine.handler_queue.put(events.ClearedOrdersEvent(cleared_orders))\n        flumine.log_control(events.ClearedOrdersEvent(cleared_orders))\n\n        from_record += len(cleared_orders.orders)\n        if not cleared_orders.more_available:\n            break\n    re…",
                "title": "<https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/worker.py | worker.py>",
                "footer": "<https:\/\/github.com\/betcode-org\/flumine|betcode-org\/flumine>",
                "mrkdwn_in": [
                    "text"
                ]
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "K+e9",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "It’s the keep_alive worker "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/worker.py",
                                "text": "https:\/\/github.com\/betcode-org\/flumine\/blob\/master\/flumine\/worker.py"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1652591651.151499",
        "client_msg_id": "119DAACB-0BBC-4A12-890D-6491543973D0",
        "text": "Any errors would have keep_alive in them ",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "DTh",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Any errors would have keep_alive in them "
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UG03WDCHH",
        "type": "message",
        "ts": "1652591667.416879",
        "client_msg_id": "b059ad59-184d-491c-8f97-f9d659e58c29",
        "text": "nothing present in the logs :shrug:",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g03ce37265ba",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/803ce37265ba7d4f1be4d779100eaa60.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "Rudeger",
            "real_name": "Rudeger Jamison",
            "display_name": "Rudeger Jamison",
            "team": "T4G9NBD2M",
            "name": "ben.k.muller",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "LmO",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "nothing present in the logs "
                            },
                            {
                                "type": "emoji",
                                "name": "shrug",
                                "unicode": "1f937"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UG03WDCHH",
        "type": "message",
        "ts": "1652591835.247969",
        "client_msg_id": "5afeedf7-7856-4ed9-8703-644887710ecf",
        "text": "actually, found these",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g03ce37265ba",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/803ce37265ba7d4f1be4d779100eaa60.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "Rudeger",
            "real_name": "Rudeger Jamison",
            "display_name": "Rudeger Jamison",
            "team": "T4G9NBD2M",
            "name": "ben.k.muller",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "qMidx",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "actually, found these"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UG03WDCHH",
        "type": "message",
        "ts": "1652591836.684259",
        "client_msg_id": "6e5fee26-86d9-4d30-8532-606f58e932e0",
        "text": "```\nTraceback (most recent call last):\nFile \"\/usr\/local\/lib\/python3.9\/site-packages\/flumine\/clients\/betfairclient.py\", line 44, in keep_alive\nreturn self.betting_client.keep_alive()\nFile \"\/usr\/local\/lib\/python3.9\/site-packages\/betfairlightweight\/endpoints\/keepalive.py\", line 30, in __call__\n(response, response_json, elapsed_time) = self.request(session=session)\nFile \"\/usr\/local\/lib\/python3.9\/site-packages\/betfairlightweight\/endpoints\/keepalive.py\", line 60, in request\nself._error_handler(response_json)\nFile \"\/usr\/local\/lib\/python3.9\/site-packages\/betfairlightweight\/endpoints\/keepalive.py\", line 67, in _error_handler\nraise self._error(response)\nbetfairlightweight.exceptions.KeepAliveError: API keepAlive FAIL: NO_SESSION```",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g03ce37265ba",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/803ce37265ba7d4f1be4d779100eaa60.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "Rudeger",
            "real_name": "Rudeger Jamison",
            "display_name": "Rudeger Jamison",
            "team": "T4G9NBD2M",
            "name": "ben.k.muller",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "HTv\/v",
                "elements": [
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\nTraceback (most recent call last):\nFile \"\/usr\/local\/lib\/python3.9\/site-packages\/flumine\/clients\/betfairclient.py\", line 44, in keep_alive\nreturn self.betting_client.keep_alive()\nFile \"\/usr\/local\/lib\/python3.9\/site-packages\/betfairlightweight\/endpoints\/keepalive.py\", line 30, in __call__\n(response, response_json, elapsed_time) = self.request(session=session)\nFile \"\/usr\/local\/lib\/python3.9\/site-packages\/betfairlightweight\/endpoints\/keepalive.py\", line 60, in request\nself._error_handler(response_json)\nFile \"\/usr\/local\/lib\/python3.9\/site-packages\/betfairlightweight\/endpoints\/keepalive.py\", line 67, in _error_handler\nraise self._error(response)\nbetfairlightweight.exceptions.KeepAliveError: API keepAlive FAIL: NO_SESSION"
                            }
                        ],
                        "border": 0
                    }
                ]
            }
        ]
    },
    {
        "user": "UG03WDCHH",
        "type": "message",
        "ts": "1652591868.265109",
        "client_msg_id": "089ecafe-d7c3-4c7a-b07a-84a30ec1873d",
        "text": "lots of them",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g03ce37265ba",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/803ce37265ba7d4f1be4d779100eaa60.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "Rudeger",
            "real_name": "Rudeger Jamison",
            "display_name": "Rudeger Jamison",
            "team": "T4G9NBD2M",
            "name": "ben.k.muller",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "9xn3t",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "lots of them"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1652592809.875869",
        "client_msg_id": "D82E0A6C-0972-4806-B70C-A362CE894585",
        "text": "Hmm, does it do this every time?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "cIDp",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Hmm, does it do this every time?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UG03WDCHH",
        "type": "message",
        "ts": "1652592880.972679",
        "client_msg_id": "d580cc2b-3504-40e6-9a5f-118b12a7e465",
        "text": "I deployed it yesterday to AWS and it appeared to work the whole day and then these errors started today, so after the container had been running for about 24 hrs",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g03ce37265ba",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/803ce37265ba7d4f1be4d779100eaa60.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "Rudeger",
            "real_name": "Rudeger Jamison",
            "display_name": "Rudeger Jamison",
            "team": "T4G9NBD2M",
            "name": "ben.k.muller",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "XrJCO",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I deployed it yesterday to AWS and it appeared to work the whole day and then these errors started today, so after the container had been running for about 24 hrs"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1652592923.481209",
        "client_msg_id": "96ADCA3E-7B3C-4C4C-BF02-5C5A703967A3",
        "text": "Can you find the first error, Ie is there any error that isn’t a no session  ",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "LhF",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Can you find the first error, Ie is there any error that isn’t a no session  "
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UG03WDCHH",
        "type": "message",
        "ts": "1652593038.861909",
        "client_msg_id": "fa65de1c-b3dd-4c2b-8057-eaf7b0c61819",
        "text": "let me try",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g03ce37265ba",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/803ce37265ba7d4f1be4d779100eaa60.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "Rudeger",
            "real_name": "Rudeger Jamison",
            "display_name": "Rudeger Jamison",
            "team": "T4G9NBD2M",
            "name": "ben.k.muller",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "OGA",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "let me try"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UG03WDCHH",
        "type": "message",
        "ts": "1652593271.639639",
        "client_msg_id": "1b745be8-71cd-48a2-b3d9-df44dccfa581",
        "text": "nothing of note,\n\nThe closest error since the first `NO_SESSION` error was just a `STRATEGY_EXPOSURE` Warning, no actual errors.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g03ce37265ba",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/803ce37265ba7d4f1be4d779100eaa60.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "Rudeger",
            "real_name": "Rudeger Jamison",
            "display_name": "Rudeger Jamison",
            "team": "T4G9NBD2M",
            "name": "ben.k.muller",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "VFH",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "nothing of note,\n\nThe closest error since the first "
                            },
                            {
                                "type": "text",
                                "text": "NO_SESSION",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " error was just a "
                            },
                            {
                                "type": "text",
                                "text": "STRATEGY_EXPOSURE",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " Warning, no actual errors."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UG03WDCHH",
        "type": "message",
        "ts": "1652593292.211969",
        "client_msg_id": "7ef0a060-eccd-454c-8201-6ef82c561c08",
        "text": "i have restarted the task and will monitor to see if it happens again, very strange.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g03ce37265ba",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/803ce37265ba7d4f1be4d779100eaa60.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "Rudeger",
            "real_name": "Rudeger Jamison",
            "display_name": "Rudeger Jamison",
            "team": "T4G9NBD2M",
            "name": "ben.k.muller",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1652590117.998899",
        "parent_user_id": "UG03WDCHH",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "=wciH",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "i have restarted the task and will monitor to see if it happens again, very strange."
                            }
                        ]
                    }
                ]
            }
        ],
        "reactions": [
            {
                "name": "+1",
                "users": [
                    "U4H19D1D2"
                ],
                "count": 1
            }
        ]
    }
]