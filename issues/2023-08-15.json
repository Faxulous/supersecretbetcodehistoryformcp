[
    {
        "user": "UNW8Q88EL",
        "type": "message",
        "ts": "1692093153.974699",
        "client_msg_id": "AD8B787A-E208-429A-8E39-11A9C79E75C9",
        "text": "Hi <@UCQB6S222> <@UBS7QANF3> if you can provide an example connectionId when this happens we can take a look",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "cc2c2669d548",
            "image_72": "https:\/\/avatars.slack-edge.com\/2021-10-21\/2643683806753_cc2c2669d548a3476e65_72.jpg",
            "first_name": "Neil",
            "real_name": "Neil T (Betfair)",
            "display_name": "Neil T (Betfair)",
            "team": "T4G9NBD2M",
            "name": "neil.thomas",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1691786002.909899",
        "parent_user_id": "UCQB6S222",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Ycz",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Hi "
                            },
                            {
                                "type": "user",
                                "user_id": "UCQB6S222"
                            },
                            {
                                "type": "text",
                                "text": " "
                            },
                            {
                                "type": "user",
                                "user_id": "UBS7QANF3"
                            },
                            {
                                "type": "text",
                                "text": " if you can provide an example connectionId when this happens we can take a look"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1692093451.050119",
        "client_msg_id": "e6c06f52-8512-4b66-8f9a-f51cc7d6794f",
        "text": "Here are a few from me\n\n203-120823142118-2859966\n204-120823113112-2884551\n210-100823113134-2670720\n208-120823142118-2905174",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1691786002.909899",
        "parent_user_id": "UCQB6S222",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "QMt",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Here are a few from me\n\n203-120823142118-2859966\n204-120823113112-2884551\n210-100823113134-2670720\n208-120823142118-2905174"
                            }
                        ]
                    }
                ]
            }
        ],
        "reactions": [
            {
                "name": "+1",
                "users": [
                    "UNW8Q88EL"
                ],
                "count": 1
            }
        ]
    },
    {
        "user": "UNW8Q88EL",
        "type": "message",
        "ts": "1692093507.765789",
        "client_msg_id": "2E041C06-336A-470E-A444-478594EE158E",
        "text": "Thanks <@U4H19D1D2> we’ll take a look",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "cc2c2669d548",
            "image_72": "https:\/\/avatars.slack-edge.com\/2021-10-21\/2643683806753_cc2c2669d548a3476e65_72.jpg",
            "first_name": "Neil",
            "real_name": "Neil T (Betfair)",
            "display_name": "Neil T (Betfair)",
            "team": "T4G9NBD2M",
            "name": "neil.thomas",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1691786002.909899",
        "parent_user_id": "UCQB6S222",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "25f",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Thanks "
                            },
                            {
                                "type": "user",
                                "user_id": "U4H19D1D2"
                            },
                            {
                                "type": "text",
                                "text": " "
                            },
                            {
                                "type": "text",
                                "text": "we’ll"
                            },
                            {
                                "type": "text",
                                "text": " take a look"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UNW8Q88EL",
        "type": "message",
        "ts": "1692097875.922589",
        "client_msg_id": "3DFD048B-7C7E-4484-941C-0C6C92C92BB0",
        "text": "<@U4H19D1D2> I guess the answer is yes to the below but potentially quicker than we’d expect? ",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "cc2c2669d548",
            "image_72": "https:\/\/avatars.slack-edge.com\/2021-10-21\/2643683806753_cc2c2669d548a3476e65_72.jpg",
            "first_name": "Neil",
            "real_name": "Neil T (Betfair)",
            "display_name": "Neil T (Betfair)",
            "team": "T4G9NBD2M",
            "name": "neil.thomas",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1691786002.909899",
        "parent_user_id": "UCQB6S222",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "GGseH",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "user",
                                "user_id": "U4H19D1D2"
                            },
                            {
                                "type": "text",
                                "text": " I guess the answer is yes to the below but potentially quicker than "
                            },
                            {
                                "type": "text",
                                "text": "we’d"
                            },
                            {
                                "type": "text",
                                "text": " expect? "
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UNW8Q88EL",
        "type": "message",
        "ts": "1692097890.588479",
        "client_msg_id": "6C6818D9-F02E-458D-9828-8BCB6F83303F",
        "text": "_for all the connections above in ESA logs we can see only connection being requested, but no authentication and subscription after that. Because of this, connection not having subscription, ESA runs an Idle check , sends error message on the socket and then closes connection.\nCan you confirm  that after connection is created an authentication and marketSubscription\/orderSubscription\/operation are sent?_",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "cc2c2669d548",
            "image_72": "https:\/\/avatars.slack-edge.com\/2021-10-21\/2643683806753_cc2c2669d548a3476e65_72.jpg",
            "first_name": "Neil",
            "real_name": "Neil T (Betfair)",
            "display_name": "Neil T (Betfair)",
            "team": "T4G9NBD2M",
            "name": "neil.thomas",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1691786002.909899",
        "parent_user_id": "UCQB6S222",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "jGrr",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "for all the connections above in ESA logs we can see only connection being requested, but no authentication and subscription after that. Because of this, connection not having subscription, ESA runs an Idle check , sends error message on the socket and then closes connection.\nCan you confirm  that after connection is created an authentication and marketSubscription\/orderSubscription\/operation are sent?",
                                "style": {
                                    "bold": false,
                                    "italic": true,
                                    "strike": false
                                }
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1692098782.016539",
        "client_msg_id": "1c707f88-a48d-4cc5-86da-ded90d4b0269",
        "text": "100% sent although I can't currently replicate locally, anyone else?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1691786002.909899",
        "parent_user_id": "UCQB6S222",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "cauS",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "100% sent although I can't currently replicate locally, anyone else?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "text": "I have managed to replicate but only when I send an order and market stream connection at the same time, it looks like a race condition, either at our end or yours",
        "files": [
            {
                "id": "F05MUP0PW7L",
                "mode": "hidden_by_limit"
            }
        ],
        "upload": false,
        "user": "U4H19D1D2",
        "display_as_bot": false,
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "liK",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I have managed to replicate but only when I send an order and market stream connection at the same time, it looks like a race condition, either at our end or yours"
                            }
                        ]
                    }
                ]
            }
        ],
        "type": "message",
        "ts": "1692099060.598569",
        "client_msg_id": "3ab9e030-7b05-4e4a-89f3-d106880b0add",
        "thread_ts": "1691786002.909899",
        "parent_user_id": "UCQB6S222",
        "reactions": [
            {
                "name": "+1",
                "users": [
                    "UNW8Q88EL"
                ],
                "count": 1
            }
        ]
    },
    {
        "user": "UNW8Q88EL",
        "type": "message",
        "ts": "1692112641.042689",
        "client_msg_id": "286316EE-87E3-4FAD-9491-A6947E36228D",
        "text": "Hi <@U4H19D1D2> - see comments from our dev team below:\n\n_In the example we can see in ESA logs that subscription for Order is successful, but for Market can only see connection being created and then stopped due to idle timeout. Is it possible that client sends authentication and market subscription requests on the connection_id for Orderstream? \nIn client logs above  there are 2 identical SUCCESS (5 connections available) log lines for OrderStream, but none for MarketStream.\nFrom ESA side there are no race conditions as the 2 connectionIds above are managed by 2 different ESA hosts.\nMight be useful for customer after connection is established all logs to have connectionId appended for easier investigation_",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "cc2c2669d548",
            "image_72": "https:\/\/avatars.slack-edge.com\/2021-10-21\/2643683806753_cc2c2669d548a3476e65_72.jpg",
            "first_name": "Neil",
            "real_name": "Neil T (Betfair)",
            "display_name": "Neil T (Betfair)",
            "team": "T4G9NBD2M",
            "name": "neil.thomas",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1691786002.909899",
        "parent_user_id": "UCQB6S222",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "rRdX",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Hi "
                            },
                            {
                                "type": "user",
                                "user_id": "U4H19D1D2"
                            },
                            {
                                "type": "text",
                                "text": " - see comments from our dev team below:\n\n"
                            },
                            {
                                "type": "text",
                                "text": "In the example we can see in ESA logs that subscription for Order is successful, but for Market can only see connection being created and then stopped due to idle timeout. Is it possible that client sends authentication and market subscription requests on the connection_id for Orderstream? \nIn client logs above  there are 2 identical SUCCESS (5 connections available) log lines for OrderStream, but none for MarketStream.\nFrom ESA side there are no race conditions as the 2 connectionIds above are managed by 2 different ESA hosts.\nMight be useful for customer after connection is established all logs to have connectionId appended for easier investigation",
                                "style": {
                                    "bold": false,
                                    "italic": true,
                                    "strike": false
                                }
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UBS7QANF3",
        "type": "message",
        "ts": "1692113282.319369",
        "client_msg_id": "9dc335e9-5cce-40e0-9c1a-24e05847c0f3",
        "text": "<@U4H19D1D2> just reviewing our background to the issue when we first observed it and put in our workaround. I believe the issue is here: <https:\/\/github.com\/betcode-org\/betfair\/blob\/7118b471e61282d87630bcdc5d6de6b69a59cfa6\/betfairlightweight\/streaming\/betfairstream.py#L284-L285>. I think we need to wait for the <https:\/\/docs.developer.betfair.com\/plugins\/servlet\/mobile?contentId=6094862#ExchangeStreamAPI-Connection\/ConnectionMessage|connection message> before sending the authentication message",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gaaf844a4a90",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/eaaf844a4a905431d83430e563b077aa.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0011-72.png",
            "first_name": "",
            "real_name": "Maurice Berk",
            "display_name": "Mo",
            "team": "T4G9NBD2M",
            "name": "maurice",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1691786002.909899",
        "parent_user_id": "UCQB6S222",
        "attachments": [
            {
                "id": 1,
                "footer_icon": "https:\/\/slack.github.com\/static\/img\/favicon-neutral.png",
                "color": "24292f",
                "bot_id": "B021ZJYSBMW",
                "app_unfurl_url": "https:\/\/github.com\/betcode-org\/betfair\/blob\/7118b471e61282d87630bcdc5d6de6b69a59cfa6\/betfairlightweight\/streaming\/betfairstream.py#L284-L285",
                "is_app_unfurl": true,
                "app_id": "A01BP7R4KNY",
                "fallback": "<https:\/\/github.com\/betcode-org\/betfair\/blob\/7118b471e61282d87630bcdc5d6de6b69a59cfa6\/betfairlightweight\/streaming\/betfairstream.py | betfairstream.py>",
                "text": "```\n            self._connect()\n            self.authenticate()\n```",
                "title": "<https:\/\/github.com\/betcode-org\/betfair\/blob\/7118b471e61282d87630bcdc5d6de6b69a59cfa6\/betfairlightweight\/streaming\/betfairstream.py | betfairstream.py>",
                "footer": "<https:\/\/github.com\/betcode-org\/betfair|betcode-org\/betfair>",
                "mrkdwn_in": [
                    "text"
                ]
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "X9l",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "user",
                                "user_id": "U4H19D1D2"
                            },
                            {
                                "type": "text",
                                "text": " just reviewing our background to the issue when we first observed it and put in our workaround. I believe the issue is here: "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/betcode-org\/betfair\/blob\/7118b471e61282d87630bcdc5d6de6b69a59cfa6\/betfairlightweight\/streaming\/betfairstream.py#L284-L285"
                            },
                            {
                                "type": "text",
                                "text": ". I think we need to wait for the "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/docs.developer.betfair.com\/plugins\/servlet\/mobile?contentId=6094862#ExchangeStreamAPI-Connection\/ConnectionMessage",
                                "text": "connection message"
                            },
                            {
                                "type": "text",
                                "text": " before sending the authentication message"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UBS7QANF3",
        "type": "message",
        "ts": "1692113354.797039",
        "client_msg_id": "a9e4ad97-c5b8-4bdb-9b8b-8a1059544829",
        "text": "<https:\/\/docs.developer.betfair.com\/download\/attachments\/6094862\/NormalFlow.png?version=1&amp;modificationDate=1533567609000&amp;api=v2>",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gaaf844a4a90",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/eaaf844a4a905431d83430e563b077aa.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0011-72.png",
            "first_name": "",
            "real_name": "Maurice Berk",
            "display_name": "Mo",
            "team": "T4G9NBD2M",
            "name": "maurice",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1691786002.909899",
        "parent_user_id": "UCQB6S222",
        "attachments": [
            {
                "from_url": "https:\/\/docs.developer.betfair.com\/download\/attachments\/6094862\/NormalFlow.png?version=1&modificationDate=1533567609000&api=v2",
                "image_url": "https:\/\/docs.developer.betfair.com\/download\/attachments\/6094862\/NormalFlow.png?version=1&modificationDate=1533567609000&api=v2",
                "image_width": 1174,
                "image_height": 904,
                "image_bytes": 94011,
                "id": 1,
                "original_url": "https:\/\/docs.developer.betfair.com\/download\/attachments\/6094862\/NormalFlow.png?version=1&amp;modificationDate=1533567609000&amp;api=v2",
                "fallback": "1174x904px image"
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Bt=nh",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "link",
                                "url": "https:\/\/docs.developer.betfair.com\/download\/attachments\/6094862\/NormalFlow.png?version=1&modificationDate=1533567609000&api=v2"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UBS7QANF3",
        "type": "message",
        "ts": "1692113897.645829",
        "client_msg_id": "64aac50a-5c92-46e4-85b8-6ff5a5ffefb6",
        "text": "I can't remember why we didn't create an issue\/PR for this 3 and a half years ago :sweat_smile:",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gaaf844a4a90",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/eaaf844a4a905431d83430e563b077aa.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0011-72.png",
            "first_name": "",
            "real_name": "Maurice Berk",
            "display_name": "Mo",
            "team": "T4G9NBD2M",
            "name": "maurice",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1691786002.909899",
        "parent_user_id": "UCQB6S222",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "TfbT5",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I can't remember why we didn't create an issue\/PR for this 3 and a half years ago "
                            },
                            {
                                "type": "emoji",
                                "name": "sweat_smile",
                                "unicode": "1f605"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UCQB6S222",
        "type": "message",
        "ts": "1692115043.099359",
        "client_msg_id": "5bed05e7-4c98-45b2-8e01-7318fce888d5",
        "text": "does that mean we might be able to fix this in flumine soon? if so that would be great!",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g953ffd5e3b7",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/5813be539113b05ece8212c2a06d006a.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0011-72.png",
            "first_name": "George",
            "real_name": "George",
            "display_name": "George",
            "team": "T4G9NBD2M",
            "name": "gd",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1691786002.909899",
        "parent_user_id": "UCQB6S222",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "nfxGA",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "does that mean we might be able to fix this in flumine soon? if so that would be great!"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1692120634.583189",
        "client_msg_id": "aaa7a6d3-bac1-424d-9154-98c308dfe51d",
        "text": "I think we need a `_send_and_receive` function for the connection so that it blocks",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1691786002.909899",
        "parent_user_id": "UCQB6S222",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "re54",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I think we need a "
                            },
                            {
                                "type": "text",
                                "text": "_send_and_receive",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " function for the connection so that it blocks"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]