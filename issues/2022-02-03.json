[
    {
        "user": "U02RN7YDRQ9",
        "type": "message",
        "ts": "1643891053.786049",
        "client_msg_id": "22447f7c-5594-4745-a992-af0d89d57dd0",
        "text": "Puzzled by differences between live and backtest that I'm not expecting. Yesterday recorder and live betting were running on same VPS as separate processes under PyCharm.  Placed 28 live bets. Running the backtest later on it came up with bets on different runners on 4 of the races compared to what the live had done - sufficient to show a significantly different PL.\n\nLooked at one in detail - no latency issues in log - recorder saw bet placed 187ms after logged by bet process. EX_BEST.. not used. Strategy source code the same for backtest\/live. Betting triggering on EX_ALL.. price movements.\n\nI expected the backtest to trigger on the same runner at the same time as the live did.\n\nThe recorder packets seem to be 4, 5 or 6 per second - could it be dropping packets that the live betting is seeing ? I thought they were all kept and cached if the app couldn't keep up ie excess latency compared to \"pt\" - ie not possible to miss any packets that BF push out ?\n\nAny suggestions as to cause or where to look next ?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "ge46f1f8b708",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/e46f1f8b708a630e3191de7b2c42b1d1.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "edblock",
            "real_name": "edblock",
            "display_name": "foxwood",
            "team": "T4G9NBD2M",
            "name": "eanb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1643891053.786049",
        "reply_count": 11,
        "reply_users_count": 4,
        "latest_reply": "1644594205.416839",
        "reply_users": [
            "UBS7QANF3",
            "U02RN7YDRQ9",
            "U9JHLMZB4",
            "U016TGY3676"
        ],
        "replies": [
            {
                "user": "UBS7QANF3",
                "ts": "1643894130.747609"
            },
            {
                "user": "UBS7QANF3",
                "ts": "1643894423.027789"
            },
            {
                "user": "U02RN7YDRQ9",
                "ts": "1643899426.657689"
            },
            {
                "user": "U02RN7YDRQ9",
                "ts": "1643899654.723949"
            },
            {
                "user": "UBS7QANF3",
                "ts": "1643900058.463089"
            },
            {
                "user": "UBS7QANF3",
                "ts": "1643900118.824439"
            },
            {
                "user": "U02RN7YDRQ9",
                "ts": "1643904845.231429"
            },
            {
                "user": "UBS7QANF3",
                "ts": "1643905463.997109"
            },
            {
                "user": "U9JHLMZB4",
                "ts": "1643992945.191529"
            },
            {
                "user": "U016TGY3676",
                "ts": "1644218636.185839"
            },
            {
                "user": "U02RN7YDRQ9",
                "ts": "1644594205.416839"
            }
        ],
        "is_locked": false,
        "subscribed": false,
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "D3npG",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Puzzled by differences between live and backtest that I'm not expecting. Yesterday recorder and live betting were running on same VPS as separate processes under PyCharm.  Placed 28 live bets. Running the backtest later on it came up with bets on different runners on 4 of the races compared to what the live had done - sufficient to show a significantly different PL.\n\nLooked at one in detail - no latency issues in log - recorder saw bet placed 187ms after logged by bet process. EX_BEST.. not used. Strategy source code the same for backtest\/live. Betting triggering on EX_ALL.. price movements.\n\nI expected the backtest to trigger on the same runner at the same time as the live did.\n\nThe recorder packets seem to be 4, 5 or 6 per second - could it be dropping packets that the live betting is seeing ? I thought they were all kept and cached if the app couldn't keep up ie excess latency compared to \"pt\" - ie not possible to miss any packets that BF push out ?\n\nAny suggestions as to cause or where to look next ?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UBS7QANF3",
        "type": "message",
        "ts": "1643894130.747609",
        "client_msg_id": "0ee5db73-009a-42b2-9b92-1317a3067a03",
        "text": "Very hard to answer without knowing exactly how you are triggering the bets. If the logic is identical then the only possible difference can be the prices that were fed in to each. It's entirely possible that subtle differences in the times that price updates were received can lead to large differences in the outcomes and it should be obvious that two streams are not going to receive the price updates at exactly the same time",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gaaf844a4a90",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/eaaf844a4a905431d83430e563b077aa.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0011-72.png",
            "first_name": "",
            "real_name": "Maurice Berk",
            "display_name": "Mo",
            "team": "T4G9NBD2M",
            "name": "maurice",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1643891053.786049",
        "parent_user_id": "U02RN7YDRQ9",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "6WE",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Very hard to answer without knowing exactly how you are triggering the bets. If the logic is identical then the only possible difference can be the prices that were fed in to each. It's entirely possible that subtle differences in the times that price updates were received can lead to large differences in the outcomes and it should be obvious that two streams are not going to receive the price updates at exactly the same time"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UBS7QANF3",
        "type": "message",
        "ts": "1643894423.027789",
        "client_msg_id": "453255e9-11f0-417f-b999-5a0212633c92",
        "text": "If you are not pulling the packets off the stream fast enough then Betfair will conflate them - i.e. group multiple updates into one message. Any reason why a rate of 4 - 6 updates per second is making you think conflation is happening?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gaaf844a4a90",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/eaaf844a4a905431d83430e563b077aa.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0011-72.png",
            "first_name": "",
            "real_name": "Maurice Berk",
            "display_name": "Mo",
            "team": "T4G9NBD2M",
            "name": "maurice",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1643891053.786049",
        "parent_user_id": "U02RN7YDRQ9",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Efh",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "If you are not pulling the packets off the stream fast enough then Betfair will conflate them - i.e. group multiple updates into one message. Any reason why a rate of 4 - 6 updates per second is making you think conflation is happening?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U02RN7YDRQ9",
        "type": "message",
        "ts": "1643899426.657689",
        "client_msg_id": "9de75fc5-ec25-462e-ad40-a2b739542f9a",
        "text": "Trigger simply based on movements and current price - so missing\/gaining a change in current price is key. All mentions of conflate in the log show null value.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "ge46f1f8b708",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/e46f1f8b708a630e3191de7b2c42b1d1.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "edblock",
            "real_name": "edblock",
            "display_name": "foxwood",
            "team": "T4G9NBD2M",
            "name": "eanb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1643891053.786049",
        "parent_user_id": "U02RN7YDRQ9",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "i53",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Trigger simply based on movements and current price - so missing\/gaining a change in current price is key. All mentions of conflate in the log show null value."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U02RN7YDRQ9",
        "type": "message",
        "ts": "1643899654.723949",
        "edited": {
            "user": "U02RN7YDRQ9",
            "ts": "1643899721.000000"
        },
        "client_msg_id": "4f14d779-21e8-4953-bbce-a15c55007598",
        "text": "Understand that two streams will not be simultaneous but I'm working on the basis that the same \"published time\" will go to each stream with same info. Presume that applies to everyone looking ie if you were recording the same market then our saved files should be identical where recording the same timeframe. Wondered if 4-6 updates were missing some since read somewhere that BF matching cycle works at 100ms intervals - 10 possible packets ?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "ge46f1f8b708",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/e46f1f8b708a630e3191de7b2c42b1d1.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "edblock",
            "real_name": "edblock",
            "display_name": "foxwood",
            "team": "T4G9NBD2M",
            "name": "eanb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1643891053.786049",
        "parent_user_id": "U02RN7YDRQ9",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Bs+77",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Understand that two streams will not be simultaneous but I'm working on the basis that the same \"published time\" will go to each stream with same info. Presume that applies to everyone looking ie if you were recording the same market then our saved files should be identical where recording the same timeframe. Wondered if 4-6 updates were missing some since read somewhere that BF matching cycle works at 100ms intervals - 10 possible packets ?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UBS7QANF3",
        "type": "message",
        "ts": "1643900058.463089",
        "client_msg_id": "E1ED7BD2-4118-4800-8E69-DB7CC46B4994",
        "text": "Pretty sure that's incorrect. We won't see the same publish times",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gaaf844a4a90",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/eaaf844a4a905431d83430e563b077aa.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0011-72.png",
            "first_name": "",
            "real_name": "Maurice Berk",
            "display_name": "Mo",
            "team": "T4G9NBD2M",
            "name": "maurice",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1643891053.786049",
        "parent_user_id": "U02RN7YDRQ9",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "sEf",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Pretty sure that's incorrect. We won't see the same publish times"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "UBS7QANF3",
        "type": "message",
        "ts": "1643900118.824439",
        "client_msg_id": "07D471F2-8115-4914-8B1A-40593E135C04",
        "text": "Matching cycle is every 50 milliseconds but no guarantee that something will happen in every cycle",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gaaf844a4a90",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/eaaf844a4a905431d83430e563b077aa.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0011-72.png",
            "first_name": "",
            "real_name": "Maurice Berk",
            "display_name": "Mo",
            "team": "T4G9NBD2M",
            "name": "maurice",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1643891053.786049",
        "parent_user_id": "U02RN7YDRQ9",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "M=h",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Matching cycle is every 50 milliseconds but no guarantee that something will happen in every cycle"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U02RN7YDRQ9",
        "type": "message",
        "ts": "1643904845.231429",
        "edited": {
            "user": "U02RN7YDRQ9",
            "ts": "1643904906.000000"
        },
        "client_msg_id": "c31396df-6976-45ae-bb05-4ab789f25a58",
        "text": "Solved - bit brain bendy. In check_market_book I was using market.seconds_to_start to ignore unwanted early packets. When used in backtest that field is calculated using the packet \"published time\" but for live usage is calculated using \"now\". Since live always has some latency, at the time it considered it needed to start, the current packet to be processed was actually timestamped 200ms earlier than the wanted start time. Proved it by winding the stream back by 1 packet and it did exactly as the live did and eventually bet on the same runner. QED\n\nMy solution is therefore to use the \"published time\" as the processing trigger and not market.seconds_to_start which is a true real time value. The backtest and live \"should\" then be in sync I hope.\n\nBe interesting to find out if we do all get the same timestamps - thanks for comments <@UBS7QANF3>",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "ge46f1f8b708",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/e46f1f8b708a630e3191de7b2c42b1d1.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0023-72.png",
            "first_name": "edblock",
            "real_name": "edblock",
            "display_name": "foxwood",
            "team": "T4G9NBD2M",
            "name": "eanb",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1643891053.786049",
        "parent_user_id": "U02RN7YDRQ9",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "9qQiH",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Solved - bit brain bendy. In check_market_book I was using market.seconds_to_start to ignore unwanted early packets. When used in backtest that field is calculated using the packet \"published time\" but for live usage is calculated using \"now\". Since live always has some latency, at the time it considered it needed to start, the current packet to be processed was actually timestamped 200ms earlier than the wanted start time. Proved it by winding the stream back by 1 packet and it did exactly as the live did and eventually bet on the same runner. QED\n\nMy solution is therefore to use the \"published time\" as the processing trigger and not market.seconds_to_start which is a true real time value. The backtest and live \"should\" then be in sync I hope.\n\nBe interesting to find out if we do all get the same timestamps - thanks for comments "
                            },
                            {
                                "type": "user",
                                "user_id": "UBS7QANF3"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "channel_join",
        "user": "U031J8BBZ4J",
        "text": "<@U031J8BBZ4J> has joined the channel",
        "type": "message",
        "ts": "1643905220.981639"
    },
    {
        "user": "UBS7QANF3",
        "type": "message",
        "ts": "1643905463.997109",
        "client_msg_id": "8887E41D-E2FB-47DC-BF34-1A356275425C",
        "text": ":+1:",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "gaaf844a4a90",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/eaaf844a4a905431d83430e563b077aa.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0011-72.png",
            "first_name": "",
            "real_name": "Maurice Berk",
            "display_name": "Mo",
            "team": "T4G9NBD2M",
            "name": "maurice",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1643891053.786049",
        "parent_user_id": "U02RN7YDRQ9",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "1UeLE",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "emoji",
                                "name": "+1",
                                "unicode": "1f44d"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]