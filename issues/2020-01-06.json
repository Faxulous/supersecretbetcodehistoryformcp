[
    {
        "text": "Hi <@U4H19D1D2> , i have  changed logging to DEBUG, and got the same error. how can i deal with this error? try and except are pointless as you mentioned. how  can i capture this error such that i stop the stream and then resubscribe to the markets.  what do i need to add? ...thanks",
        "files": [
            {
                "id": "FRYDF8VUJ",
                "mode": "hidden_by_limit"
            }
        ],
        "upload": true,
        "user": "US6CDMD7Z",
        "display_as_bot": false,
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "BLf",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Hi "
                            },
                            {
                                "type": "user",
                                "user_id": "U4H19D1D2"
                            },
                            {
                                "type": "text",
                                "text": " , i have  changed logging to DEBUG, and got the same error. how can i deal with this error? try and except are pointless as you mentioned. how  can i capture this error such that i stop the stream and then resubscribe to the markets.  what do i need to add? ...thanks"
                            }
                        ]
                    }
                ]
            }
        ],
        "type": "message",
        "ts": "1578340934.017500",
        "edited": {
            "user": "US6CDMD7Z",
            "ts": "1578340967.000000"
        },
        "client_msg_id": "28978d78-bc19-425f-81e8-d35ef2f97ee7"
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1578341057.019500",
        "client_msg_id": "CF7B374C-52A2-46AB-95DE-0B97ADC20339",
        "text": "So it’s getting updates but it looks like the code in the while loop isn’t getting executed, can you print t and datetime.now() under the stream.start line?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1578341057.019500",
        "reply_count": 3,
        "reply_users_count": 2,
        "latest_reply": "1578341804.023500",
        "reply_users": [
            "US6CDMD7Z",
            "U4H19D1D2"
        ],
        "replies": [
            {
                "user": "US6CDMD7Z",
                "ts": "1578341587.019800"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1578341742.023100"
            },
            {
                "user": "U4H19D1D2",
                "ts": "1578341804.023500"
            }
        ],
        "is_locked": false,
        "subscribed": true,
        "last_read": "1578341804.023500",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "f33B",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "So it’s getting updates but it looks like the code in the while loop isn’t getting executed, can you print t and datetime.now() under the stream.start line?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "US6CDMD7Z",
        "type": "message",
        "ts": "1578341587.019800",
        "client_msg_id": "5971e338-e113-42aa-a46f-193540b9ad96",
        "text": "yes, i can. i was printing it, it works, it is only when this error happens, that everything freeze. will changing async to false help? how will printing the time below start.stream help? . have you seen this before? this happens once every 10 to 15 hours. what can i do handle it? ...thanks Liam i appreciate it.",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g19c4206d93c",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/19c4206d93c52ebd2221e703d5f8e9de.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0026-72.png",
            "first_name": "DonJ80",
            "real_name": "DonJ80",
            "display_name": "DonJ80",
            "team": "T4G9NBD2M",
            "name": "ali.jwan",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1578341057.019500",
        "parent_user_id": "U4H19D1D2",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "JOej",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "yes, i can. i was printing it, it works, it is only when this error happens, that everything freeze. will changing async to false help? how will printing the time below start.stream help? . have you seen this before? this happens once every 10 to 15 hours. what can i do handle it? ...thanks Liam i appreciate it."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1578341742.023100",
        "client_msg_id": "2CEFAF87-B8E9-4BE1-9851-B6C105F243DB",
        "text": "Ah, if it’s happening every now and again it will be because you are not catching any errors the stream may have. You need to run stream.start in a separate thread with try \/ except and reconnect on error. It’s common to get timeout or connection closed errors (caused by betfair or internet connection)",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1578341057.019500",
        "parent_user_id": "U4H19D1D2",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "m8n8",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Ah, if it’s happening every now and again it will be because you are not catching any errors the stream may have. You need to run stream.start in a separate thread with try \/ except and reconnect on error. It’s common to get timeout or connection closed errors (caused by betfai"
                            },
                            {
                                "type": "text",
                                "text": "r or internet connection)"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1578341804.023500",
        "client_msg_id": "9B9F4C30-6FE3-4931-952A-EBCFF3D0A03B",
        "text": "<https:\/\/github.com\/liampauling\/flumine\/blob\/aedf15492e0a5e3e366c9416c5cac95e600ddf18\/flumine\/flumine.py#L78|https:\/\/github.com\/liampauling\/flumine\/blob\/aedf15492e0a5e3e366c9416c5cac95e600ddf18\/flumine\/flumine.py#L78>",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1578341057.019500",
        "parent_user_id": "U4H19D1D2",
        "attachments": [
            {
                "service_name": "GitHub",
                "title": "liampauling\/flumine",
                "title_link": "https:\/\/github.com\/liampauling\/flumine\/blob\/aedf15492e0a5e3e366c9416c5cac95e600ddf18\/flumine\/flumine.py#L78",
                "text": "flūmine - Betfair data record framework utilising streaming to create a simple data recorder - liampauling\/flumine",
                "fallback": "GitHub: liampauling\/flumine",
                "thumb_url": "https:\/\/avatars2.githubusercontent.com\/u\/12016537?s=400&v=4",
                "from_url": "https:\/\/github.com\/liampauling\/flumine\/blob\/aedf15492e0a5e3e366c9416c5cac95e600ddf18\/flumine\/flumine.py#L78",
                "thumb_width": 392,
                "thumb_height": 392,
                "service_icon": "https:\/\/a.slack-edge.com\/80588\/img\/unfurl_icons\/github.png",
                "id": 1,
                "original_url": "https:\/\/github.com\/liampauling\/flumine\/blob\/aedf15492e0a5e3e366c9416c5cac95e600ddf18\/flumine\/flumine.py#L78"
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "dks",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/liampauling\/flumine\/blob\/aedf15492e0a5e3e366c9416c5cac95e600ddf18\/flumine\/flumine.py#L78",
                                "text": "https:\/\/github.com\/liampauling\/flumine\/blob\/aedf15492e0a5e3e366c9416c5cac95e600ddf18\/flumine\/flumine.py#L78"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "US6CDMD7Z",
        "type": "message",
        "ts": "1578342164.024400",
        "client_msg_id": "fe7d71d1-3994-46aa-a9b8-c32cc4b72443",
        "text": "```  @liam Do you mean something like this?  \ntry:\n       # start stream\n       stream.start(async_=True)\nexcept:\n        stream.stop()\n        # create stream listener\n            listener = betfairlightweight.StreamListener(\n                output_queue=output_queue,\n            )\n\n            # create stream\n            stream = trading.streaming.create_stream(\n                listener=listener,\n            )\n\n            # create filters \n            market_filter = streaming_market_filter(\n                event_type_ids=['7'],\n                event_ids=hr_thoroughbred_events_next_12hours['Event ID'],\n                market_types=['WIN'],\n            )\n            market_data_filter = streaming_market_data_filter(\n                fields=['EX_BEST_OFFERS', 'EX_MARKET_DEF' ],\n                ladder_levels=5,\n            )\n\n            # subscribe\n            streaming_unique_id = stream.subscribe_to_markets(\n                market_filter=market_filter,\n                market_data_filter=market_data_filter,\n                conflate_ms=1000,  # send update every 1000ms\n            )\n\n            # start stream\n            stream.start(async_=True)\n    # check for updates in output queue\n\n    while datetime.datetime.now() &lt; t:\n        \n            market_books = output_queue.get()\n            print(market_books)\n\n            for market_book in market_books:\n                print(\n                    market_book.streaming_update, \n                    market_book.publish_time,  \n                )\n       \n    t = t + datetime.timedelta(hours=12)```\n",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g19c4206d93c",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/19c4206d93c52ebd2221e703d5f8e9de.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0026-72.png",
            "first_name": "DonJ80",
            "real_name": "DonJ80",
            "display_name": "DonJ80",
            "team": "T4G9NBD2M",
            "name": "ali.jwan",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "x=ac",
                "elements": [
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "  @liam Do you mean something like this?  \ntry:\n       # start stream\n       stream.start(async_=True)\nexcept:\n        stream.stop()\n        # create stream listener\n            listener = betfairlightweight.StreamListener(\n                output_queue=output_queue,\n            )\n\n            # create stream\n            stream = trading.streaming.create_stream(\n                listener=listener,\n            )\n\n            # create filters \n            market_filter = streaming_market_filter(\n                event_type_ids=['7'],\n                event_ids=hr_thoroughbred_events_next_12hours['Event ID'],\n                market_types=['WIN'],\n            )\n            market_data_filter = streaming_market_data_filter(\n                fields=['EX_BEST_OFFERS', 'EX_MARKET_DEF' ],\n                ladder_levels=5,\n            )\n\n            # subscribe\n            streaming_unique_id = stream.subscribe_to_markets(\n                market_filter=market_filter,\n                market_data_filter=market_data_filter,\n                conflate_ms=1000,  # send update every 1000ms\n            )\n\n            # start stream\n            stream.start(async_=True)\n    # check for updates in output queue\n\n    while datetime.datetime.now() < t:\n        \n            market_books = output_queue.get()\n            print(market_books)\n\n            for market_book in market_books:\n                print(\n                    market_book.streaming_update, \n                    market_book.publish_time,  \n                )\n       \n    t = t + datetime.timedelta(hours=12)"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": []
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1578342227.025600",
        "client_msg_id": "882F6CBE-11B0-4902-8163-05C4DD52A4B3",
        "text": "No, async needs to be false as you need to start the thread, looks like you are just duplicating code as well, wrap it in a function ",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "+Zgt",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "No, async needs to be false as you need to start the thread, looks like you are just duplicating code as well, wrap it in a function "
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "US6CDMD7Z",
        "type": "message",
        "ts": "1578342595.026300",
        "client_msg_id": "c5c585ad-7fd5-48c7-9c57-25f232a21c94",
        "text": "```Do mean like this \ntry:\n       # start stream\n       stream.start(async_=False)\nexcept:\n        subscribe_to_markets_function() \n        #this stops the stream, subscribe tomarket and then start the stream   with async =False again.\n\n    while datetime.datetime.now() &lt; t:\n        \n            market_books = output_queue.get()\n            print(market_books)\n\n            for market_book in market_books:\n                print(\n                    market_book.streaming_update, \n                    market_book.publish_time,  \n                )\n       \n    t = t + datetime.timedelta(hours=12)```\n",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g19c4206d93c",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/19c4206d93c52ebd2221e703d5f8e9de.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0026-72.png",
            "first_name": "DonJ80",
            "real_name": "DonJ80",
            "display_name": "DonJ80",
            "team": "T4G9NBD2M",
            "name": "ali.jwan",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "y=J",
                "elements": [
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Do mean like this \ntry:\n       # start stream\n       stream.start(async_=False)\nexcept:\n        subscribe_to_markets_function() \n        #this stops the stream, subscribe tomarket and then start the stream   with async =False again.\n\n    while datetime.datetime.now() < t:\n        \n            market_books = output_queue.get()\n            print(market_books)\n\n            for market_book in market_books:\n                print(\n                    market_book.streaming_update, \n                    market_book.publish_time,  \n                )\n       \n    t = t + datetime.timedelta(hours=12)"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": []
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1578342662.027100",
        "client_msg_id": "ADA20141-54C9-4F35-AD90-646F1AAB49E4",
        "text": "No, I recommend reading up on threads and understanding the flumine code",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "\/XQh",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "No, I recommend reading up on threads and understanding the flumine code"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1578342695.027700",
        "client_msg_id": "1E965C94-033B-4879-9051-7D3393146146",
        "text": "<https:\/\/docs.python.org\/3\/library\/threading.html|https:\/\/docs.python.org\/3\/library\/threading.html>",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "ZTcM",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "link",
                                "url": "https:\/\/docs.python.org\/3\/library\/threading.html",
                                "text": "https:\/\/docs.python.org\/3\/library\/threading.html"
                            }
                        ]
                    }
                ]
            }
        ],
        "reactions": [
            {
                "name": "+1",
                "users": [
                    "US6CDMD7Z"
                ],
                "count": 1
            }
        ]
    },
    {
        "user": "US6CDMD7Z",
        "type": "message",
        "ts": "1578342699.027900",
        "client_msg_id": "f9a24452-1ed8-449d-bef3-c3ebd4bab1a8",
        "text": "ok, thanks Liam, I appreciate",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g19c4206d93c",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/19c4206d93c52ebd2221e703d5f8e9de.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0026-72.png",
            "first_name": "DonJ80",
            "real_name": "DonJ80",
            "display_name": "DonJ80",
            "team": "T4G9NBD2M",
            "name": "ali.jwan",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Ckvp",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "ok, thanks Liam, I appreciate"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]