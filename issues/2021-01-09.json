[
    {
        "user": "U011VL3CA2Y",
        "type": "message",
        "ts": "1610194622.052500",
        "client_msg_id": "2585ad50-9804-431a-858f-53b8bf81954c",
        "text": "good morning everyone, I'm backtesting a market with flumine, pre-event, and I'm submitting a `LimitOrder` with `persistence_type = 'LAPSE'` . The market is supposed to turn in-play at 20:15:00. Looking at `order.responses.place_responses`  I see this order was placed at 20:15:38. Why could this be? The market turned inplay later than expected?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g1ec6e88d1e4",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/1ec6e88d1e4dd0bff349d83e9edba6bd.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0005-72.png",
            "first_name": "Ruben",
            "real_name": "Ruben",
            "display_name": "Ruben",
            "team": "T4G9NBD2M",
            "name": "tduqruqtgtpiioibww",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1610194622.052500",
        "reply_count": 12,
        "reply_users_count": 2,
        "latest_reply": "1610195439.055600",
        "reply_users": [
            "U0135SLHQBW",
            "U011VL3CA2Y"
        ],
        "replies": [
            {
                "user": "U0135SLHQBW",
                "ts": "1610194868.052800"
            },
            {
                "user": "U0135SLHQBW",
                "ts": "1610194888.053000"
            },
            {
                "user": "U011VL3CA2Y",
                "ts": "1610195059.053200"
            },
            {
                "user": "U0135SLHQBW",
                "ts": "1610195093.053400"
            },
            {
                "user": "U0135SLHQBW",
                "ts": "1610195103.053600"
            },
            {
                "user": "U011VL3CA2Y",
                "ts": "1610195110.053800"
            },
            {
                "user": "U0135SLHQBW",
                "ts": "1610195118.054000"
            },
            {
                "user": "U011VL3CA2Y",
                "ts": "1610195165.054200"
            },
            {
                "user": "U011VL3CA2Y",
                "ts": "1610195182.054400"
            },
            {
                "user": "U0135SLHQBW",
                "ts": "1610195233.054600"
            },
            {
                "user": "U0135SLHQBW",
                "ts": "1610195259.054800"
            },
            {
                "user": "U011VL3CA2Y",
                "ts": "1610195439.055600"
            }
        ],
        "is_locked": false,
        "subscribed": false,
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "jnj",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "good morning everyone, I'm backtesting a market with flumine, pre-event, and I'm submitting a "
                            },
                            {
                                "type": "text",
                                "text": "LimitOrder",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " with "
                            },
                            {
                                "type": "text",
                                "text": "persistence_type = 'LAPSE'",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " . The market is supposed to turn in-play at 20:15:00. Looking at "
                            },
                            {
                                "type": "text",
                                "text": "order.responses.place_responses",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "  I see this order was placed at 20:15:38. Why could this be? The market turned inplay later than expected?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U0135SLHQBW",
        "type": "message",
        "ts": "1610194868.052800",
        "client_msg_id": "b369b737-99d3-47b4-b919-0366e2fd280a",
        "text": "Have you checked what time it actually goes inplay?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g316814ce896",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/316814ce896c34a9c72e2ddd6fa17b86.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0007-72.png",
            "first_name": "",
            "real_name": "MacrcoPolo",
            "display_name": "MacrcoPolo",
            "team": "T4G9NBD2M",
            "name": "omverran",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1610194622.052500",
        "parent_user_id": "U011VL3CA2Y",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "V12C",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Have you checked what time it actually goes inplay?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U0135SLHQBW",
        "type": "message",
        "ts": "1610194888.053000",
        "client_msg_id": "f7b486f9-af0f-4a5a-9cb1-747d8f45cab7",
        "text": "(Just offering this as a suggestion since you do actually offer a solution yourself!)",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g316814ce896",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/316814ce896c34a9c72e2ddd6fa17b86.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0007-72.png",
            "first_name": "",
            "real_name": "MacrcoPolo",
            "display_name": "MacrcoPolo",
            "team": "T4G9NBD2M",
            "name": "omverran",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1610194622.052500",
        "parent_user_id": "U011VL3CA2Y",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "ilvvV",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "(Just offering this as a suggestion since you do actually offer a solution yourself!)"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U011VL3CA2Y",
        "type": "message",
        "ts": "1610195059.053200",
        "client_msg_id": "47cbe043-956a-4ca1-aa2c-5f8eab90ac02",
        "text": "he flag market.inplay turns True 114 seconds later than market.start_datetime. I'm just surpirsed that this flag is so off",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g1ec6e88d1e4",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/1ec6e88d1e4dd0bff349d83e9edba6bd.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0005-72.png",
            "first_name": "Ruben",
            "real_name": "Ruben",
            "display_name": "Ruben",
            "team": "T4G9NBD2M",
            "name": "tduqruqtgtpiioibww",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1610194622.052500",
        "parent_user_id": "U011VL3CA2Y",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "VrIB0",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "he flag market.inplay turns True 114 seconds later than market.start_datetime. I'm just surpirsed that this flag is so off"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U0135SLHQBW",
        "type": "message",
        "ts": "1610195093.053400",
        "client_msg_id": "131c2270-2ad0-4bbe-8a88-07e7cb0c917b",
        "text": "I think 2  minutes isn't that much. Betfair try to turn things inplay when it actually goes inplay",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g316814ce896",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/316814ce896c34a9c72e2ddd6fa17b86.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0007-72.png",
            "first_name": "",
            "real_name": "MacrcoPolo",
            "display_name": "MacrcoPolo",
            "team": "T4G9NBD2M",
            "name": "omverran",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1610194622.052500",
        "parent_user_id": "U011VL3CA2Y",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "=X451",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I think 2  minutes isn't that much. Betfair try to turn things inplay when it actually goes inplay"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U0135SLHQBW",
        "type": "message",
        "ts": "1610195103.053600",
        "client_msg_id": "2a30acf8-aa9a-43a7-971f-2d70be4adc5a",
        "text": "2 minutes is a pretty typical deviation",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g316814ce896",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/316814ce896c34a9c72e2ddd6fa17b86.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0007-72.png",
            "first_name": "",
            "real_name": "MacrcoPolo",
            "display_name": "MacrcoPolo",
            "team": "T4G9NBD2M",
            "name": "omverran",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1610194622.052500",
        "parent_user_id": "U011VL3CA2Y",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "jS9",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "2 minutes is a pretty typical deviation"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U011VL3CA2Y",
        "type": "message",
        "ts": "1610195110.053800",
        "client_msg_id": "046305fb-a717-4104-aa3a-342b83336724",
        "text": "ah okay, didn't know that",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g1ec6e88d1e4",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/1ec6e88d1e4dd0bff349d83e9edba6bd.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0005-72.png",
            "first_name": "Ruben",
            "real_name": "Ruben",
            "display_name": "Ruben",
            "team": "T4G9NBD2M",
            "name": "tduqruqtgtpiioibww",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1610194622.052500",
        "parent_user_id": "U011VL3CA2Y",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "EU=t",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "ah okay, didn't know that"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U0135SLHQBW",
        "type": "message",
        "ts": "1610195118.054000",
        "client_msg_id": "277fcfa1-87fb-47d7-9423-520ae0553089",
        "text": "10 minutes on the other hand would be surprising (although depends on sport)",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g316814ce896",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/316814ce896c34a9c72e2ddd6fa17b86.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0007-72.png",
            "first_name": "",
            "real_name": "MacrcoPolo",
            "display_name": "MacrcoPolo",
            "team": "T4G9NBD2M",
            "name": "omverran",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1610194622.052500",
        "parent_user_id": "U011VL3CA2Y",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Wq6p",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "10 minutes on the other hand would be surprising (although depends on sport)"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U011VL3CA2Y",
        "type": "message",
        "ts": "1610195165.054200",
        "client_msg_id": "315643f5-884a-4c42-ad57-1c9428f0980d",
        "text": "also wasn't aware that persistence_type=LAPSE orders are removed once the market actually goes inplay, I thought they were removed at market.start_datetime",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g1ec6e88d1e4",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/1ec6e88d1e4dd0bff349d83e9edba6bd.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0005-72.png",
            "first_name": "Ruben",
            "real_name": "Ruben",
            "display_name": "Ruben",
            "team": "T4G9NBD2M",
            "name": "tduqruqtgtpiioibww",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1610194622.052500",
        "parent_user_id": "U011VL3CA2Y",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "9QzO8",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "also wasn't aware that persistence_type=LAPSE orders are removed once the market actually goes inplay, I thought they were removed at market.start_datetime"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U011VL3CA2Y",
        "type": "message",
        "ts": "1610195182.054400",
        "client_msg_id": "e0149ebf-c116-4cf2-9f3d-d91509c3bcca",
        "text": "makes sense, thanks a lot <@U0135SLHQBW>",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g1ec6e88d1e4",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/1ec6e88d1e4dd0bff349d83e9edba6bd.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0005-72.png",
            "first_name": "Ruben",
            "real_name": "Ruben",
            "display_name": "Ruben",
            "team": "T4G9NBD2M",
            "name": "tduqruqtgtpiioibww",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1610194622.052500",
        "parent_user_id": "U011VL3CA2Y",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "RtL",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "makes sense, thanks a lot "
                            },
                            {
                                "type": "user",
                                "user_id": "U0135SLHQBW"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U0135SLHQBW",
        "type": "message",
        "ts": "1610195233.054600",
        "client_msg_id": "28608bb7-7651-4651-a192-18a9deea8329",
        "text": "Yup, you're correct - LAPSE bets should only lapse when the market is properly turned inplay (I'm sure there's been the occasional screw-up by betfair over the years though)",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g316814ce896",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/316814ce896c34a9c72e2ddd6fa17b86.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0007-72.png",
            "first_name": "",
            "real_name": "MacrcoPolo",
            "display_name": "MacrcoPolo",
            "team": "T4G9NBD2M",
            "name": "omverran",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1610194622.052500",
        "parent_user_id": "U011VL3CA2Y",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Xz6w",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Yup, you're correct - LAPSE bets should only lapse when the market is properly turned inplay (I'm sure there's been the occasional screw-up by betfair over the years though)"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U0135SLHQBW",
        "type": "message",
        "ts": "1610195259.054800",
        "edited": {
            "user": "U0135SLHQBW",
            "ts": "1610195279.000000"
        },
        "client_msg_id": "d9b98598-b0b4-41bb-9c2a-f6e2d8e6f9a7",
        "text": "If you really want to be safe and do what you thought would've happened you can cancel your remaining orders at the listed start time :slightly_smiling_face:",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g316814ce896",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/316814ce896c34a9c72e2ddd6fa17b86.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0007-72.png",
            "first_name": "",
            "real_name": "MacrcoPolo",
            "display_name": "MacrcoPolo",
            "team": "T4G9NBD2M",
            "name": "omverran",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1610194622.052500",
        "parent_user_id": "U011VL3CA2Y",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "wWXqY",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "If you really want to be safe and do what you thought would've happened you can cancel your remaining orders at the listed start time "
                            },
                            {
                                "type": "emoji",
                                "name": "slightly_smiling_face",
                                "unicode": "1f642"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U011VL3CA2Y",
        "type": "message",
        "ts": "1610195439.055600",
        "client_msg_id": "a8e9b2e4-3258-4539-9ff9-61c3475c2470",
        "text": "yes, that sounds safe, specially since I really don't know what I'm doing yet",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g1ec6e88d1e4",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/1ec6e88d1e4dd0bff349d83e9edba6bd.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0005-72.png",
            "first_name": "Ruben",
            "real_name": "Ruben",
            "display_name": "Ruben",
            "team": "T4G9NBD2M",
            "name": "tduqruqtgtpiioibww",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1610194622.052500",
        "parent_user_id": "U011VL3CA2Y",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "nDHmR",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "yes, that sounds safe, specially since I really don't know what I'm doing yet"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1610195459.056200",
        "client_msg_id": "AE0AECC8-59FA-4018-9EF0-267E11068826",
        "text": "Watch out when backtesting and persistence as we don’t have much logic surrounding it <https:\/\/github.com\/liampauling\/flumine\/issues\/192|https:\/\/github.com\/liampauling\/flumine\/issues\/192>",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "attachments": [
            {
                "author_name": "liampauling",
                "fallback": "[liampauling\/flumine] #192 Simulation improvements",
                "text": "Update PIQ based on 'potential' cancellations\nPrevent double counting of liquidity i.e. if you take £x sitting at y should x still be available on the next update (separate middleware? flag?)\nValidate market is open when placing orders (error if not)\nValidate market is open for SP and not in play when placing market on close orders\nCancel limit orders on <https:\/\/docs.developer.betfair.com\/display\/1smk3cen4v3lu3yomq5qye0ni\/New+API+Release+-+8th+August+2016|market version> updates if not `PERSIST`\nNon runner adjustment on matched orders and orders in the market\n    \n    • check market.version\n    • check matched == sum(traded)",
                "title": "#192 Simulation improvements",
                "footer": "<https:\/\/github.com\/liampauling\/flumine|liampauling\/flumine>",
                "id": 1,
                "title_link": "https:\/\/github.com\/liampauling\/flumine\/issues\/192",
                "author_link": "https:\/\/github.com\/liampauling",
                "author_icon": "https:\/\/avatars3.githubusercontent.com\/u\/12016537?v=4",
                "footer_icon": "https:\/\/github.githubassets.com\/favicon.ico",
                "ts": 1591080916,
                "color": "36a64f",
                "fields": [
                    {
                        "title": "Labels",
                        "value": "bug, enhancement, help wanted",
                        "short": true
                    }
                ],
                "mrkdwn_in": [
                    "text"
                ],
                "bot_id": "B01144Z0734",
                "app_unfurl_url": "https:\/\/github.com\/liampauling\/flumine\/issues\/192",
                "is_app_unfurl": true
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "fzv1Y",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Watch out when backtesting and persistence as we don’t have much logic surrounding it "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/liampauling\/flumine\/issues\/192",
                                "text": "https:\/\/github.com\/liampauling\/flumine\/issues\/192"
                            }
                        ]
                    }
                ]
            }
        ],
        "reactions": [
            {
                "name": "heavy_check_mark",
                "users": [
                    "U011VL3CA2Y"
                ],
                "count": 1
            }
        ]
    },
    {
        "user": "UUCD6P13J",
        "type": "message",
        "ts": "1610198026.066300",
        "edited": {
            "user": "UUCD6P13J",
            "ts": "1610203354.000000"
        },
        "client_msg_id": "3e02073c-fe5e-41bd-8a55-0a4825569760",
        "text": "I've just been looking through the codebase to understand why markets are not clearing and calling my log control for an hour but i'm not sure i quite understand it.\n```2021-01-08T13:31:29.835886969Z app[prod.1]: {\"asctime\": \"2021-01-08 13:31:29,835\", \"levelname\": \"INFO\", \"message\": \"Market 1.177713641 closed\", \"market_id\": \"1.177713641\", \"date_time_closed\": \"2021-01-08T13:31:29.835544\"}\n2021-01-08T13:31:29.838371374Z app[prod.1]: {\"asctime\": \"2021-01-08 13:31:29,837\", \"levelname\": \"INFO\", \"message\": \"Market closed\", \"market_id\": \"1.177713641\", \"client\": {\"….\n2021-01-08T14:35:15.808288346Z app[prod.1]: {\"asctime\": \"2021-01-08 14:35:15,807\", \"levelname\": \"INFO\", \"message\": \"Removing market 1.177713641\", \"client\":\n2021-01-08T14:35:15.808770984Z app[prod.1]: {\"asctime\": \"2021-01-08 14:35:15,808\", \"levelname\": \"INFO\", \"message\": \"Market removed\", \"market_id\": \"1.177713641\"}\n2021-01-08T14:37:43.073071965Z app[prod.1]: {\"asctime\": \"2021-01-08 14:37:43,072\", \"levelname\": \"INFO\", \"message\": \"1.177713641: x cleared orders found, more available: False\"}\n2021-01-08T14:37:43.076750659Z app[prod.1]: {\"asctime\": \"2021-01-08 14:37:43,074\", \"levelname\": \"WARNING\", \"message\": \"Market 1.177713641 not present when clearing\", \"market_id\": \"1.177713641\",\n2021-01-08T14:38:15.168358314Z app[prod.1]: {\"asctime\": \"2021-01-08 14:38:15,168\", \"levelname\": \"INFO\", \"message\": \"Market level cleared\", \"market_id\": \"1.177713641\", \"profit\": x, \"bet_count\": x}```\nBased on these logs it seems like at 13.31\n1. we get a market closed event as the `market_book.status = \"CLOSED\"` \n2. triggers <https:\/\/github.com\/liampauling\/flumine\/blob\/master\/flumine\/baseflumine.py#L252|this> code and adds the market to the `cleared_market_queue` \n3. a worker polls betfair for the cleared orders for the market and will retry until success\n4. on success updates my log control (doesn't get here until 14:38)\nThen 14:35 the market is removed which seems like it was called based on <https:\/\/github.com\/liampauling\/flumine\/blob\/master\/flumine\/baseflumine.py#L293|this> line (which happens after at least 1 hour). But I don't see the \"Market closed\" log again so was this method called somewhere else or the code stuck inbetween or just betfair updating status to `CLOSED` late?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g6898272ab81",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/6898272ab810e419c2c9ca9af1e53da8.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0012-72.png",
            "first_name": "Lee",
            "real_name": "Lee U",
            "display_name": "Lee",
            "team": "T4G9NBD2M",
            "name": "lunswor",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "K12",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "I've just been looking through the codebase to understand why markets are not clearing and calling my log control for an hour but i'm not sure i quite understand it.\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "2021-01-08T13:31:29.835886969Z app[prod.1]: {\"asctime\": \"2021-01-08 13:31:29,835\", \"levelname\": \"INFO\", \"message\": \"Market 1.177713641 closed\", \"market_id\": \"1.177713641\", \"date_time_closed\": \"2021-01-08T13:31:29.835544\"}\n2021-01-08T13:31:29.838371374Z app[prod.1]: {\"asctime\": \"2021-01-08 13:31:29,837\", \"levelname\": \"INFO\", \"message\": \"Market closed\", \"market_id\": \"1.177713641\", \"client\": {\"….\n2021-01-08T14:35:15.808288346Z app[prod.1]: {\"asctime\": \"2021-01-08 14:35:15,807\", \"levelname\": \"INFO\", \"message\": \"Removing market 1.177713641\", \"client\":\n2021-01-08T14:35:15.808770984Z app[prod.1]: {\"asctime\": \"2021-01-08 14:35:15,808\", \"levelname\": \"INFO\", \"message\": \"Market removed\", \"market_id\": \"1.177713641\"}\n2021-01-08T14:37:43.073071965Z app[prod.1]: {\"asctime\": \"2021-01-08 14:37:43,072\", \"levelname\": \"INFO\", \"message\": \"1.177713641: x cleared orders found, more available: False\"}\n2021-01-08T14:37:43.076750659Z app[prod.1]: {\"asctime\": \"2021-01-08 14:37:43,074\", \"levelname\": \"WARNING\", \"message\": \"Market 1.177713641 not present when clearing\", \"market_id\": \"1.177713641\",\n2021-01-08T14:38:15.168358314Z app[prod.1]: {\"asctime\": \"2021-01-08 14:38:15,168\", \"levelname\": \"INFO\", \"message\": \"Market level cleared\", \"market_id\": \"1.177713641\", \"profit\": x, \"bet_count\": x}"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Based on these logs it seems like at 13.31\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_list",
                        "elements": [
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "we get a market closed event as the "
                                    },
                                    {
                                        "type": "text",
                                        "text": "market_book.status = \"CLOSED\"",
                                        "style": {
                                            "code": true
                                        }
                                    },
                                    {
                                        "type": "text",
                                        "text": " "
                                    }
                                ]
                            },
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "triggers "
                                    },
                                    {
                                        "type": "link",
                                        "url": "https:\/\/github.com\/liampauling\/flumine\/blob\/master\/flumine\/baseflumine.py#L252",
                                        "text": "this"
                                    },
                                    {
                                        "type": "text",
                                        "text": " code and adds the market to the "
                                    },
                                    {
                                        "type": "text",
                                        "text": "cleared_market_queue",
                                        "style": {
                                            "code": true
                                        }
                                    },
                                    {
                                        "type": "text",
                                        "text": " "
                                    }
                                ]
                            },
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "a worker polls betfair for the cleared orders for the market and will retry until success"
                                    }
                                ]
                            },
                            {
                                "type": "rich_text_section",
                                "elements": [
                                    {
                                        "type": "text",
                                        "text": "on success updates my log control (doesn't get here until 14:38)"
                                    }
                                ]
                            }
                        ],
                        "style": "ordered",
                        "indent": 0
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\nThen 14:35 the market is removed which seems like it was called based on "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/liampauling\/flumine\/blob\/master\/flumine\/baseflumine.py#L293",
                                "text": "this"
                            },
                            {
                                "type": "text",
                                "text": " line (which happens after at least 1 hour). But I don't see the \"Market closed\" log again so was this method called somewhere else or the code stuck inbetween or just betfair updating status to "
                            },
                            {
                                "type": "text",
                                "text": "CLOSED",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " late?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U016TGY3676",
        "type": "message",
        "ts": "1610198868.066500",
        "client_msg_id": "0de61b56-cc29-4eda-969e-d26e90a104d2",
        "text": "Not sure what the situation is nowadays, but there used to be a caching issue where betfair may return data from a different server which is behind the original one your data came from, hence you _could_ receive data older than the last response. IIRC, there was a version number in the response?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "g6a681220e11",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/6a681220e11c1a2ed3685375d658dadb.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0001-72.png",
            "first_name": "",
            "real_name": "birchy",
            "display_name": "birchy",
            "team": "T4G9NBD2M",
            "name": "birchy",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1610101336.047400",
        "parent_user_id": "UE72WCRR8",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "zRy",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Not sure what the situation is nowadays, but there used to be a caching issue where betfair may return data from a different server which is behind the original one your data came from, hence you "
                            },
                            {
                                "type": "text",
                                "text": "could ",
                                "style": {
                                    "italic": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "receive data older than the last response. IIRC, there was a version number in the response?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U4H19D1D2",
        "type": "message",
        "ts": "1610199378.067200",
        "client_msg_id": "29682253-2F44-4468-BFB9-506629F0E1E7",
        "text": "Can you chuck that in an issue and I will have a look later?",
        "team": "T4G9NBD2M",
        "user_team": "T4G9NBD2M",
        "source_team": "T4G9NBD2M",
        "user_profile": {
            "avatar_hash": "137c5a3ef323",
            "image_72": "https:\/\/avatars.slack-edge.com\/2024-03-15\/6819395173841_137c5a3ef323f1944a1a_72.png",
            "first_name": "liam",
            "real_name": "liam",
            "display_name": "liam",
            "team": "T4G9NBD2M",
            "name": "liam",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "hdOy",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Can you chuck that in an issue and I will have a look later?"
                            }
                        ]
                    }
                ]
            }
        ],
        "reactions": [
            {
                "name": "+1",
                "users": [
                    "UUCD6P13J"
                ],
                "count": 1
            }
        ]
    },
    {
        "subtype": "channel_join",
        "user": "U01J8RB03LM",
        "text": "<@U01J8RB03LM> has joined the channel",
        "type": "message",
        "ts": "1610201202.067500"
    }
]